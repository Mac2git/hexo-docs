<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>LangChain4j | Lazy的个人博客</title><meta name="author" content="Lazy"><meta name="copyright" content="Lazy"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="SpringBoot如何集成AI">
<meta property="og:type" content="article">
<meta property="og:title" content="LangChain4j">
<meta property="og:url" content="https://mac2git.github.io/hexo-docs/2025/08/13/LangChain4j/LangChain4j/index.html">
<meta property="og:site_name" content="Lazy的个人博客">
<meta property="og:description" content="SpringBoot如何集成AI">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://docs.langchain4j.info/img/logo.svg">
<meta property="article:published_time" content="2025-08-12T16:00:00.000Z">
<meta property="article:modified_time" content="2025-08-24T10:20:41.822Z">
<meta property="article:author" content="Lazy">
<meta property="article:tag" content="LangChain4j">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://docs.langchain4j.info/img/logo.svg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "LangChain4j",
  "url": "https://mac2git.github.io/hexo-docs/2025/08/13/LangChain4j/LangChain4j/",
  "image": "https://docs.langchain4j.info/img/logo.svg",
  "datePublished": "2025-08-12T16:00:00.000Z",
  "dateModified": "2025-08-24T10:20:41.822Z",
  "author": [
    {
      "@type": "Person",
      "name": "Lazy",
      "url": "https://mac2git.github.io/hexo-docs"
    }
  ]
}</script><link rel="shortcut icon" href="/hexo-docs/images/webImages/logo.svg"><link rel="canonical" href="https://mac2git.github.io/hexo-docs/2025/08/13/LangChain4j/LangChain4j/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/hexo-docs/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/hexo-docs/',
  algolia: undefined,
  localSearch: {"path":"/hexo-docs/search.xml","preload":true,"top_n_per_article":-1,"unescape":true,"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":30,"languages":{"author":"作者: Lazy","link":"链接: ","source":"来源: Lazy的个人博客","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"已切换为繁体中文","cht_to_chs":"已切换为简体中文","day_to_night":"已切换为深色模式","night_to_day":"已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#2d3035","position":"bottom-left"},
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: true,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'LangChain4j',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/hexo-docs/images/webImages/avatar.jpg" onerror="this.onerror=null;this.src='/hexo-docs/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/hexo-docs/archives/"><div class="headline">文章</div><div class="length-num">25</div></a><a href="/hexo-docs/tags/"><div class="headline">标签</div><div class="length-num">13</div></a><a href="/hexo-docs/categories/"><div class="headline">分类</div><div class="length-num">9</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/hexo-docs/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa fa-graduation-cap"></i><span> 博文</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/hexo-docs/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/hexo-docs/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/hexo-docs/comment/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/hexo-docs/about"><i class="fa-fw fas fa-heart"></i><span> 关于笔者</span></a></div></div></div></div><div class="post type-categories" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://docs.langchain4j.info/img/logo.svg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/hexo-docs/"><span class="site-name">Lazy的个人博客</span></a><a class="nav-page-title" href="/hexo-docs/"><span class="site-name">LangChain4j</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  返回首页</span></span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/hexo-docs/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa fa-graduation-cap"></i><span> 博文</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/hexo-docs/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/hexo-docs/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/hexo-docs/comment/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/hexo-docs/about"><i class="fa-fw fas fa-heart"></i><span> 关于笔者</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">LangChain4j</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-08-12T16:00:00.000Z" title="发表于 2025-08-13 00:00:00">2025-08-13</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-08-24T10:20:41.822Z" title="更新于 2025-08-24 18:20:41">2025-08-24</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/hexo-docs/categories/%E5%90%8E%E7%AB%AF-AI/">后端 AI</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">24.6k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>113分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="LangChain4j"><a href="#LangChain4j" class="headerlink" title="LangChain4j"></a>LangChain4j</h1><h2 id="理论概述"><a href="#理论概述" class="headerlink" title="理论概述"></a>理论概述</h2><h3 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h3><p>LangChain4j 等价于 LangChain For Java</p>
<p>LangChain4j 的目标是简化将 LLM 集成到 Java 应用程序中的过程。</p>
<p>具体方式如下：</p>
<ol>
<li><strong>统一 API：</strong> LLM 提供商（如 OpenAI 或 Google Vertex AI）和嵌入（向量）存储（如 Pinecone 或 Milvus） 使用专有 API。LangChain4j 提供统一的 API，避免了学习和实现每个特定 API 的需求。 要尝试不同的 LLM 或嵌入存储，您可以在它们之间轻松切换，无需重写代码。 LangChain4j 目前支持 <a target="_blank" rel="noopener" href="https://docs.langchain4j.info/integrations/language-models/">15+ 个流行的 LLM 提供商</a> 和 <a target="_blank" rel="noopener" href="https://docs.langchain4j.info/integrations/embedding-stores/">20+ 个嵌入存储</a>。</li>
<li><strong>全面的工具箱：</strong> 自 2023 年初以来，社区一直在构建众多 LLM 驱动的应用程序， 识别常见的抽象、模式和技术。LangChain4j 将这些提炼成一个即用型包。 我们的工具箱包含从低级提示模板、聊天记忆管理和函数调用 到高级模式如代理和 RAG 的工具。 对于每个抽象，我们提供一个接口以及基于常见技术的多个即用型实现。 无论您是在构建聊天机器人还是开发包含从数据摄取到检索完整管道的 RAG， LangChain4j 都提供多种选择。</li>
<li><strong>丰富的示例：</strong> 这些<a target="_blank" rel="noopener" href="https://github.com/langchain4j/langchain4j-examples">示例</a>展示了如何开始创建各种 LLM 驱动的应用程序， 提供灵感并使您能够快速开始构建。</li>
</ol>
<p>LangChain4j 始于 2023 年初 ChatGPT 热潮期间。 我们注意到与众多 Python 和 JavaScript LLM 库和框架相比，缺少 Java 对应物， 我们必须解决这个问题！ 虽然我们的名字中有”LangChain”，但该项目是 LangChain、Haystack、 LlamaIndex 和更广泛社区的想法和概念的融合，并加入了我们自己的创新。</p>
<p>我们积极关注社区发展，旨在快速整合新技术和集成， 确保您保持最新状态。 该库正在积极开发中。虽然一些功能仍在开发中， 但核心功能已经就位，让您现在就可以开始构建 LLM 驱动的应用程序！</p>
<p>为了更容易集成，LangChain4j 还包括与 <a target="_blank" rel="noopener" href="https://docs.langchain4j.info/tutorials/quarkus-integration">Quarkus</a> 和 <a target="_blank" rel="noopener" href="https://docs.langchain4j.info/tutorials/spring-boot-integration">Spring Boot</a> 的集成。</p>
<p>AB法则（Before | After）</p>
<p>随着人工智能（AI）技术的迅猛发展，越来越多的开发者开始将目光投向AI应用的开发。然而，目前市场上大多数AI框架和工具如LangChain、PyTorch等主要支持Python，而Java开发者常常面临工具缺乏和学习门槛较高的问题，但是不用担心，谁让Java&#x2F;Spring群体强大那？，O(∩_∩)O</p>
<p>任何一个框架&#x2F;XXX云服务器，想要大面积推广，应该不会忘记庞大的Spring社区和Java程序员</p>
<p>Before（没有 LangChain4j 之前）</p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250724185120589.png" alt="image-20250724185120589"></p>
<p>各干各的</p>
<p>After（有 LangChain4j 之后）</p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250724185201404.png" alt="image-20250724185201404"></p>
<p>官网</p>
<ul>
<li>中文：<a target="_blank" rel="noopener" href="https://docs.langchain4j.info/">https://docs.langchain4j.info/</a></li>
<li>英文：<a target="_blank" rel="noopener" href="https://docs.langchain4j.dev/">https://docs.langchain4j.dev/</a></li>
</ul>
<h3 id="能干嘛"><a href="#能干嘛" class="headerlink" title="能干嘛"></a>能干嘛</h3><p>LLM 大模型能干嘛</p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250724185519361.png" alt="image-20250724185519361"></p>
<ul>
<li>controller</li>
<li>service</li>
<li>dao&#x2F;mapper</li>
</ul>
<p>LLM 大模型应用技术架构</p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250724185558979.png" alt="image-20250724185558979"></p>
<h3 id="去哪下"><a href="#去哪下" class="headerlink" title="去哪下"></a>去哪下</h3><ul>
<li>英文：<a target="_blank" rel="noopener" href="https://docs.langchain4j.dev/get-started">https://docs.langchain4j.dev/get-started</a></li>
<li>中文：<a target="_blank" rel="noopener" href="https://docs.langchain4j.info/get-started">https://docs.langchain4j.info/get-started</a></li>
</ul>
<h3 id="怎么玩"><a href="#怎么玩" class="headerlink" title="怎么玩"></a>怎么玩</h3><p>大模型开发分类</p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250725183517344.png" alt="image-20250725183517344"></p>
<p>产品定位</p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250725183538316.png" alt="image-20250725183538316"></p>
<h2 id="永远的HelloWorld"><a href="#永远的HelloWorld" class="headerlink" title="永远的HelloWorld"></a>永远的HelloWorld</h2><h3 id="前置约定"><a href="#前置约定" class="headerlink" title="前置约定"></a>前置约定</h3><p>LangChain4j支持的各种大模型语言模型（LLMS）</p>
<ul>
<li>中文：<a target="_blank" rel="noopener" href="https://docs.langchain4j.info/integrations/language-models">https://docs.langchain4j.info/integrations/language-models</a></li>
<li>英文：<a target="_blank" rel="noopener" href="https://docs.langchain4j.dev/integrations/language-models">https://docs.langchain4j.dev/integrations/language-models</a></li>
</ul>
<p>本次以阿里百炼平台（通义千问）为主并辅以DeepSeek模型</p>
<p>配置门道和关键点</p>
<ul>
<li>所有调用均基于 OpenAI 协议或者 SpringBoot 官方推荐整合规则，实现一致的接口设计与规范，确保了多模型切换的便利性，提供高度可拓展的开发支持</li>
</ul>
<h3 id="阿里云百炼平台入口"><a href="#阿里云百炼平台入口" class="headerlink" title="阿里云百炼平台入口"></a>阿里云百炼平台入口</h3><p>接入阿里百炼平台的通义模型：<a target="_blank" rel="noopener" href="https://bailian.console.aliyun.com/">https://bailian.console.aliyun.com</a></p>
<p>大模型调用三件套</p>
<ol>
<li><p>获得 api-key</p>
<p>先登录并创建API-key</p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250726174346286.png" alt="image-20250726174346286"></p>
<p>选择想要的模型，点击查看详情</p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250726174411279.png" alt="image-20250726174411279"></p>
</li>
<li><p>获得模型名</p>
<p>点击模型广场，点击想要的模型，点击查看详情</p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250726174411279.png" alt="image-20250726174411279"></p>
<p>选择你想要的模型复制下来</p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250726174543338.png" alt="image-20250726174543338"></p>
<p>例如：模型名：<code>qwen-plus</code></p>
</li>
<li><p>获得 baseUrl 开发地址</p>
<p>点击查看api参考</p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250726174810710.png" alt="image-20250726174810710"></p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250726174840160.png" alt="image-20250726174840160"></p>
</li>
</ol>
<p>假设你要换一个模型实例</p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250726175149199.png" alt="image-20250726175149199"></p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><ul>
<li><p>API Key</p>
<p>sk-xxx 你自己的 API Key</p>
</li>
<li><p>模型名</p>
<p>qwen-plus</p>
</li>
<li><p>调用地址</p>
<p>使用 SDK 调用时需配置的 base_url：<a target="_blank" rel="noopener" href="https://dashscope.aliyuncs.com/compatible-mode/v1">https://dashscope.aliyuncs.com/compatible-mode/v1</a></p>
</li>
</ul>
<h3 id="IDEA-工具中建-project-父工程"><a href="#IDEA-工具中建-project-父工程" class="headerlink" title="IDEA 工具中建 project 父工程"></a>IDEA 工具中建 project 父工程</h3><p>LangChain4j</p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250726175820182.png" alt="image-20250726175820182"></p>
<p><code>pom</code></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.lazy<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>LangChain4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>LangChain4j父工程<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://maven.apache.org<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">project.reporting.outputEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.reporting.outputEncoding</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>17<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>17<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>17<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Spring Boot --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">spring-boot.version</span>&gt;</span>3.5.0<span class="tag">&lt;/<span class="name">spring-boot.version</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Spring AI --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">spring-ai.version</span>&gt;</span>1.0.0<span class="tag">&lt;/<span class="name">spring-ai.version</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Spring AI Alibaba --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">spring-ai-alibaba.version</span>&gt;</span>1.0.0-M6.1<span class="tag">&lt;/<span class="name">spring-ai-alibaba.version</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- langchain4j --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">langchain4j.version</span>&gt;</span>1.0.1<span class="tag">&lt;/<span class="name">langchain4j.version</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--langchain4j-community 引入阿里云百炼平台依赖管理清单--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">langchain4j-community.version</span>&gt;</span>1.0.1-beta6<span class="tag">&lt;/<span class="name">langchain4j-community.version</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- maven plugin --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven-deploy-plugin.version</span>&gt;</span>3.1.1<span class="tag">&lt;/<span class="name">maven-deploy-plugin.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">flatten-maven-plugin.version</span>&gt;</span>1.3.0<span class="tag">&lt;/<span class="name">flatten-maven-plugin.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven-compiler-plugin.version</span>&gt;</span>3.8.1<span class="tag">&lt;/<span class="name">maven-compiler-plugin.version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- Spring Boot --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring-boot.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- Spring AI --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.ai<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-ai-bom<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring-ai.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- Spring AI Alibaba --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud.ai<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-ai-alibaba-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring-ai-alibaba.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!--langchain4j的依赖清单，加载BOM后所有langchain4j版本号可以被统一管理起来</span></span><br><span class="line"><span class="comment">      https://docs.langchain4j.dev/get-started</span></span><br><span class="line"><span class="comment">      --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>dev.langchain4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>langchain4j-bom<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;langchain4j.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!--引入阿里云百炼平台依赖管理清单</span></span><br><span class="line"><span class="comment">     https://docs.langchain4j.dev/integrations/language-models/dashscope</span></span><br><span class="line"><span class="comment">     --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>dev.langchain4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>langchain4j-community-bom<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;langchain4j-community.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring-boot.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-deploy-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;maven-deploy-plugin.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">skip</span>&gt;</span>true<span class="tag">&lt;/<span class="name">skip</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;maven-compiler-plugin.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">release</span>&gt;</span>$&#123;java.version&#125;<span class="tag">&lt;/<span class="name">release</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">compilerArgs</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">compilerArg</span>&gt;</span>-parameters<span class="tag">&lt;/<span class="name">compilerArg</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">compilerArgs</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.codehaus.mojo<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>flatten-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;flatten-maven-plugin.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">inherited</span>&gt;</span>true<span class="tag">&lt;/<span class="name">inherited</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>flatten<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">phase</span>&gt;</span>process-resources<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">goal</span>&gt;</span>flatten<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">updatePomFile</span>&gt;</span>true<span class="tag">&lt;/<span class="name">updatePomFile</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">flattenMode</span>&gt;</span>ossrh<span class="tag">&lt;/<span class="name">flattenMode</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">pomElements</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">distributionManagement</span>&gt;</span>remove<span class="tag">&lt;/<span class="name">distributionManagement</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span>remove<span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">repositories</span>&gt;</span>remove<span class="tag">&lt;/<span class="name">repositories</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">scm</span>&gt;</span>keep<span class="tag">&lt;/<span class="name">scm</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">url</span>&gt;</span>keep<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">organization</span>&gt;</span>resolve<span class="tag">&lt;/<span class="name">organization</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">pomElements</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>flatten.clean<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">phase</span>&gt;</span>clean<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">goal</span>&gt;</span>clean<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">repositories</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span>&gt;</span>spring-milestones<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">name</span>&gt;</span>Spring Milestones<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">url</span>&gt;</span>https://repo.spring.io/milestone<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>false<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span>&gt;</span>spring-snapshots<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">name</span>&gt;</span>Spring Snapshots<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">url</span>&gt;</span>https://repo.spring.io/snapshot<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">releases</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>false<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">releases</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span>&gt;</span>aliyunmaven<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">name</span>&gt;</span>aliyun<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">url</span>&gt;</span>https://maven.aliyun.com/repository/public<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">repositories</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">pluginRepositories</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">pluginRepository</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span>&gt;</span>public<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">name</span>&gt;</span>aliyun nexus<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">url</span>&gt;</span>https://maven.aliyun.com/repository/public<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">releases</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">releases</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>false<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">pluginRepository</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">pluginRepositories</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="/hexo-docs/images/LangChain4jImages/image-20250726181619866.png" alt="image-20250726181619866"></p>
<p><code>创建一个子maven项目</code>：<code>LangChain4j-helloWorld</code></p>
<p>改<code>pom</code></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.lazy<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>LangChain4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>LangChain4j入门案例之HelloWorld<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>LangChain4j-helloWorld<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>17<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>17<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--langchain4j-open-ai 基础--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--所有调用均基于 OpenAI 协议标准，实现一致的接口设计与规范LangChain4j 提供与许多 LLM 提供商的集成</span></span><br><span class="line"><span class="comment">        从最简单的开始方式是从 OpenAI 集成开始https://docs.langchain4j.dev/get-started    --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>dev.langchain4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>langchain4j-open-ai<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--langchain4j 高阶--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>dev.langchain4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>langchain4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--lombok--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--test--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="/hexo-docs/images/LangChain4jImages/image-20250726180458415.png" alt="image-20250726180458415"></p>
<p><code>yaml</code></p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">9001</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">LangChain4j-helloWorld</span></span><br></pre></td></tr></table></figure>

<p>业务类</p>
<ul>
<li><p>ApiKey不建议明文，需配置进环境变量</p>
<ul>
<li><p>修改环境变量</p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250726181133054.png" alt="image-20250726181133054"></p>
</li>
</ul>
</li>
<li><p>以防不生效，建议重启IDEA</p>
</li>
<li><p>如果遇到这种情况，重启电脑试试</p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250726182712048.png" alt="image-20250726182712048"></p>
</li>
</ul>
<p>LLMConfig</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lazy.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.model.chat.ChatModel;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.model.openai.OpenAiChatModel;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LLMConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ChatModel <span class="title function_">chatModelQWen</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> OpenAiChatModel.builder()</span><br><span class="line">                .apiKey(System.getenv(<span class="string">&quot;aliQWen-api&quot;</span>))<span class="comment">//从系统环境变量获得key</span></span><br><span class="line">                .modelName(<span class="string">&quot;qwen-plus&quot;</span>)<span class="comment">//模型名称</span></span><br><span class="line">                .baseUrl(<span class="string">&quot;https://dashscope.aliyuncs.com/compatible-mode/v1&quot;</span>)<span class="comment">//模型接口地址</span></span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/hexo-docs/images/LangChain4jImages/image-20250726181642117.png" alt="image-20250726181642117"></p>
<p>HelloLangChainController</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lazy.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.model.chat.ChatModel;</span><br><span class="line"><span class="keyword">import</span> jakarta.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloLangChainController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> ChatModel chatModelQWen;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/langchain4j/hello&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">hello</span><span class="params">(<span class="meta">@RequestParam(value = &quot;question&quot;,defaultValue = &quot;你是谁？&quot;)</span> String question)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> chatModelQWen.chat(question);</span><br><span class="line">        System.out.println(<span class="string">&quot;通过LangChain4j调用QWen返回结果：&quot;</span>+result);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><p><img src="/hexo-docs/images/LangChain4jImages/image-20250726183121805.png" alt="image-20250726183121805"></p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250726183235487.png" alt="image-20250726183235487"></p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250726183301694.png" alt="image-20250726183301694"></p>
<h3 id="如何同时存在多种大模型在系统里共存使用？"><a href="#如何同时存在多种大模型在系统里共存使用？" class="headerlink" title="如何同时存在多种大模型在系统里共存使用？"></a>如何同时存在多种大模型在系统里共存使用？</h3><h4 id="DeepSeek-API-文档"><a href="#DeepSeek-API-文档" class="headerlink" title="DeepSeek API 文档"></a>DeepSeek API 文档</h4><p><a target="_blank" rel="noopener" href="https://platform.deepseek.com/usage">https://platform.deepseek.com/usage</a></p>
<p>API 文档：<a target="_blank" rel="noopener" href="https://api-docs.deepseek.com/zh-cn/">https://api-docs.deepseek.com/zh-cn/</a></p>
<p>如果没有申请 API-key 先申请 api-key</p>
<ul>
<li><p>申请地址</p>
<p><a target="_blank" rel="noopener" href="https://platform.deepseek.com/usage">https://platform.deepseek.com/usage</a></p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250727170513864.png" alt="image-20250727170513864"></p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250727170536223.png" alt="image-20250727170536223"></p>
<p>如果申请成功了，跟上述那个一样把api-key配置到环境变量里面</p>
</li>
</ul>
<p>大模型调用三件套</p>
<ul>
<li><p>获得 Api-key</p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250727170829705.png" alt="image-20250727170829705"></p>
</li>
<li><p>获得模型名</p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250727170919576.png" alt="image-20250727170919576"></p>
</li>
<li><p>获得 baseUrl 开发地址</p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250727170957194.png" alt="image-20250727170957194"></p>
</li>
</ul>
<blockquote>
<p>备注：</p>
<p>​	通过指定 <code>model=&#39;deepseek-chat&#39;</code>  即可调用 DeepSeek-V3 （普通）</p>
<p>​	通过指定 <code>model=&#39;deepseek-reasoner&#39;</code>即可调用 DeepSeek-R1（深度）。</p>
</blockquote>
<h4 id="多模型共存使用"><a href="#多模型共存使用" class="headerlink" title="多模型共存使用"></a>多模型共存使用</h4><p>新建<code>module</code></p>
<p><code>LangChain4j-02multi-model-together</code></p>
<p><code>pom</code></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--langchain4j-open-ai 基础--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--所有调用均基于 OpenAI 协议标准，实现一致的接口设计与规范LangChain4j 提供与许多 LLM 提供商的集成</span></span><br><span class="line"><span class="comment">    从最简单的开始方式是从 OpenAI 集成开始https://docs.langchain4j.dev/get-started    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>dev.langchain4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>langchain4j-open-ai<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--langchain4j 高阶--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>dev.langchain4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>langchain4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--lombok--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--test--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>yaml</code></p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">9002</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">LangChain4j-02multi-model-together</span></span><br></pre></td></tr></table></figure>

<p>业务类</p>
<p><code>LLMConfig</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lazy.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.model.chat.ChatModel;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.model.openai.OpenAiChatModel;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LLMConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(name = &quot;QWen&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ChatModel <span class="title function_">chatModelQWen</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> OpenAiChatModel.builder()</span><br><span class="line">                .apiKey(System.getenv(<span class="string">&quot;aliQWen-api&quot;</span>))<span class="comment">//从系统环境变量获得key</span></span><br><span class="line">                .modelName(<span class="string">&quot;qwen-plus&quot;</span>)<span class="comment">//模型名称</span></span><br><span class="line">                .baseUrl(<span class="string">&quot;https://dashscope.aliyuncs.com/compatible-mode/v1&quot;</span>)<span class="comment">//模型接口地址</span></span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(name = &quot;DeepSeek&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ChatModel <span class="title function_">chatModelDeepSeek</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> OpenAiChatModel.builder()</span><br><span class="line">                .apiKey(System.getenv(<span class="string">&quot;deepseek-api&quot;</span>))</span><br><span class="line">                .modelName(<span class="string">&quot;deepseek-chat&quot;</span>)</span><br><span class="line">                <span class="comment">//.modelName(&quot;deepseek-reasoner&quot;) //深度思考</span></span><br><span class="line">                .baseUrl(<span class="string">&quot;https://api.deepseek.com/v1&quot;</span>)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/hexo-docs/images/LangChain4jImages/image-20250727172227837.png" alt="image-20250727172227837"></p>
<p><code>MultiModelController</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lazy.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.model.chat.ChatModel;</span><br><span class="line"><span class="keyword">import</span> jakarta.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MultiModelController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource(name = &quot;QWen&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> ChatModel chatModelQWen;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource(name = &quot;DeepSeek&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> ChatModel chatModelDeepSeek;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/multimodel/qwen&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">QWen</span><span class="params">(<span class="meta">@RequestParam(name = &quot;prompt&quot;,defaultValue = &quot;你是谁&quot;)</span> String prompt)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">chatQWen</span> <span class="operator">=</span> chatModelQWen.chat(prompt);</span><br><span class="line">        System.out.println(<span class="string">&quot;模型返回结果：\t&quot;</span>+chatQWen);</span><br><span class="line">        <span class="keyword">return</span> chatQWen;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/multimodel/deepseek&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">DeepSeek</span><span class="params">(<span class="meta">@RequestParam(name = &quot;prompt&quot;,defaultValue = &quot;你是谁&quot;)</span> String prompt)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">chatDeepSeek</span> <span class="operator">=</span> chatModelDeepSeek.chat(prompt);</span><br><span class="line">        System.out.println(<span class="string">&quot;模型返回结果：\t&quot;</span>+chatDeepSeek);</span><br><span class="line">        <span class="keyword">return</span> chatDeepSeek;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>启动项目，测试！</p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250727172904730.png" alt="image-20250727172904730"></p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250727172945597.png" alt="image-20250727172945597"></p>
<p>访问deepseek报错了，重启试试</p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250727173310184.png" alt="image-20250727173310184"></p>
<p>我们充点钱再试试！</p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250727174049537.png" alt="image-20250727174049537"></p>
<h2 id="原生整合和SpringBoot整合"><a href="#原生整合和SpringBoot整合" class="headerlink" title="原生整合和SpringBoot整合"></a>原生整合和SpringBoot整合</h2><p>官网</p>
<ul>
<li>中文：<code>https://docs.langchain4j.info/tutorials/spring-boot-integration</code></li>
<li>英文：<code>https://docs.langchain4j.dev/tutorials/spring-boot-integration</code></li>
</ul>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250727175750576.png" alt="image-20250727175750576"></p>
<ul>
<li><p>低阶 api VS 高阶 api</p>
<ul>
<li><p>SpringBoot 整合低阶 api 所需要的 <code>pom</code></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>dev.langchain4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>langchain4j-open-ai-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0-beta3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="/hexo-docs/images/LangChain4jImages/image-20250727175946749.png" alt="image-20250727175946749"></p>
</li>
<li><p>SpringBoot 整合高阶 api 所需要的 <code>pom</code></p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250727180214932.png" alt="image-20250727180214932"></p>
</li>
<li><p>总结<br><img src="/hexo-docs/images/LangChain4jImages/image-20250727180250524.png" alt="image-20250727180250524"></p>
</li>
</ul>
</li>
</ul>
<h3 id="LangChain4j-原生-VS-LangChain4j-Boot整合"><a href="#LangChain4j-原生-VS-LangChain4j-Boot整合" class="headerlink" title="LangChain4j 原生 VS LangChain4j-Boot整合"></a>LangChain4j 原生 VS LangChain4j-Boot整合</h3><ul>
<li><p>LangChain4j 原生整合</p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250727180515893.png" alt="image-20250727180515893"></p>
<p>LangChain4j-Boot整合</p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250727180543192.png" alt="image-20250727180543192"></p>
<p>总结</p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250727180250524.png" alt="image-20250727180250524"></p>
<p>LangChain4j 原生集成与使用 <strong>LangChain4j-Boot</strong>（Spring Boot Starter）进行整合的主要区别在于 <strong>易用性、配置管理、自动装配和与 Spring 生态的集成深度</strong>。以下是详细对比：</p>
<ol>
<li><strong>依赖管理</strong></li>
</ol>
<ul>
<li><p><strong>原生 LangChain4j</strong>：</p>
<ul>
<li><p>需手动添加核心库及模型提供者（如 OpenAI、HuggingFace）的依赖。</p>
</li>
<li><p>示例 Maven 依赖：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>dev.langchain4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>langchain4j-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.31.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>dev.langchain4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>langchain4j-open-ai<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.31.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong>LangChain4j-Boot</strong>：</p>
<ul>
<li><p>通过单一 Starter 依赖自动引入核心库和常用模块。</p>
</li>
<li><p>示例：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.github.microutils<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>langchain4j-boot-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span> <span class="comment">&lt;!-- 版本可能变化 --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<ol start="2">
<li><strong>配置方式</strong></li>
</ol>
<ul>
<li><p><strong>原生 LangChain4j</strong>：</p>
<ul>
<li><p>手动编码创建组件（如 <code>OpenAiChatModel</code>），需硬编码 API Key 或自行管理配置。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">OpenAiChatModel</span> <span class="variable">model</span> <span class="operator">=</span> OpenAiChatModel.builder()</span><br><span class="line">    .apiKey(<span class="string">&quot;sk-...&quot;</span>)</span><br><span class="line">    .modelName(<span class="string">&quot;gpt-4&quot;</span>)</span><br><span class="line">    .build();</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong>LangChain4j-Boot</strong>：</p>
<ul>
<li><p>通过 <code>application.yml</code>&#x2F;<code>application.properties</code> <strong>集中配置</strong>，支持多模型切换。</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">langchain4j:</span></span><br><span class="line">  <span class="attr">openai:</span></span><br><span class="line">    <span class="attr">api-key:</span> <span class="string">$&#123;OPENAI_API_KEY&#125;</span></span><br><span class="line">    <span class="attr">model:</span> <span class="string">gpt-4-turbo</span></span><br><span class="line">  <span class="attr">huggingface:</span></span><br><span class="line">    <span class="attr">api-key:</span> <span class="string">$&#123;HF_API_KEY&#125;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>自动注入 Bean，无需手动构建：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> ChatModel chatModel; <span class="comment">// 根据配置自动选择 OpenAI/HuggingFace</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
</li>
</ul>
<ol start="3">
<li><strong>自动装配与扩展</strong></li>
</ol>
<ul>
<li><p><strong>原生 LangChain4j</strong>：</p>
<ul>
<li>需自行管理组件生命周期（如注入 <code>ChatMemory</code>、<code>Tool</code>）。<ul>
<li>需手动集成 Spring（如通过 <code>@Bean</code> 工厂方法）。</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>LangChain4j-Boot</strong>：</p>
<ul>
<li><p><strong>自动装配</strong>：根据配置创建 <code>ChatModel</code>、<code>EmbeddingModel</code> 等 Bean。</p>
</li>
<li><p><strong>工具集成</strong>：自动扫描 <code>@Tool</code> 注解的 Bean 并注入 <code>AiServices</code>。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Tool(&quot;查询用户信息&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getUserEmail</span><span class="params">(String username)</span> &#123; ... &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>对话内存</strong>：自动配置 <code>ChatMemory</code>（如 <code>InMemoryChatMemory</code>）并关联会话。</li>
</ul>
</li>
</ul>
</li>
</ul>
<ol start="4">
<li><strong>Spring 生态集成</strong></li>
</ol>
<ul>
<li><p><strong>原生 LangChain4j</strong>：</p>
<ul>
<li>与 Spring 无深度整合，需自行实现：<ul>
<li>配置绑定（如 <code>@ConfigurationProperties</code>）。</li>
<li>异常处理、健康检查。</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>LangChain4j-Boot</strong>：</p>
<ul>
<li><p><strong>配置绑定</strong>：通过 <code>@ConfigurationProperties</code> 映射配置项。</p>
</li>
<li><p><strong>健康检查</strong>：提供 <code>/health</code> 端点验证模型连接状态。</p>
</li>
<li><p><strong>AOP 支持</strong>：通过注解管理对话上下文（如 <code>@MemoryId</code> 标识用户会话）：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ChatService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span> <span class="keyword">private</span> Assistant assistant;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">chat</span><span class="params">(String userId, String message)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> assistant.chat(userId, message); <span class="comment">// 自动关联 userId 的对话历史</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<ol start="5">
<li><strong>生产就绪特性</strong></li>
</ol>
<ul>
<li><strong>LangChain4j-Boot</strong> 额外提供：<ul>
<li><strong>监控指标</strong>：集成 Micrometer 统计 Token 使用量、延迟等。</li>
<li><strong>异常处理</strong>：统一处理模型调用异常（如 <code>ModelNotFoundException</code>）。</li>
<li><strong>多模型切换</strong>：通过配置动态切换模型（如测试用 OpenAI，生产用 Azure OpenAI）。</li>
</ul>
</li>
</ul>
<ol start="6">
<li><strong>代码简洁性对比</strong></li>
</ol>
<ul>
<li><p><strong>原生实现示例</strong>（手动管理依赖和配置）：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> ChatModel <span class="title function_">openAiChatModel</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> OpenAiChatModel.builder()</span><br><span class="line">            .apiKey(env.getProperty(<span class="string">&quot;openai.api-key&quot;</span>))</span><br><span class="line">            .modelName(<span class="string">&quot;gpt-4&quot;</span>)</span><br><span class="line">            .build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>LangChain4j-Boot 实现</strong>（零配置）：</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAssistant</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span> <span class="keyword">private</span> ChatModel chatModel; <span class="comment">// 自动注入</span></span><br><span class="line">   </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">answer</span><span class="params">(String question)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> chatModel.generate(question);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<p>总结：如何选择？</p>
<table>
<thead>
<tr>
<th align="left"><strong>场景</strong></th>
<th align="left"><strong>推荐方式</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="left">快速原型验证、小型项目</td>
<td align="left">原生 LangChain4j</td>
</tr>
<tr>
<td align="left">Spring Boot 项目，需生产部署</td>
<td align="left">LangChain4j-Boot</td>
</tr>
<tr>
<td align="left">需要动态配置&#x2F;多模型支持</td>
<td align="left">LangChain4j-Boot</td>
</tr>
<tr>
<td align="left">深度集成 Spring 生态（AOP、监控）</td>
<td align="left">LangChain4j-Boot</td>
</tr>
</tbody></table>
<blockquote>
<p><strong>LangChain4j-Boot 的本质</strong>：通过 Spring Boot Starter 机制封装原生 LangChain4j，提供<strong>自动配置、依赖管理、生态集成</strong>，显著提升开发效率，降低样板代码量。</p>
</blockquote>
<h3 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h3><p>建<code>module</code>：<code>LangChain4j-03boot-integration</code></p>
<p><code>pom</code></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>17<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>17<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--langchain4j原生 基础--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>dev.langchain4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>langchain4j-open-ai<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--langchain4j原生 高阶--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>dev.langchain4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>langchain4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--1 LangChain4j 整合boot底层支持--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--   https://docs.langchain4j.dev/tutorials/spring-boot-integration  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>dev.langchain4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>langchain4j-open-ai-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--2 LangChain4j 整合boot高阶支持--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>dev.langchain4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>langchain4j-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--lombok--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--test--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>低阶api</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lazy.controller;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.model.chat.ChatModel;</span><br><span class="line"><span class="keyword">import</span> jakarta.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PopularIntegrationController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> ChatModel chatModelQWen;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/langchain4j/chat&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">chatQWen</span><span class="params">(<span class="meta">@RequestParam(value = &quot;prompt&quot;,defaultValue = &quot;你是谁&quot;)</span> String prompt)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> chatModelQWen.chat(prompt);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试</p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250728175234465.png" alt="image-20250728175234465"></p>
<p>高阶api</p>
<p><code>ChatAssistantService</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lazy.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.service.spring.AiService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@AiService</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ChatAssistantService</span> &#123;</span><br><span class="line"></span><br><span class="line">    String <span class="title function_">chat</span><span class="params">(String prompt)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>DeclarativeAIController</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lazy.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.lazy.service.ChatAssistantService;</span><br><span class="line"><span class="keyword">import</span> jakarta.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DeclarativeAIController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> ChatAssistantService chatAssistantService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/declarative/chat&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">declarativeChat</span><span class="params">(<span class="meta">@RequestParam(value = &quot;prompt&quot;,defaultValue = &quot;你是谁&quot;)</span> String prompt)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> chatAssistantService.chat(prompt);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试</p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250728175842671.png" alt="image-20250728175842671"></p>
<p>高阶api集成官网解释</p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250728175932197.png" alt="image-20250728175932197"></p>
<h2 id="低阶和高阶API"><a href="#低阶和高阶API" class="headerlink" title="低阶和高阶API"></a>低阶和高阶API</h2><h3 id="LangChain4j在两个抽象层提供不同的api"><a href="#LangChain4j在两个抽象层提供不同的api" class="headerlink" title="LangChain4j在两个抽象层提供不同的api"></a>LangChain4j在两个抽象层提供不同的api</h3><p><img src="/hexo-docs/images/LangChain4jImages/image-20250728181931183.png" alt="image-20250728181931183"></p>
<h4 id="低阶api"><a href="#低阶api" class="headerlink" title="低阶api"></a>低阶api</h4><p>如 <a target="_blank" rel="noopener" href="https://docs.langchain4j.info/tutorials/chat-and-language-models">ChatLanguageModel</a>、<code>UserMessage</code>、<code>AiMessage</code>、<code>EmbeddingStore</code>、<code>Embedding</code> 等</p>
<p>优点：是可以自由组合适宜于各个组件但编码量高</p>
<ul>
<li><p>ChatModel</p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250728182226123.png" alt="image-20250728182226123"></p>
<ul>
<li><p>low-level（低阶api）模型api，提供各种chat方法用于对话，可以接受单个或多个消息</p>
</li>
<li><p>ChatModel 提供的一种极其简便的方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">default</span> String <span class="title function_">chat</span><span class="params">(String userMessage)</span> &#123;</span><br><span class="line">    <span class="type">ChatRequest</span> <span class="variable">chatRequest</span> <span class="operator">=</span> ChatRequest.builder()</span><br><span class="line">            .messages(UserMessage.from(userMessage))</span><br><span class="line">            .build();</span><br><span class="line"></span><br><span class="line">    <span class="type">ChatResponse</span> <span class="variable">chatResponse</span> <span class="operator">=</span> chat(chatRequest);</span><br><span class="line">    <span class="keyword">return</span> chatResponse.aiMessage().text();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@GetMapping(value = &quot;/langchain4j/hello&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">hello</span><span class="params">(<span class="meta">@RequestParam(value = &quot;prompt&quot;, defaultValue = &quot;你是谁&quot;)</span> String prompt)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> chatModel.chat(prompt);</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">&quot;通过langchain4j调用模型返回结果：\n&quot;</span>+result);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h4 id="高阶api"><a href="#高阶api" class="headerlink" title="高阶api"></a>高阶api</h4><p><img src="/hexo-docs/images/LangChain4jImages/image-20250728182606770.png" alt="image-20250728182606770"></p>
<ul>
<li>AiServices、Tools等</li>
<li>程序员自己定义接口，通过AiServices 类里面的方法实现，优点是api封装度比较高，减少了代码的复杂性，但仍可以进行灵活的微调</li>
</ul>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250728182945998.png" alt="image-20250728182945998"></p>
<p>创建由提供的聊天模型支持的 AI 服务（所提供接口的实现）。这种方便的方法可用于创建简单的 AI 服务。对于更复杂的情况，请使用 builder。</p>
<p>LangChian4j提供大模型接口、提示词模板、结构化输出、对话记忆、文档加载、文档分割、向量模型、向量存储等组件</p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250728183545824.png" alt="image-20250728183545824"></p>
<h3 id="代码案例"><a href="#代码案例" class="headerlink" title="代码案例"></a>代码案例</h3><h4 id="低阶api（token使用情况）"><a href="#低阶api（token使用情况）" class="headerlink" title="低阶api（token使用情况）"></a>低阶api（token使用情况）</h4><p>大模型中的 Token VS Web开发中的Token</p>
<ul>
<li><p>大模型中的token</p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250729175655254.png" alt="image-20250729175655254"></p>
</li>
<li><p>Web开发中的token</p>
<p>在web开发中，“token”通常指的是用于认证和授权的一种加密字符串。它被用来确保用户身份的安全验证，比如JWT（JSON Web Token）。这类token一般由服务器生成，并发给客户端保存（例如存储在浏览器的本地存储或cookie中），之后每次请求都需要携带这个token来证明用户的身份。</p>
</li>
<li><p>区别</p>
<ul>
<li>目的不同：大模型中的token是为了将文本分割成可处理的单元，便于进行计算；而web开发中的token主要用于安全地传递用户身份信息</li>
<li>生成方式不同：前者通过特定的算法（如BPE）对文本进行分割得到；后者则通常是通过加密算法生成的唯一字符串。</li>
<li>应用场景不同：前者应用于文本分析、机器翻译等NLP任务；后者多见于用户登录系统、API访问控制等领域。</li>
</ul>
</li>
</ul>
<p>新建<code>module</code>：<code>LangChain4j-04low-high-api</code></p>
<p><code>pom</code></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>dev.langchain4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>langchain4j-open-ai<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>dev.langchain4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>langchain4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>LLMConfig</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lazy.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.model.chat.ChatModel;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.model.openai.OpenAiChatModel;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LLMConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(name = &quot;QWen&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ChatModel <span class="title function_">chatModelQWen</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> OpenAiChatModel.builder()</span><br><span class="line">                .apiKey(System.getenv(<span class="string">&quot;aliQWen-api&quot;</span>))<span class="comment">//从系统环境变量获得key</span></span><br><span class="line">                .modelName(<span class="string">&quot;qwen-plus&quot;</span>)<span class="comment">//模型名称</span></span><br><span class="line">                .baseUrl(<span class="string">&quot;https://dashscope.aliyuncs.com/compatible-mode/v1&quot;</span>)<span class="comment">//模型接口地址</span></span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(name = &quot;DeepSeek&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ChatModel <span class="title function_">chatModelDeepSeek</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> OpenAiChatModel.builder()</span><br><span class="line">                .apiKey(System.getenv(<span class="string">&quot;deepseek-api&quot;</span>))</span><br><span class="line">                .modelName(<span class="string">&quot;deepseek-chat&quot;</span>)</span><br><span class="line">                <span class="comment">//.modelName(&quot;deepseek-reasoner&quot;) //深度思考</span></span><br><span class="line">                .baseUrl(<span class="string">&quot;https://api.deepseek.com/v1&quot;</span>)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>LowApiController</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lazy.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.data.message.UserMessage;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.model.chat.ChatModel;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.model.chat.response.ChatResponse;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.model.output.TokenUsage;</span><br><span class="line"><span class="keyword">import</span> jakarta.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LowApiController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource(name = &quot;DeepSeek&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> ChatModel chatModelQWen;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/lowapi/api&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">api</span><span class="params">(<span class="meta">@RequestParam(name = &quot;prompt&quot;, defaultValue = &quot;你是谁&quot;)</span> String prompt)</span> &#123;</span><br><span class="line">        <span class="type">ChatResponse</span> <span class="variable">chatResponse</span> <span class="operator">=</span> chatModelQWen.chat(UserMessage.userMessage(prompt));<span class="comment">//使用带返回结果的api</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">text</span> <span class="operator">=</span> chatResponse.aiMessage().text();</span><br><span class="line">        System.out.println(<span class="string">&quot;大模型调用返回结果：&quot;</span> + text);</span><br><span class="line">        <span class="type">TokenUsage</span> <span class="variable">token</span> <span class="operator">=</span> chatResponse.tokenUsage();</span><br><span class="line">        System.out.println(<span class="string">&quot;本次调用结果消耗的token：&quot;</span> + token);</span><br><span class="line">        <span class="keyword">return</span> text + <span class="string">&quot;\t\n&quot;</span> + token;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试</p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250729180254807.png" alt="image-20250729180254807"></p>
<h4 id="高阶api-1"><a href="#高阶api-1" class="headerlink" title="高阶api"></a>高阶api</h4><p><img src="/hexo-docs/images/LangChain4jImages/image-20250729182807600.png" alt="image-20250729182807600"></p>
<h5 id="AI-Service-是如何工作的？"><a href="#AI-Service-是如何工作的？" class="headerlink" title="AI Service 是如何工作的？"></a>AI Service 是如何工作的？</h5><p><img src="/hexo-docs/images/LangChain4jImages/image-20250729182854035.png" alt="image-20250729182854035"></p>
<p>配置</p>
<ol>
<li><p>定义 AI Service 接口</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lazy.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ChatAssistant</span> &#123;</span><br><span class="line">    String <span class="title function_">chat</span><span class="params">(String prompt)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>LLMConfig 类配置调用三件套</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lazy.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.model.chat.ChatModel;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.model.openai.OpenAiChatModel;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LLMConfig</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ChatModel <span class="title function_">chatModelQwen</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> OpenAiChatModel.builder()</span><br><span class="line">                        .apiKey(System.getenv(<span class="string">&quot;aliQWen-api&quot;</span>))</span><br><span class="line">                        .modelName(<span class="string">&quot;qwen-plus&quot;</span>)</span><br><span class="line">                        .baseUrl(<span class="string">&quot;https://dashscope.aliyuncs.com/compatible-mode/v1&quot;</span>)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li><p>AI Service 对应接口实现类落地</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lazy.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.atguigu.study.service.ChatAssistant;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.model.chat.ChatModel;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.model.openai.OpenAiChatModel;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.service.AiServices;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Qualifier;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@auther</span> zzyybs@126.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2025-05-27 22:04</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: 知识出处 https://docs.langchain4j.dev/get-started</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LLMConfig</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Bean(name = &quot;qwen&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ChatModel <span class="title function_">chatModelQwen</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> OpenAiChatModel.builder()</span><br><span class="line">                    .apiKey(System.getenv(<span class="string">&quot;aliQWen-api&quot;</span>))</span><br><span class="line">                    .modelName(<span class="string">&quot;qwen-plus&quot;</span>)</span><br><span class="line">                    .baseUrl(<span class="string">&quot;https://dashscope.aliyuncs.com/compatible-mode/v1&quot;</span>)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ChatAssistant</span>&#123;</span><br><span class="line">    String <span class="title function_">chat</span><span class="params">(String prompt)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ChatAssistant <span class="title function_">chatAssistant</span><span class="params">(<span class="meta">@Qualifier(&quot;qwen&quot;)</span> ChatModel chatModelQwen)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> AiServices.create(ChatAssistant.class, chatModelQwen);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<p><code>HighApiController</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lazy.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.lazy.service.ChatAssistant;</span><br><span class="line"><span class="keyword">import</span> jakarta.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HighApiController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> ChatAssistant chatAssistant;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/high/highapi&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">highApi</span><span class="params">(<span class="meta">@RequestParam(value = &quot;prompt&quot;,defaultValue = &quot;你是谁&quot;)</span> String prompt)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> chatAssistant.chat(prompt);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试</p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250729183709764.png" alt="image-20250729183709764"></p>
<blockquote>
<p>注意：</p>
<p>​	<code>@AiService</code> 注解是与SpringBoot整合的包才能使用，当前我们没有引用于SpringBoot整合的包，使用的是langchain4j原生的包，所以不能使用<code>@AiService</code>注解</p>
</blockquote>
<h2 id="模型参数配置"><a href="#模型参数配置" class="headerlink" title="模型参数配置"></a>模型参数配置</h2><p>官网：</p>
<ul>
<li>中文：<a target="_blank" rel="noopener" href="https://docs.langchain4j.info/tutorials/model-parameters">https://docs.langchain4j.info/tutorials/model-parameters</a></li>
<li>英文：<a target="_blank" rel="noopener" href="https://docs.langchain4j.dev/tutorials/model-parameters">https://docs.langchain4j.dev/tutorials/model-parameters</a></li>
</ul>
<p>建<code>module</code>：LangChain4j-05model-parameters</p>
<p><code>pom</code></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>17<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>17<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- langchain4j 基础 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>dev.langchain4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>langchain4j-open-ai<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- langchain4j 高阶 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>dev.langchain4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>langchain4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- hutool-all --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.hutool<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hutool-all<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>yaml</code></p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">9003</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">LangChain4j-05model-parameters</span></span><br></pre></td></tr></table></figure>

<p><code>LLMConfig</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lazy.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.model.chat.ChatModel;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.model.openai.OpenAiChatModel;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LLMConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ChatModel <span class="title function_">chatModelQWen</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> OpenAiChatModel.builder()</span><br><span class="line">                .apiKey(System.getenv(<span class="string">&quot;aliQWen-api&quot;</span>))<span class="comment">//从系统环境变量获得key</span></span><br><span class="line">                .modelName(<span class="string">&quot;qwen-plus&quot;</span>)<span class="comment">//模型名称</span></span><br><span class="line">                .baseUrl(<span class="string">&quot;https://dashscope.aliyuncs.com/compatible-mode/v1&quot;</span>)<span class="comment">//模型接口地址</span></span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>Controller</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lazy.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.model.chat.ChatModel;</span><br><span class="line"><span class="keyword">import</span> jakarta.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ModelParameterController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> ChatModel chatModel;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/modelparam/config&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">config</span><span class="params">(<span class="meta">@RequestParam(value = &quot;prompt&quot;,defaultValue = &quot;你是谁&quot;)</span> String prompt)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> chatModel.chat(prompt);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="日志配置（Logging）"><a href="#日志配置（Logging）" class="headerlink" title="日志配置（Logging）"></a>日志配置（Logging）</h3><p><code>https://docs.langchain4j.info/tutorials/logging</code></p>
<ol>
<li><p>引入日志包</p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250730164249220.png" alt="image-20250730164249220"></p>
</li>
<li><p>在<code>application.yaml</code>，开启日志</p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250730164408784.png" alt="image-20250730164408784"></p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">level:</span></span><br><span class="line">    <span class="attr">dev:</span></span><br><span class="line">      <span class="attr">langchain4j:</span> <span class="string">DEBUG</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>开启日志</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lazy.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.model.chat.ChatModel;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.model.openai.OpenAiChatModel;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LLMConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ChatModel <span class="title function_">chatModelQWen</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> OpenAiChatModel.builder()</span><br><span class="line">                .apiKey(System.getenv(<span class="string">&quot;aliQWen-api&quot;</span>))<span class="comment">//从系统环境变量获得key</span></span><br><span class="line">                .modelName(<span class="string">&quot;qwen-plus&quot;</span>)<span class="comment">//模型名称</span></span><br><span class="line">                .baseUrl(<span class="string">&quot;https://dashscope.aliyuncs.com/compatible-mode/v1&quot;</span>)<span class="comment">//模型接口地址</span></span><br><span class="line">                .logRequests(<span class="literal">true</span>) <span class="comment">//开启请求日志</span></span><br><span class="line">                .logResponses(<span class="literal">true</span>) <span class="comment">//开启响应日志</span></span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试</p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250730164745583.png" alt="image-20250730164745583"></p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250730164906389.png" alt="image-20250730164906389"></p>
</li>
</ol>
<h3 id="监控（observability）"><a href="#监控（observability）" class="headerlink" title="监控（observability）"></a>监控（observability）</h3><p><a target="_blank" rel="noopener" href="https://docs.langchain4j.info/tutorials/observability">https://docs.langchain4j.info/tutorials/observability</a></p>
<p><a target="_blank" rel="noopener" href="https://docs.langchain4j.info/integrations/language-models">某些</a> <code>ChatLanguageModel</code> 和 <code>StreamingChatLanguageModel</code> 的实现 （参见”可观测性”列）允许配置 <code>ChatModelListener</code>（多个）来监听事件，例如：</p>
<ul>
<li>向 LLM 发送的请求</li>
<li>来自 LLM 的响应</li>
<li>错误</li>
</ul>
<p>我们就可以定义监听器，来监听这些事件的发生，如果发生意外，好做及时的处理！</p>
<p>结论</p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250730174441031.png" alt="image-20250730174441031"></p>
<p>他是如何工作的？</p>
<ul>
<li>监听器被指定为 <code>List&lt;ChatModelListener&gt;</code>，并按照迭代顺序调用。</li>
<li>监听器同步调用，并在同一线程中调用。有关流式处理情况的更多详细信息，请参见下文。 第二个监听器直到第一个监听器返回后才会被调用。</li>
<li><code>ChatModelListener.onRequest()</code> 方法在调用 LLM 提供商 API 之前立即调用。</li>
<li><code>ChatModelListener.onRequest()</code> 方法每个请求只调用一次。 如果在调用 LLM 提供商 API 时发生错误并进行重试， <code>ChatModelListener.onRequest()</code> 将***不会***为每次重试调用。</li>
<li><code>ChatModelListener.onResponse()</code> 方法只调用一次， 在从 LLM 提供商收到成功响应后立即调用。</li>
<li><code>ChatModelListener.onError()</code> 方法只调用一次。 如果在调用 LLM 提供商 API 时发生错误并进行重试， <code>ChatModelListener.onError()</code> 将***不会***为每次重试调用。</li>
<li>如果从 <code>ChatModelListener</code> 方法之一抛出异常， 它将以 <code>WARN</code> 级别记录。后续监听器的执行将照常继续。</li>
<li>通过 <code>ChatModelRequestContext</code>、<code>ChatModelResponseContext</code> 和 <code>ChatModelErrorContext</code> 提供的 <code>ChatRequest</code> 是最终请求，包含在 <code>ChatLanguageModel</code> 上配置的默认 <code>ChatRequestParameters</code> 和特定于请求的 <code>ChatRequestParameters</code> 合并在一起。</li>
<li>对于 <code>StreamingChatLanguageModel</code>，<code>ChatModelListener.onResponse()</code> 和 <code>ChatModelListener.onError()</code> 在与 <code>ChatModelListener.onRequest()</code> 不同的线程上调用。 线程上下文目前不会自动传播，因此您可能希望使用 <code>attributes</code> 映射 从 <code>ChatModelListener.onRequest()</code> 传播任何必要的数据到 <code>ChatModelListener.onResponse()</code> 或 <code>ChatModelListener.onError()</code>。</li>
<li>对于 <code>StreamingChatLanguageModel</code>，<code>ChatModelListener.onResponse()</code> 在 <code>StreamingChatResponseHandler.onCompleteResponse()</code> 被调用之前调用。<code>ChatModelListener.onError()</code> 在 <code>StreamingChatResponseHandler.onError()</code> 被调用之前调用。</li>
</ul>
<h4 id="案例-1"><a href="#案例-1" class="headerlink" title="案例"></a>案例</h4><p>在上面的代码进行改造</p>
<p>创建一个<code>MyChatModelLinstener</code>监听器，并实现<code>ChatModelLinstener</code>接口</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lazy.listener;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.util.IdUtil;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.model.chat.listener.ChatModelErrorContext;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.model.chat.listener.ChatModelListener;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.model.chat.listener.ChatModelRequestContext;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.model.chat.listener.ChatModelResponseContext;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyChatModelListener</span> <span class="keyword">implements</span> <span class="title class_">ChatModelListener</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onRequest</span><span class="params">(ChatModelRequestContext requestContext)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">requestId</span> <span class="operator">=</span> IdUtil.simpleUUID();</span><br><span class="line">        requestContext.attributes().put(<span class="string">&quot;traceId&quot;</span>, requestId);</span><br><span class="line">        log.info(<span class="string">&quot;请求参数requestContext：&#123;&#125;&quot;</span>, requestContext+<span class="string">&quot;:&quot;</span>+requestId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onResponse</span><span class="params">(ChatModelResponseContext responseContext)</span> &#123;</span><br><span class="line">        <span class="type">Object</span> <span class="variable">traceId</span> <span class="operator">=</span> responseContext.attributes().get(<span class="string">&quot;traceId&quot;</span>);</span><br><span class="line">        log.info(<span class="string">&quot;返回结果responseContext:&#123;&#125;&quot;</span>,traceId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onError</span><span class="params">(ChatModelErrorContext errorContext)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;发生错误了errorContext:&#123;&#125;&quot;</span>,errorContext);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>将监听器，添加到大模型配置类里面</p>
<p><code>LLMConfig</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lazy.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.lazy.listener.MyChatModelListener;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.model.chat.ChatModel;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.model.openai.OpenAiChatModel;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LLMConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ChatModel <span class="title function_">chatModelQWen</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> OpenAiChatModel.builder()</span><br><span class="line">                .apiKey(System.getenv(<span class="string">&quot;aliQWen-api&quot;</span>))<span class="comment">//从系统环境变量获得key</span></span><br><span class="line">                .modelName(<span class="string">&quot;qwen-plus&quot;</span>)<span class="comment">//模型名称</span></span><br><span class="line">                .baseUrl(<span class="string">&quot;https://dashscope.aliyuncs.com/compatible-mode/v1&quot;</span>)<span class="comment">//模型接口地址</span></span><br><span class="line">                .logRequests(<span class="literal">true</span>) <span class="comment">//开启请求日志</span></span><br><span class="line">                .logResponses(<span class="literal">true</span>) <span class="comment">//开启响应日志</span></span><br><span class="line">                .listeners(List.of(<span class="keyword">new</span> <span class="title class_">MyChatModelListener</span>()))<span class="comment">//将我们写入的监听器，添加到里面</span></span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>由于<code>listeners</code>方法传递的是List集合，所以我们使用List.of添加List集合里面在传入</p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250730175000674.png" alt="image-20250730175000674"></p>
<p>测试</p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250730175108302.png" alt="image-20250730175108302"></p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250730175301176.png" alt="image-20250730175301176"></p>
<h3 id="重试机制（Retry-Configuration）"><a href="#重试机制（Retry-Configuration）" class="headerlink" title="重试机制（Retry Configuration）"></a>重试机制（Retry Configuration）</h3><p><img src="/hexo-docs/images/LangChain4jImages/image-20250730175824264.png" alt="image-20250730175824264"></p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250730180026248.png" alt="image-20250730180026248"></p>
<p>改造<code>LLMConfig</code>，添加重试和超时配置</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lazy.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.lazy.listener.MyChatModelListener;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.model.chat.ChatModel;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.model.openai.OpenAiChatModel;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.time.Duration;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LLMConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ChatModel <span class="title function_">chatModelQWen</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> OpenAiChatModel.builder()</span><br><span class="line">                .apiKey(System.getenv(<span class="string">&quot;aliQWen-api&quot;</span>))<span class="comment">//从系统环境变量获得key</span></span><br><span class="line">                .modelName(<span class="string">&quot;qwen-plus&quot;</span>)<span class="comment">//模型名称</span></span><br><span class="line">                .baseUrl(<span class="string">&quot;https://dashscope.aliyuncs.com/compatible-mode/v1&quot;</span>)<span class="comment">//模型接口地址</span></span><br><span class="line">                .logRequests(<span class="literal">true</span>) <span class="comment">//开启请求日志</span></span><br><span class="line">                .logResponses(<span class="literal">true</span>) <span class="comment">//开启响应日志</span></span><br><span class="line">                .listeners(List.of(<span class="keyword">new</span> <span class="title class_">MyChatModelListener</span>()))</span><br><span class="line">                .maxRetries(<span class="number">3</span>)<span class="comment">//最大重试次数</span></span><br><span class="line">                .timeout(Duration.ofMillis(<span class="number">2000</span>))<span class="comment">//超时时间2秒</span></span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试</p>
<p>正常的情况</p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250730180457391.png" alt="image-20250730180457391"></p>
<p>异常情况</p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250730181200571.png" alt="image-20250730181200571"></p>
<p>发现重试了4次，因为，重试的时候不包含第一次请求的</p>
<h3 id="超时控制（timeout）"><a href="#超时控制（timeout）" class="headerlink" title="超时控制（timeout）"></a>超时控制（timeout）</h3><p>向大模型发送请求，如过在指定的时间内没有收到响应，该请求被中断并且报<code>request timed out</code>(请求超时)</p>
<p>在重试机制演示了超时控制，所以不在演示</p>
<h3 id="自定义头"><a href="#自定义头" class="headerlink" title="自定义头"></a>自定义头</h3><p>在 <strong>LangChain4j</strong> 中，<code>customHeaders</code> 是一个用于向 HTTP 请求添加<strong>自定义请求头（HTTP Headers）</strong>的配置选项。它主要用于与外部 API（如 OpenAI、Azure OpenAI、Hugging Face 等模型服务）交互时，传递额外的元数据或认证信息。</p>
<p>核心作用：</p>
<ol>
<li><strong>自定义认证</strong>：添加 API 密钥、Token 或其他认证凭据。</li>
<li><strong>传递元数据</strong>：添加业务相关的标识（如请求来源、版本号）。</li>
<li><strong>兼容特定服务</strong>：适配某些 API 的特殊头部要求（如 <code>x-api-key</code>）。</li>
</ol>
<p>案例</p>
<p>改造<code>LLMConfig</code>类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lazy.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.lazy.listener.MyChatModelListener;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.model.chat.ChatModel;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.model.openai.OpenAiChatModel;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.time.Duration;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LLMConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ChatModel <span class="title function_">chatModelQWen</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> OpenAiChatModel.builder()</span><br><span class="line">                .apiKey(System.getenv(<span class="string">&quot;aliQWen-api&quot;</span>))<span class="comment">//从系统环境变量获得key</span></span><br><span class="line">                .modelName(<span class="string">&quot;qwen-plus&quot;</span>)<span class="comment">//模型名称</span></span><br><span class="line">                .baseUrl(<span class="string">&quot;https://dashscope.aliyuncs.com/compatible-mode/v1&quot;</span>)<span class="comment">//模型接口地址</span></span><br><span class="line">                .logRequests(<span class="literal">true</span>) <span class="comment">//开启请求日志</span></span><br><span class="line">                .logResponses(<span class="literal">true</span>) <span class="comment">//开启响应日志</span></span><br><span class="line">                .listeners(List.of(<span class="keyword">new</span> <span class="title class_">MyChatModelListener</span>()))</span><br><span class="line">                .maxRetries(<span class="number">3</span>)<span class="comment">//最大重试次数</span></span><br><span class="line">                .timeout(Duration.ofMillis(<span class="number">2000</span>))<span class="comment">//超时时间2秒</span></span><br><span class="line">                .customHeaders(Map.of(</span><br><span class="line">                        <span class="string">&quot;X-Custom-Header&quot;</span>, <span class="string">&quot;value1&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;User-Origin&quot;</span>, <span class="string">&quot;my-app&quot;</span></span><br><span class="line">                )) <span class="comment">//自定义头部信息</span></span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试</p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250730183615607.png" alt="image-20250730183615607"></p>
<blockquote>
<p>注意事项：</p>
<ol>
<li><strong>优先级</strong>：若与 LangChain4j 默认头部（如 <code>Authorization</code>）冲突，<code>customHeaders</code> 中的值会<strong>覆盖默认值</strong>。</li>
<li><strong>安全性</strong>：避免在 <code>customHeaders</code> 中硬编码敏感信息（建议通过环境变量注入）。</li>
<li><strong>服务兼容性</strong>：不同 API 对头部的支持不同（如 OpenAI 用 <code>Authorization</code>，Azure 用 <code>api-key</code>）。</li>
<li>自定义头是添加到请求头上的，而不是响应头！</li>
</ol>
</blockquote>
<h2 id="多模态视觉理解"><a href="#多模态视觉理解" class="headerlink" title="多模态视觉理解"></a>多模态视觉理解</h2><p>“多模态视觉” 是指 <strong>计算机视觉技术与其他感知模态（如语言、声音、触觉等）相结合</strong> 的研究和应用领域。它的核心思想是模仿人类感知世界的方式——我们并非仅仅依靠眼睛看，而是<strong>综合运用视觉、听觉、触觉、语言理解等多种感官信息</strong>来理解和交互环境。</p>
<p>就是利用图片和文字跟 AI 进行对话！</p>
<h3 id="所有支持的语言模型比较表"><a href="#所有支持的语言模型比较表" class="headerlink" title="所有支持的语言模型比较表"></a>所有支持的语言模型比较表</h3><table>
<thead>
<tr>
<th>提供商</th>
<th><a target="_blank" rel="noopener" href="https://docs.langchain4j.info/tutorials/response-streaming">流式处理</a></th>
<th><a target="_blank" rel="noopener" href="https://docs.langchain4j.info/tutorials/tools">工具</a> (同步&#x2F;流式)</th>
<th><a target="_blank" rel="noopener" href="https://docs.langchain4j.info/tutorials/structured-outputs#json-schema">JSON Schema</a></th>
<th><a target="_blank" rel="noopener" href="https://docs.langchain4j.info/tutorials/ai-services#json-mode">JSON 模式</a></th>
<th>支持的<a target="_blank" rel="noopener" href="https://docs.langchain4j.info/tutorials/chat-and-language-models/#multimodality">模态</a> (输入)</th>
<th><a target="_blank" rel="noopener" href="https://docs.langchain4j.info/tutorials/observability">可观测性</a></th>
<th><a target="_blank" rel="noopener" href="https://docs.langchain4j.info/tutorials/customizable-http-client">可自定义 HTTP 客户端</a></th>
<th>本地部署</th>
<th>支持原生镜像</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td><a target="_blank" rel="noopener" href="https://docs.langchain4j.info/integrations/language-models/amazon-bedrock#chatlanguagemodel-using-converseapi">Amazon Bedrock (Converse API)</a></td>
<td>✅</td>
<td>✅&#x2F;✅</td>
<td></td>
<td></td>
<td>文本, 图像, PDF</td>
<td>✅</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://docs.langchain4j.info/integrations/language-models/amazon-bedrock#chatlanguagemodel-using-invokeapi">Amazon Bedrock (Invoke API)</a></td>
<td>✅</td>
<td>✅&#x2F;❌</td>
<td></td>
<td></td>
<td>文本</td>
<td>✅</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://docs.langchain4j.info/integrations/language-models/anthropic">Anthropic</a></td>
<td>✅</td>
<td>✅&#x2F;✅</td>
<td></td>
<td></td>
<td>文本, 图像</td>
<td>✅</td>
<td>🆘 <a target="_blank" rel="noopener" href="https://github.com/langchain4j/langchain4j/issues/2469">#2469</a></td>
<td></td>
<td>✅</td>
<td></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://docs.langchain4j.info/integrations/language-models/azure-open-ai">Azure OpenAI</a></td>
<td>✅</td>
<td>✅&#x2F;✅</td>
<td>✅</td>
<td>✅</td>
<td>文本, 图像</td>
<td>✅</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://docs.langchain4j.info/integrations/language-models/chatglm">ChatGLM</a></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>文本</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://docs.langchain4j.info/integrations/language-models/dashscope">DashScope</a></td>
<td>✅</td>
<td>✅&#x2F;✅</td>
<td></td>
<td></td>
<td>文本, 图像, 音频</td>
<td>✅</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://docs.langchain4j.info/integrations/language-models/github-models">GitHub Models</a></td>
<td>✅</td>
<td>✅&#x2F;✅</td>
<td>🔜 <a target="_blank" rel="noopener" href="https://github.com/langchain4j/langchain4j/issues/1911">#1911</a></td>
<td>✅</td>
<td>文本, 图像</td>
<td>✅</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://docs.langchain4j.info/integrations/language-models/google-ai-gemini">Google AI Gemini</a></td>
<td>✅</td>
<td>✅&#x2F;✅</td>
<td>✅</td>
<td>✅</td>
<td>文本, 图像, 音频, 视频, PDF</td>
<td>✅</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://docs.langchain4j.info/integrations/language-models/google-vertex-ai-gemini">Google Vertex AI Gemini</a></td>
<td>✅</td>
<td>✅&#x2F;✅</td>
<td>🆘 <a target="_blank" rel="noopener" href="https://github.com/langchain4j/langchain4j/issues/1717">#1717</a></td>
<td>✅</td>
<td>文本, 图像, 音频, 视频, PDF</td>
<td>✅</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://docs.langchain4j.info/integrations/language-models/google-palm">Google Vertex AI PaLM 2</a></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>文本</td>
<td></td>
<td></td>
<td></td>
<td>✅</td>
<td></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://docs.langchain4j.info/integrations/language-models/hugging-face">Hugging Face</a></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>文本</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://docs.langchain4j.info/integrations/language-models/jlama">Jlama</a></td>
<td>✅</td>
<td>✅&#x2F;✅</td>
<td></td>
<td></td>
<td>文本</td>
<td></td>
<td></td>
<td>✅</td>
<td>✅</td>
<td></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://docs.langchain4j.info/integrations/language-models/local-ai">LocalAI</a></td>
<td>✅</td>
<td>✅&#x2F;✅</td>
<td></td>
<td></td>
<td>文本, 图像, 音频</td>
<td></td>
<td></td>
<td>✅</td>
<td></td>
<td></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://docs.langchain4j.info/integrations/language-models/mistral-ai">Mistral AI</a></td>
<td>✅</td>
<td>✅&#x2F;✅</td>
<td>✅</td>
<td>✅</td>
<td>文本</td>
<td></td>
<td>🆘 <a target="_blank" rel="noopener" href="https://github.com/langchain4j/langchain4j/issues/2524">#2524</a></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://docs.langchain4j.info/integrations/language-models/ollama">Ollama</a></td>
<td>✅</td>
<td>✅&#x2F;✅</td>
<td>✅</td>
<td>✅</td>
<td>文本, 图像</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td></td>
<td></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://docs.langchain4j.info/integrations/language-models/open-ai">OpenAI</a></td>
<td>✅</td>
<td>✅&#x2F;✅</td>
<td>✅</td>
<td>✅</td>
<td>文本, 图像, 音频</td>
<td>✅</td>
<td>✅</td>
<td>兼容：Ollama, LM Studio, GPT4All, 等</td>
<td>✅</td>
<td>兼容：Groq, 等</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://docs.langchain4j.info/integrations/language-models/qianfan">Qianfan</a></td>
<td>✅</td>
<td>✅&#x2F;✅</td>
<td></td>
<td></td>
<td>文本</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://docs.langchain4j.info/integrations/language-models/workers-ai">Cloudflare Workers AI</a></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>文本</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://docs.langchain4j.info/integrations/language-models/zhipu-ai">Zhipu AI</a></td>
<td>✅</td>
<td>✅&#x2F;✅</td>
<td></td>
<td></td>
<td>文本, 图像</td>
<td>✅</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>图例：</p>
<ul>
<li>✅ 表示”支持”</li>
<li>🆘 表示”尚未支持；请帮助我们实现它”</li>
<li>🔜 表示”正在实现中；请等待”</li>
<li>❌ 表示”LLM 提供商不支持”</li>
</ul>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250731163201758.png" alt="image-20250731163201758"></p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250731163500077.png" alt="image-20250731163500077"></p>
<h3 id="选择模型"><a href="#选择模型" class="headerlink" title="选择模型"></a>选择模型</h3><p>我们用阿里云百炼平台，地址：<a target="_blank" rel="noopener" href="https://bailian.console.aliyun.com/">https://bailian.console.aliyun.com/</a></p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250731163938529.png" alt="image-20250731163938529"></p>
<p>模型名字，点击要选择的模型，查看详情</p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250731164021669.png" alt="image-20250731164021669"></p>
<p>模型的api地址，点击查看api参考</p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250731164108219.png" alt="image-20250731164108219"></p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250731164130447.png" alt="image-20250731164130447"></p>
<h3 id="code-案例"><a href="#code-案例" class="headerlink" title="code 案例"></a>code 案例</h3><h4 id="example-1（LangChain4j-原生）"><a href="#example-1（LangChain4j-原生）" class="headerlink" title="example 1（LangChain4j 原生）"></a>example 1（LangChain4j 原生）</h4><p>建<code>module</code>：LangChain4j-06chat-image</p>
<p><code>pom</code></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>dev.langchain4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>langchain4j-open-ai<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>dev.langchain4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>langchain4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>引入图片到<code>resources/static/image</code></p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250731170056487.png" alt="image-20250731170056487"></p>
<p><code>LLMConfig</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lazy.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.model.chat.ChatModel;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.model.openai.OpenAiChatModel;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LLMConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ChatModel <span class="title function_">chatModelQWen</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> OpenAiChatModel.builder()</span><br><span class="line">                .apiKey(System.getenv(<span class="string">&quot;aliQWen-api&quot;</span>))</span><br><span class="line">                <span class="comment">//qwen-vl-max 是一个多模态大模型，支持图片和文本的结合输入，适用于视觉-语言任务。</span></span><br><span class="line">                .modelName(<span class="string">&quot;qwen-vl-max&quot;</span>)</span><br><span class="line">                .baseUrl(<span class="string">&quot;https://dashscope.aliyuncs.com/compatible-mode/v1&quot;</span>)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>编码步骤</p>
<ol>
<li>图片转码：通过Base64编码将图片转化为字符串</li>
<li>提示词指定：结合<code>ImageContent</code>和<code>TextContent</code>一起发送到模型处理</li>
<li>API调用：使用<code>OpenAiChatModel</code>来构建请求，并通过<code>chat()</code>方法调用模型。请求内容包括文本提示和图片，模型会根据输入返回分析结果。</li>
<li>解析与输出：从<code>ChatResponse</code>中获取AI大模型的回复，打印出处理后的结果。</li>
</ol>
<p><code>controller</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lazy.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.data.message.ImageContent;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.data.message.TextContent;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.data.message.UserMessage;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.model.chat.ChatModel;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.model.chat.response.ChatResponse;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.io.Resource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ImageModelController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;classpath:static/yejing.png&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Resource resource;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ChatModel chatModel;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/image/call&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">call</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">//1. 图片转码：通过Base64编码将图片转化为字符串</span></span><br><span class="line">        <span class="type">byte</span>[] byteArray = resource.getContentAsByteArray();</span><br><span class="line">        <span class="comment">//将图片转成base64编码</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">base64Data</span> <span class="operator">=</span> Base64.getEncoder().encodeToString(byteArray);</span><br><span class="line">        <span class="comment">//2.提示词指定：结合ImageContent和TextContent一起发送到模型处理</span></span><br><span class="line">        <span class="type">UserMessage</span> <span class="variable">userMessage</span> <span class="operator">=</span> UserMessage.from(</span><br><span class="line">                TextContent.from(<span class="string">&quot;从图片你能得到什么信息？&quot;</span>),</span><br><span class="line">                ImageContent.from(base64Data,<span class="string">&quot;image/png&quot;</span>)</span><br><span class="line">        );</span><br><span class="line">        <span class="comment">//3.解析与输出：从ChatResponse中获取AI大模型的回复，打印出处理后的结果。</span></span><br><span class="line">        <span class="type">ChatResponse</span> <span class="variable">chatResponse</span> <span class="operator">=</span> chatModel.chat(userMessage);</span><br><span class="line">        <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> chatResponse.aiMessage().text();</span><br><span class="line">        System.out.println(result);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试</p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250731172941409.png" alt="image-20250731172941409"></p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250731173034251.png" alt="image-20250731173034251"></p>
<p>为什么用<code>AiMessage</code>?</p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250731172105810.png" alt="image-20250731172105810"></p>
<h4 id="example-2（LangChain4j跟第三方整合）"><a href="#example-2（LangChain4j跟第三方整合）" class="headerlink" title="example 2（LangChain4j跟第三方整合）"></a>example 2（LangChain4j跟第三方整合）</h4><p>地址：<a target="_blank" rel="noopener" href="https://docs.langchain4j.info/integrations/language-models/dashscope">https://docs.langchain4j.info/integrations/language-models/dashscope</a></p>
<p>结合阿里巴巴通义万相进行图像理解，其支持视觉+语言的多模态任务</p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250731175525908.png" alt="image-20250731175525908"></p>
<p>切换通义万相-文生图模型<code>wanx2.1-t2i-turbo</code></p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250731180551041.png" alt="image-20250731180551041"></p>
<p>两种方式</p>
<ol>
<li><p>原生</p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250731175727807.png" alt="image-20250731175727807"></p>
</li>
<li><p>集成SpringBoot</p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250731175746397.png" alt="image-20250731175746397"></p>
</li>
</ol>
<p>我们在父工程的<code>pom</code>文件引入，物料管理清单</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">langchain4j-community.version</span>&gt;</span>1.0.1-beta6<span class="tag">&lt;/<span class="name">langchain4j-community.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>dev.langchain4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>langchain4j-community-bom<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;langchain4j-community.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在子项目下引入</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>dev.langchain4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>langchain4j-community-dashscope-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>修改<code>LLMConfig</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lazy.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.community.model.dashscope.WanxImageModel;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.model.chat.ChatModel;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.model.openai.OpenAiChatModel;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LLMConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 测试通义万象来实现图片生成，</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> WanxImageModel <span class="title function_">wanxImageModel</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> WanxImageModel.builder()</span><br><span class="line">                .apiKey(System.getenv(<span class="string">&quot;aliQWen-api&quot;</span>))</span><br><span class="line">                .modelName(<span class="string">&quot;wanx2.1-t2i-turbo&quot;</span>) <span class="comment">//图片生成 https://help.aliyun.com/zh/model-studio/text-to-image</span></span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>WanxImageModelController</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lazy.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.dashscope.aigc.imagesynthesis.ImageSynthesis;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.dashscope.aigc.imagesynthesis.ImageSynthesisParam;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.dashscope.aigc.imagesynthesis.ImageSynthesisResult;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.dashscope.exception.NoApiKeyException;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.dashscope.utils.JsonUtils;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.community.model.dashscope.WanxImageModel;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.data.image.Image;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.model.output.Response;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WanxImageModelController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> WanxImageModel wanxImageModel;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/image/create&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">createImageModel</span><span class="params">()</span> &#123;</span><br><span class="line">        Response&lt;Image&gt; imageResponse = wanxImageModel.generate(<span class="string">&quot;风景照&quot;</span>);</span><br><span class="line">        System.out.println(imageResponse.content().url());</span><br><span class="line">        <span class="keyword">return</span> imageResponse.content().toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/image/create2&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">create2ImageModel</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">prompt</span> <span class="operator">=</span> <span class="string">&quot;图片风格为3D渲染，中国风，一个巨大的展开的卷轴在空中飘浮，金银色调，玉髓雕刻，&quot;</span> +</span><br><span class="line">                <span class="string">&quot;色彩细腻，广角镜头，blender 渲染，丰富细节，超高清&quot;</span>;</span><br><span class="line">        <span class="type">ImageSynthesisParam</span> <span class="variable">param</span> <span class="operator">=</span> ImageSynthesisParam.builder()</span><br><span class="line">                .apiKey(System.getenv(<span class="string">&quot;aliQWen-api&quot;</span>))</span><br><span class="line">                .model(ImageSynthesis.Models.WANX_V1) <span class="comment">//wanx_v1模型</span></span><br><span class="line">                .prompt(prompt) <span class="comment">//图片要求</span></span><br><span class="line">                .style(<span class="string">&quot;&lt;watercolor&gt;&quot;</span>) <span class="comment">//水彩画</span></span><br><span class="line">                .n(<span class="number">1</span>)  <span class="comment">//数量</span></span><br><span class="line">                .size(<span class="string">&quot;1024*1024&quot;</span>) <span class="comment">//大小</span></span><br><span class="line">                .build();</span><br><span class="line">        <span class="type">ImageSynthesis</span> <span class="variable">imageSynthesis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ImageSynthesis</span>();</span><br><span class="line">        ImageSynthesisResult result;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            result = imageSynthesis.call(param);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoApiKeyException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> JsonUtils.toJson(result);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试</p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250731182312800.png" alt="image-20250731182312800"></p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250731182343441.png" alt="image-20250731182343441"></p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250731182834973.png" alt="image-20250731182834973"></p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250731182905130.png" alt="image-20250731182905130"></p>
<h2 id="流式输出（streamingoutput）"><a href="#流式输出（streamingoutput）" class="headerlink" title="流式输出（streamingoutput）"></a>流式输出（streamingoutput）</h2><p>网址：<a target="_blank" rel="noopener" href="https://docs.langchain4j.info/tutorials/response-streaming">https://docs.langchain4j.info/tutorials/response-streaming</a></p>
<p>是什么？</p>
<ul>
<li>是一种逐步返回大模型生成结果的技术，生成一点返回一点，允许服务器将响应内容分批次实时传输给客户端，而不是等待全部内容生成完毕后再一次性返回。这种机制能显著提升用户体验，尤其适用于大模型响应较慢的场景（如生成长文本或复杂推理结果）。</li>
</ul>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250801184653680.png" alt="image-20250801184653680"></p>
<h3 id="低阶api-1"><a href="#低阶api-1" class="headerlink" title="低阶api"></a>低阶api</h3><p>建module：<code>LangChain4j-07chat-stream</code></p>
<p><code>pom</code></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>17<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>17<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>dev.langchain4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>langchain4j-open-ai<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>yaml</code></p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">9007</span></span><br><span class="line">  <span class="comment"># 设置响应的字符编码，避免流式返回输出乱码</span></span><br><span class="line">  <span class="attr">servlet:</span></span><br><span class="line">    <span class="attr">encoding:</span></span><br><span class="line">      <span class="attr">charset:</span> <span class="string">utf-8</span></span><br><span class="line">      <span class="attr">enabled:</span> <span class="literal">true</span> <span class="comment"># 启用http编码支持</span></span><br><span class="line">      <span class="attr">force:</span> <span class="literal">true</span> <span class="comment">#  HTTP 请求和响应上强制编码到配置的字符集</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">LangChain4j-07chat-stream</span></span><br></pre></td></tr></table></figure>

<p><code>LLMConfig</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lazy.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.model.chat.ChatModel;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.model.chat.StreamingChatModel;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.model.openai.OpenAiChatModel;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.model.openai.OpenAiStreamingChatModel;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LLMConfig</span> &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 普通对话</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ChatModel <span class="title function_">chatModelQWen</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> OpenAiChatModel.builder()</span><br><span class="line">                .apiKey(System.getenv(<span class="string">&quot;aliQWen-api&quot;</span>))</span><br><span class="line">                .modelName(<span class="string">&quot;qwen-plus&quot;</span>)</span><br><span class="line">                .baseUrl(<span class="string">&quot;https://dashscope.aliyuncs.com/compatible-mode/v1&quot;</span>)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 配置流式输出</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> StreamingChatModel <span class="title function_">streamingChatModelQWen</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> OpenAiStreamingChatModel.builder()</span><br><span class="line">                .apiKey(System.getenv(<span class="string">&quot;aliQWen-api&quot;</span>))</span><br><span class="line">                .modelName(<span class="string">&quot;qwen-plus&quot;</span>)</span><br><span class="line">                .baseUrl(<span class="string">&quot;https://dashscope.aliyuncs.com/compatible-mode/v1&quot;</span>)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>StreamChatModelController</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lazy.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.model.chat.ChatModel;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.model.chat.StreamingChatModel;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.model.chat.response.ChatResponse;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.model.chat.response.StreamingChatResponseHandler;</span><br><span class="line"><span class="keyword">import</span> jakarta.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StreamChatModelController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> ChatModel chatModelQWen;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> StreamingChatModel streamingChatModel;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/chat&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getStreamingChatModel</span><span class="params">(<span class="meta">@RequestParam(value = &quot;prompt&quot;,</span></span></span><br><span class="line"><span class="meta"><span class="params">            defaultValue = &quot;说一下北京有什么好玩的地方？&quot;)</span> String prompt)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> chatModelQWen.chat(prompt);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/streaming&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">streaming</span><span class="params">(<span class="meta">@RequestParam(value = &quot;prompt&quot;,</span></span></span><br><span class="line"><span class="meta"><span class="params">            defaultValue = &quot;说一下北京有什么好玩的地方？&quot;)</span> String prompt)</span> &#123;</span><br><span class="line">         streamingChatModel.chat(prompt,<span class="keyword">new</span> <span class="title class_">StreamingChatResponseHandler</span>() &#123;</span><br><span class="line"></span><br><span class="line">             <span class="meta">@Override</span></span><br><span class="line">             <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onPartialResponse</span><span class="params">(String partialResponse)</span> &#123;</span><br><span class="line">                 System.out.println(partialResponse);</span><br><span class="line">             &#125;</span><br><span class="line"></span><br><span class="line">             <span class="meta">@Override</span></span><br><span class="line">             <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onCompleteResponse</span><span class="params">(ChatResponse completeResponse)</span> &#123;</span><br><span class="line">                 System.out.println(completeResponse);</span><br><span class="line">             &#125;</span><br><span class="line"></span><br><span class="line">             <span class="meta">@Override</span></span><br><span class="line">             <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onError</span><span class="params">(Throwable throwable)</span> &#123;</span><br><span class="line">                 System.out.println(throwable);</span><br><span class="line">             &#125;</span><br><span class="line">         &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试</p>
<p>普通的</p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250801191108273.png" alt="image-20250801191108273"></p>
<p>流水输出</p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250801191136710.png" alt="image-20250801191136710"></p>
<h3 id="高阶api（结合webFlux编程）"><a href="#高阶api（结合webFlux编程）" class="headerlink" title="高阶api（结合webFlux编程）"></a>高阶api（结合webFlux编程）</h3><p><code>pom</code></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>17<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>17<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 高阶api --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>dev.langchain4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>langchain4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- langchain4j 结合web Flux编程 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>dev.langchain4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>langchain4j-reactor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>yaml</code></p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">9007</span></span><br><span class="line">  <span class="comment"># 设置响应的字符编码，避免流式返回输出乱码</span></span><br><span class="line">  <span class="attr">servlet:</span></span><br><span class="line">    <span class="attr">encoding:</span></span><br><span class="line">      <span class="attr">charset:</span> <span class="string">utf-8</span></span><br><span class="line">      <span class="attr">enabled:</span> <span class="literal">true</span> <span class="comment"># 启用http编码支持</span></span><br><span class="line">      <span class="attr">force:</span> <span class="literal">true</span> <span class="comment">#  HTTP 请求和响应上强制编码到配置的字符集</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">LangChain4j-07chat-stream</span></span><br></pre></td></tr></table></figure>

<p><code>LLMConfig</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lazy.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.model.chat.ChatModel;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.model.chat.StreamingChatModel;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.model.openai.OpenAiChatModel;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.model.openai.OpenAiStreamingChatModel;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LLMConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 普通对话</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ChatModel <span class="title function_">chatModelQWen</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> OpenAiChatModel.builder()</span><br><span class="line">                .apiKey(System.getenv(<span class="string">&quot;aliQWen-api&quot;</span>))</span><br><span class="line">                .modelName(<span class="string">&quot;qwen-plus&quot;</span>)</span><br><span class="line">                .baseUrl(<span class="string">&quot;https://dashscope.aliyuncs.com/compatible-mode/v1&quot;</span>)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 配置流式输出</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> StreamingChatModel <span class="title function_">streamingChatModelQWen</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> OpenAiStreamingChatModel.builder()</span><br><span class="line">                .apiKey(System.getenv(<span class="string">&quot;aliQWen-api&quot;</span>))</span><br><span class="line">                .modelName(<span class="string">&quot;qwen-plus&quot;</span>)</span><br><span class="line">                .baseUrl(<span class="string">&quot;https://dashscope.aliyuncs.com/compatible-mode/v1&quot;</span>)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>StreamingChatModelController</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lazy.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.model.chat.ChatModel;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.model.chat.StreamingChatModel;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.model.chat.response.ChatResponse;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.model.chat.response.StreamingChatResponseHandler;</span><br><span class="line"><span class="keyword">import</span> jakarta.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.Flux;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StreamChatModelFluxController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> ChatModel chatModel;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> StreamingChatModel streamingChatModel;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/flux/chat&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Flux&lt;String&gt; <span class="title function_">chat</span><span class="params">(<span class="meta">@RequestParam(value = &quot;prompt&quot;</span></span></span><br><span class="line"><span class="meta"><span class="params">            ,defaultValue = &quot;北京有什么好玩的地方&quot;)</span> String prompt)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">chat</span> <span class="operator">=</span> chatModel.chat(prompt);</span><br><span class="line">        <span class="keyword">return</span> Flux.just(chat);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/flux/streaming&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Flux&lt;String&gt; <span class="title function_">stringFlux</span><span class="params">(<span class="meta">@RequestParam(value = &quot;prompt&quot;</span></span></span><br><span class="line"><span class="meta"><span class="params">            ,defaultValue = &quot;西安有什么好玩的地方？&quot;)</span> String prompt)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Flux.create(fluxSink -&gt; streamingChatModel.chat(prompt, <span class="keyword">new</span> <span class="title class_">StreamingChatResponseHandler</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onPartialResponse</span><span class="params">(String partialResponse)</span> &#123;</span><br><span class="line">                fluxSink.next(partialResponse);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onCompleteResponse</span><span class="params">(ChatResponse completeResponse)</span> &#123;</span><br><span class="line">                fluxSink.complete();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onError</span><span class="params">(Throwable error)</span> &#123;</span><br><span class="line">                fluxSink.error(error);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试</p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250801192733281.png" alt="image-20250801192733281"></p>
<p>流式输出</p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250801192819786.png" alt="image-20250801192819786"></p>
<h3 id="接口式编程（结合Flux）"><a href="#接口式编程（结合Flux）" class="headerlink" title="接口式编程（结合Flux）"></a>接口式编程（结合Flux）</h3><p><code>pom</code></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>17<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>17<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 高阶api --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>dev.langchain4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>langchain4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- langchain4j 结合web Flux编程 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>dev.langchain4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>langchain4j-reactor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>yaml</code></p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">9007</span></span><br><span class="line">  <span class="comment"># 设置响应的字符编码，避免流式返回输出乱码</span></span><br><span class="line">  <span class="attr">servlet:</span></span><br><span class="line">    <span class="attr">encoding:</span></span><br><span class="line">      <span class="attr">charset:</span> <span class="string">utf-8</span></span><br><span class="line">      <span class="attr">enabled:</span> <span class="literal">true</span> <span class="comment"># 启用http编码支持</span></span><br><span class="line">      <span class="attr">force:</span> <span class="literal">true</span> <span class="comment">#  HTTP 请求和响应上强制编码到配置的字符集</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">LangChain4j-07chat-stream</span></span><br></pre></td></tr></table></figure>

<p><code>LLMConfig</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lazy.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.lazy.service.ChatAssistant;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.model.chat.ChatModel;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.model.chat.StreamingChatModel;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.model.openai.OpenAiChatModel;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.model.openai.OpenAiStreamingChatModel;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.service.AiServices;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LLMConfig</span> &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 普通对话</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ChatModel <span class="title function_">chatModelQWen</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> OpenAiChatModel.builder()</span><br><span class="line">                .apiKey(System.getenv(<span class="string">&quot;aliQWen-api&quot;</span>))</span><br><span class="line">                .modelName(<span class="string">&quot;qwen-plus&quot;</span>)</span><br><span class="line">                .baseUrl(<span class="string">&quot;https://dashscope.aliyuncs.com/compatible-mode/v1&quot;</span>)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 配置流式输出</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> StreamingChatModel <span class="title function_">streamingChatModelQWen</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> OpenAiStreamingChatModel.builder()</span><br><span class="line">                .apiKey(System.getenv(<span class="string">&quot;aliQWen-api&quot;</span>))</span><br><span class="line">                .modelName(<span class="string">&quot;qwen-plus&quot;</span>)</span><br><span class="line">                .baseUrl(<span class="string">&quot;https://dashscope.aliyuncs.com/compatible-mode/v1&quot;</span>)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 流式接口</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ChatAssistant <span class="title function_">assistantStreaming</span><span class="params">(StreamingChatModel streamingChatModel)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> AiServices.create(ChatAssistant.class,streamingChatModel);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>ChatAssistant</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lazy.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.Flux;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ChatAssistant</span> &#123;</span><br><span class="line">    Flux&lt;String&gt; <span class="title function_">fluxChat</span><span class="params">(String prompt)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>StreamingChatModelWithInterfaceController</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lazy.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.lazy.service.ChatAssistant;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.model.chat.ChatModel;</span><br><span class="line"><span class="keyword">import</span> jakarta.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.Flux;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StreamingChatModelWithInterfaceController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> ChatAssistant chatAssistant;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> ChatModel chatModel;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/interface/chat&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">chat</span><span class="params">(<span class="meta">@RequestParam(value = &quot;prompt&quot;,</span></span></span><br><span class="line"><span class="meta"><span class="params">            defaultValue = &quot;介绍一下广州&quot;)</span> String prompt)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> chatModel.chat(prompt);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/interface/streaming&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Flux&lt;String&gt; <span class="title function_">streaming</span><span class="params">(<span class="meta">@RequestParam(value = &quot;prompt&quot;,</span></span></span><br><span class="line"><span class="meta"><span class="params">            defaultValue = &quot;介绍一下深圳&quot;)</span> String prompt)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> chatAssistant.fluxChat(prompt);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试</p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250801194559792.png" alt="image-20250801194559792"></p>
<p>流式输出</p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250801203906441.png" alt="image-20250801203906441"></p>
<h2 id="记忆缓存"><a href="#记忆缓存" class="headerlink" title="记忆缓存"></a>记忆缓存</h2><p>官网：<a target="_blank" rel="noopener" href="https://docs.langchain4j.info/tutorials/chat-memory">https://docs.langchain4j.info/tutorials/chat-memory</a></p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250802165149740.png" alt="image-20250802165149740"></p>
<p>记忆缓存是聊天系统中的一个重要组件，用于存储和管理对话的上下文信息。它的主要作用是让AI助手能够“记住”之前的对话内容，从而提供连贯和个性化的回复。</p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250802165419653.png" alt="image-20250802165419653"></p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250802165504428.png" alt="image-20250802165504428"></p>
<h3 id="持久化"><a href="#持久化" class="headerlink" title="持久化"></a>持久化</h3><p>默认情况下，<code>ChatMemory</code>实现在内存中存储<code>ChatMessage</code>。</p>
<p>如果需要持久化，可以实现自定义的<code>ChatMemoryStore</code>， 将<code>ChatMessage</code>存储在您选择的任何持久化存储中：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">PersistentChatMemoryStore</span> <span class="keyword">implements</span> <span class="title class_">ChatMemoryStore</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> List&lt;ChatMessage&gt; <span class="title function_">getMessages</span><span class="params">(Object memoryId)</span> &#123;</span><br><span class="line">          <span class="comment">// <span class="doctag">TODO:</span> 实现通过内存ID从持久化存储中获取所有消息。</span></span><br><span class="line">          <span class="comment">// 可以使用ChatMessageDeserializer.messageFromJson(String)和</span></span><br><span class="line">          <span class="comment">// ChatMessageDeserializer.messagesFromJson(String)辅助方法</span></span><br><span class="line">          <span class="comment">// 轻松地从JSON反序列化聊天消息。</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateMessages</span><span class="params">(Object memoryId, List&lt;ChatMessage&gt; messages)</span> &#123;</span><br><span class="line">            <span class="comment">// <span class="doctag">TODO:</span> 实现通过内存ID更新持久化存储中的所有消息。</span></span><br><span class="line">            <span class="comment">// 可以使用ChatMessageSerializer.messageToJson(ChatMessage)和</span></span><br><span class="line">            <span class="comment">// ChatMessageSerializer.messagesToJson(List&lt;ChatMessage&gt;)辅助方法</span></span><br><span class="line">            <span class="comment">// 轻松地将聊天消息序列化为JSON。</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteMessages</span><span class="params">(Object memoryId)</span> &#123;</span><br><span class="line">          <span class="comment">// <span class="doctag">TODO:</span> 实现通过内存ID删除持久化存储中的所有消息。</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="type">ChatMemory</span> <span class="variable">chatMemory</span> <span class="operator">=</span> MessageWindowChatMemory.builder()</span><br><span class="line">        .id(<span class="string">&quot;12345&quot;</span>)</span><br><span class="line">        .maxMessages(<span class="number">10</span>)</span><br><span class="line">        .chatMemoryStore(<span class="keyword">new</span> <span class="title class_">PersistentChatMemoryStore</span>())</span><br><span class="line">        .build();</span><br></pre></td></tr></table></figure>



<p>每当向<code>ChatMemory</code>添加新的<code>ChatMessage</code>时，都会调用<code>updateMessages()</code>方法。 这通常在与LLM的每次交互中发生两次： 一次是添加新的<code>UserMessage</code>时，另一次是添加新的<code>AiMessage</code>时。 <code>updateMessages()</code>方法预期会更新与给定内存ID关联的所有消息。 <code>ChatMessage</code>可以单独存储（例如，每条消息一条记录&#x2F;行&#x2F;对象） 或一起存储（例如，整个<code>ChatMemory</code>一条记录&#x2F;行&#x2F;对象）。</p>
<p>备注</p>
<p>请注意，从<code>ChatMemory</code>中淘汰的消息也将从<code>ChatMemoryStore</code>中淘汰。 当消息被淘汰时，会调用<code>updateMessages()</code>方法， 传入不包含被淘汰消息的消息列表。</p>
<p>当<code>ChatMemory</code>的用户请求所有消息时，会调用<code>getMessages()</code>方法。 这通常在与LLM的每次交互中发生一次。 <code>Object memoryId</code>参数的值对应于创建<code>ChatMemory</code>时指定的<code>id</code>。 它可以用来区分多个用户和&#x2F;或对话。 <code>getMessages()</code>方法预期会返回与给定内存ID关联的所有消息。</p>
<p>当调用<code>ChatMemory.clear()</code>时，会调用<code>deleteMessages()</code>方法。 如果您不使用此功能，可以将此方法留空。</p>
<h3 id="两种主要的ChatMemory实现类"><a href="#两种主要的ChatMemory实现类" class="headerlink" title="两种主要的ChatMemory实现类"></a>两种主要的ChatMemory实现类</h3><ol>
<li>MessageWindowChatMemory<ul>
<li>较简单的一种，<code>MessageWindowChatMemory</code>，作为滑动窗口运行， 保留最近的<code>N</code>条消息，并淘汰不再适合的旧消息。 然而，由于每条消息可能包含不同数量的令牌， <code>MessageWindowChatMemory</code>主要用于快速原型设计。</li>
</ul>
</li>
<li>TokenWindowChatMemory<ul>
<li>更复杂的选项是<code>TokenWindowChatMemory</code>， 它也作为滑动窗口运行，但专注于保留最近的<code>N</code>个<strong>令牌</strong>， 根据需要淘汰旧消息。 消息是不可分割的。如果一条消息不适合，它会被完全淘汰。 <code>TokenWindowChatMemory</code>需要一个<code>Tokenizer</code>来计算每个<code>ChatMessage</code>中的令牌数。</li>
</ul>
</li>
</ol>
<p>大模型中的Token VS Web开发中的Token</p>
<ul>
<li><p>大模型中的token</p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250802165751231.png" alt="image-20250802165751231"></p>
</li>
<li><p>Web开发中的token</p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250802165810527.png" alt="image-20250802165810527"></p>
</li>
<li><p>区别</p>
<ul>
<li>目的不同：大模型中的token是为了将文本分割成可处理的单元，便于进行计算；而Web开发中的token主要用于安全地传递用户身份信息</li>
<li>生成方式不同：前者通过特定的算法（如BPE）对文本进行分割得到；后者则通常是通过加密算法生成的唯一字符串。</li>
<li>应用场景不同：前者应用于文本分析、机器翻译等NLP任务；后者多见于用户登录系统、API 访问控制等领域。</li>
</ul>
</li>
</ul>
<h3 id="案例-2"><a href="#案例-2" class="headerlink" title="案例"></a>案例</h3><p>新建<code>module</code>：<code>LangChain4j-08chat-memory</code></p>
<p><code>pom</code></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.taget</span>&gt;</span>17<span class="tag">&lt;/<span class="name">maven.compiler.taget</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.souce</span>&gt;</span>17<span class="tag">&lt;/<span class="name">maven.compiler.souce</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- langchain4j low-api --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>dev.langchain4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>langchain4j-open-ai<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- langchain4j high-api --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>dev.langchain4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>langchain4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>yaml</code></p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">9008</span></span><br><span class="line">  <span class="attr">servlet:</span></span><br><span class="line">    <span class="attr">encoding:</span></span><br><span class="line">      <span class="attr">charset:</span> <span class="string">utf-8</span></span><br><span class="line">      <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">force:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">LangChain4j-08chat-memory</span></span><br></pre></td></tr></table></figure>

<p><code>ChatAssistant</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lazy.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ChatAssistant</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 普通聊天对话</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> prompt 消息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 回复</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    String <span class="title function_">chat</span><span class="params">(String prompt)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>ChatMemoryAssistant</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lazy.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.service.MemoryId;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.service.UserMessage;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ChatMemoryAssistant</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 带记忆缓存聊天</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userId 用户id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> prompt 消息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 回复</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    String <span class="title function_">chatMemory</span><span class="params">(<span class="meta">@MemoryId</span> Long userId, <span class="meta">@UserMessage</span> String prompt)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>更换模型</p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250802174808541.png" alt="image-20250802174808541"></p>
<p><code>LLMConfig</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lazy.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.lazy.service.ChatAssistant;</span><br><span class="line"><span class="keyword">import</span> com.lazy.service.ChatMemoryAssistant;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.memory.chat.MessageWindowChatMemory;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.memory.chat.TokenWindowChatMemory;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.model.TokenCountEstimator;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.model.chat.ChatModel;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.model.openai.OpenAiChatModel;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.model.openai.OpenAiTokenCountEstimator;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.service.AiServices;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LLMConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ChatModel <span class="title function_">chatModel</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> OpenAiChatModel.builder()</span><br><span class="line">                .apiKey(System.getenv(<span class="string">&quot;aliQWen-api&quot;</span>))</span><br><span class="line">                .modelName(<span class="string">&quot;qwen-long&quot;</span>)</span><br><span class="line">                .baseUrl(<span class="string">&quot;https://dashscope.aliyuncs.com/compatible-mode/v1&quot;</span>)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(name = &quot;chatAssistant&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ChatAssistant <span class="title function_">chatAssistant</span><span class="params">(ChatModel chatModel)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> AiServices.create(ChatAssistant.class, chatModel);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(name = &quot;chatMessageMemoryChatMemory&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ChatMemoryAssistant <span class="title function_">chatMessageWindowChatMemory</span><span class="params">(ChatModel chatModel)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> AiServices.builder(ChatMemoryAssistant.class)</span><br><span class="line">                .chatModel(chatModel)</span><br><span class="line">                <span class="comment">// 每个memoryId对应创建一个ChatMemory,withMaxMessages(int maxMessages) 保存maxMessages条消息</span></span><br><span class="line">                <span class="comment">// 如果超过 maxMessages 条消息，将会执行MessageWindowChatMemory类中的clear方法清除消息</span></span><br><span class="line">                .chatMemoryProvider(memoryId -&gt; MessageWindowChatMemory.withMaxMessages(<span class="number">100</span>))</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(name = &quot;chatTokenWindowChatMemory&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ChatMemoryAssistant <span class="title function_">chatMemoryAssistant</span><span class="params">(ChatModel chatModel)</span> &#123;</span><br><span class="line">        <span class="type">TokenCountEstimator</span> <span class="variable">tokenCountEstimator</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OpenAiTokenCountEstimator</span>(<span class="string">&quot;gpt-4&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> AiServices.builder(ChatMemoryAssistant.class)</span><br><span class="line">                .chatModel(chatModel)</span><br><span class="line">                <span class="comment">/**</span></span><br><span class="line"><span class="comment">                 * withMaxTokens(int maxTokens, TokenCountEstimator tokenCountEstimator)</span></span><br><span class="line"><span class="comment">                 *  maxTokens：要保留的最大token数。聊天内存将保留尽可能多的最新消息，</span></span><br><span class="line"><span class="comment">                 *	以容纳 maxTokens。信息是不可分割的。如果旧消息不适合，则将其完全逐出。</span></span><br><span class="line"><span class="comment">                 *  tokenCountEstimator：负责计算消息中的token</span></span><br><span class="line"><span class="comment">                 */</span></span><br><span class="line">                .chatMemoryProvider(memoryId -&gt;</span><br><span class="line">                        TokenWindowChatMemory.withMaxTokens(<span class="number">1000</span>,tokenCountEstimator))</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>ChatMemoryController</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lazy.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.lazy.service.ChatAssistant;</span><br><span class="line"><span class="keyword">import</span> com.lazy.service.ChatMemoryAssistant;</span><br><span class="line"><span class="keyword">import</span> jakarta.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ChatMemoryController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource(name = &quot;chatAssistant&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> ChatAssistant chatAssistant;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource(name = &quot;chatMessageMemoryChatMemory&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> ChatMemoryAssistant chatMessageMemoryChatMemory;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource(name = &quot;chatTokenWindowChatMemory&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> ChatMemoryAssistant chatTokenWindowChatMemory;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/chat&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">chat</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">answer01</span> <span class="operator">=</span> <span class="string">&quot;你好，我叫张三&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">assistant</span> <span class="operator">=</span> chatAssistant.chat(answer01);</span><br><span class="line">        <span class="type">String</span> <span class="variable">answer02</span> <span class="operator">=</span> <span class="string">&quot;我叫什么？&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">assistant2</span> <span class="operator">=</span> chatAssistant.chat(answer02);</span><br><span class="line">        <span class="keyword">return</span> result(answer01,assistant,answer02,assistant2);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/chatmemory/chat1&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">chatMessageMemoryChatMemory</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">answer01</span> <span class="operator">=</span> <span class="string">&quot;你好，我叫张三&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">assistant</span> <span class="operator">=</span> chatMessageMemoryChatMemory.chatMemory(<span class="number">1L</span>,answer01);</span><br><span class="line">        <span class="type">String</span> <span class="variable">answer02</span> <span class="operator">=</span> <span class="string">&quot;我叫什么？&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">assistant2</span> <span class="operator">=</span> chatMessageMemoryChatMemory.chatMemory(<span class="number">1L</span>,answer02);</span><br><span class="line">        <span class="keyword">return</span> result(answer01,assistant,answer02,assistant2);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/chatmemory/chat2&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">chatTokenWindowChatMemory</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">answer01</span> <span class="operator">=</span> <span class="string">&quot;你好，我叫Java&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">assistant</span> <span class="operator">=</span> chatTokenWindowChatMemory.chatMemory(<span class="number">1L</span>,answer01);</span><br><span class="line">        <span class="type">String</span> <span class="variable">answer02</span> <span class="operator">=</span> <span class="string">&quot;我叫什么？&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">assistant2</span> <span class="operator">=</span> chatTokenWindowChatMemory.chatMemory(<span class="number">1L</span>,answer02);</span><br><span class="line">        <span class="keyword">return</span> result(answer01,assistant,answer02,assistant2);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">result</span><span class="params">(String... answer01)</span>&#123;</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">result</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        <span class="keyword">for</span> (String item : answer01) &#123;</span><br><span class="line">            result.append(item).append(<span class="string">&quot;&lt;br/&gt;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试</p>
<p>没有聊天记忆</p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250802183623223.png" alt="image-20250802183623223"></p>
<p>带聊天记忆<code>MessageMemoryChatMemory</code></p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250802183708934.png" alt="image-20250802183708934"></p>
<p>带聊天记忆<code>TokenWindowChatMemory</code></p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250802183747877.png" alt="image-20250802183747877"></p>
<h2 id="提示词工程"><a href="#提示词工程" class="headerlink" title="提示词工程"></a>提示词工程</h2><p>什么是LangChain4j提示词？</p>
<p><strong>LangChain4j</strong> 中的提示词（Prompt）用于引导模型生成特定输出。它们可以是简单的文本字符串，也可以是包含多种信息的复杂结构。</p>
<p>从普通的提问 过渡到 提示词</p>
<p><a href="">聊天和语言模型 | LangChain4j 中文文档</a></p>
<p>是什么？</p>
<ul>
<li><p>目前有五种类型的聊天消息，每个消息的“来源”对应一种</p>
<ul>
<li><p>五大类型</p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250803163217704.png" alt="image-20250803163217704"></p>
<ol>
<li><p>SystemMessage</p>
<p>这是来自系统的消息。通常，作为开发人员，你应该定义这条消息的内容。通常，会在这里写关于LLM在这次对话的角色（例如：医生、律师）、应该如何表现、以什么风格回答等指令。LLM 被训练成比其他类型的消息更关注 <code>SystemMessage</code>，所以要小心，最好不要给最终用户自由访问权限来定义或注入一些输入到<code>SystemMessage</code>中。通常，它位于对话的开始。</p>
<p>地址：<code>https://docs.langchain4j.info/tutorials/ai-services#systemmessage</code></p>
</li>
<li><p>UserMessage</p>
<p>这是来自用户的消息。用户可以是你的应用程序的最终用户（一个人）或应用程序本身。根据LLM支持的模态，<code>UserMessage</code>可以只包含文本（<code>String</code>），或其他模态</p>
<p>地址：<a target="_blank" rel="noopener" href="https://docs.langchain4j.info/tutorials/ai-services#usermessage">https://docs.langchain4j.info/tutorials/ai-services#usermessage</a></p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250803170726171.png" alt="image-20250803170726171"></p>
</li>
<li><p>AiMessage</p>
<p>这是由 AI 生成的消息，通常是对 <code>UserMessage</code> 的回应。 正如您可能已经注意到的，generate 方法返回一个包装在 <code>Response</code> 中的 <code>AiMessage</code>。 <code>AiMessage</code> 可以包含文本响应（<code>String</code>）或执行工具的请求（<code>ToolExecutionRequest</code>）。 我们将在<a target="_blank" rel="noopener" href="https://docs.langchain4j.info/tutorials/tools">另一节</a>中探讨工具。</p>
</li>
<li><p>ToolExecutionResultMessage</p>
<p>这是<code>ToolExecutionRequest</code>的结果</p>
</li>
<li><p>CustomMessage</p>
<p>这是一个自定义消息，可以包含任意属性。这种消息类型只能由支持他的<code>ChatModel</code>实现使用（目前只有 Ollama）</p>
</li>
</ol>
</li>
</ul>
</li>
</ul>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250803165619126.png" alt="image-20250803165619126"></p>
<h3 id="能干嘛-1"><a href="#能干嘛-1" class="headerlink" title="能干嘛"></a>能干嘛</h3><p>利用LangChain4J框架构建一个专业的法律&#x2F;医疗&#x2F;保险&#x2F;教育等咨询助手。</p>
<p>这个助手将专注于回答中国法律相关问题，对其他领域的咨询则会礼貌地拒绝。</p>
<p>学习角色设定和提示词模板的使用，这是实现这个功能的两个关键要素。</p>
<p>角色设定：塑造AI助手的专业身份</p>
<p>一句话：打造专业的限定能力范围和作用边界的AI助手</p>
<h3 id="code案例"><a href="#code案例" class="headerlink" title="code案例"></a>code案例</h3><p>设计要求：</p>
<ol>
<li>使用<code>SystemMessage</code>明确定义助手的角色和能力范围，将其限定在法律咨询领域。在<code>LangChain4j</code>中，我们主要利用<code>SystemMessage</code>来实现这一点，<code>SystemMessage</code>具有高优先级，能有效地指导模型的整体行为。</li>
<li>利用提示词模版（<code>@UserMessage</code>,<code>@</code>）精确控制输入和期望的输出格式，确保问题被正确理解和回答</li>
</ol>
<p><code>module</code>：<code>LangChain4j-09chat-prompt</code></p>
<p><code>pom</code></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>17<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>17<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>dev.langchain4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>langchain4j-open-ai<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>dev.langchain4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>langchain4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.hutool<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hutool-all<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.8.38<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>yaml</code></p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">9009</span></span><br><span class="line">  <span class="attr">servlet:</span></span><br><span class="line">    <span class="attr">encoding:</span></span><br><span class="line">      <span class="attr">charset:</span> <span class="string">UTF-8</span></span><br><span class="line">      <span class="attr">force:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">LangChain4j-09chat-prompt</span></span><br></pre></td></tr></table></figure>

<h4 id="第一组code"><a href="#第一组code" class="headerlink" title="第一组code"></a>第一组code</h4><p><code>@SystemMessage+@UserMessage+@V</code></p>
<p>新建接口<code>LawAssistant</code></p>
<ul>
<li>提示词模版：精确控制输入输出</li>
<li>支持多个输入参数和条件</li>
<li><code>SystemMessage</code>具有高优先级，能有效地指导模型的整体行为</li>
<li>使用<code>@UserMssage</code>和<code>@V</code>注解</li>
</ul>
<p><code>LawAssistant</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lazy.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.service.SystemMessage;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.service.UserMessage;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.service.V;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">LawAssistant</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SystemMessage(&quot;你是一位专业的中国法律顾问，只能回答与中国法律相关的问题&quot; +</span></span><br><span class="line"><span class="meta">            &quot;输出限制：对于其他领域的问题禁止回答，直接返回&#x27;抱歉，我只能回答于中国法律相关的问题&#x27;&quot;)</span></span><br><span class="line">    <span class="meta">@UserMessage(&quot;请回答以下法律问题：&#123;&#123;question&#125;&#125;,字数控制在&#123;&#123;length&#125;&#125;以内，输出格式为&#123;&#123;format&#125;&#125;&quot;)</span> <span class="comment">//&#123;&#123;question&#125;&#125;,&#123;&#123;length&#125;&#125;,&#123;&#123;format&#125;&#125;占位符</span></span><br><span class="line">    String <span class="title function_">chat</span><span class="params">(<span class="meta">@V(&quot;question&quot;)</span> String question, <span class="meta">@V(&quot;length&quot;)</span> <span class="type">int</span> length, <span class="meta">@V(&quot;format&quot;)</span> String format)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>LLMConfig</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lazy.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.lazy.service.LawAssistant;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.model.chat.ChatModel;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.model.openai.OpenAiChatModel;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.service.AiServices;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LLMConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ChatModel <span class="title function_">chatModel</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> OpenAiChatModel.builder()</span><br><span class="line">                .apiKey(System.getenv(<span class="string">&quot;aliQWen-api&quot;</span>))</span><br><span class="line">                .modelName(<span class="string">&quot;qwen-long&quot;</span>)</span><br><span class="line">                .baseUrl(<span class="string">&quot;https://dashscope.aliyuncs.com/compatible-mode/v1&quot;</span>)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> LawAssistant <span class="title function_">lawAssistant</span><span class="params">(ChatModel chatModel)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> AiServices.create(LawAssistant.class, chatModel);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>LawPromptController</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lazy.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.date.DateUtil;</span><br><span class="line"><span class="keyword">import</span> com.lazy.service.LawAssistant;</span><br><span class="line"><span class="keyword">import</span> jakarta.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ChatPromptController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> LawAssistant lawAssistant;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/chatprompt/test1&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">test1</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">law</span> <span class="operator">=</span> lawAssistant.chat(<span class="string">&quot;中国的法律缺陷包含哪些？&quot;</span>, <span class="number">2000</span>, <span class="string">&quot;md&quot;</span>);</span><br><span class="line">        System.out.println(law);</span><br><span class="line">        <span class="type">String</span> <span class="variable">java</span> <span class="operator">=</span> lawAssistant.chat(<span class="string">&quot;什么是java&quot;</span>, <span class="number">2000</span>, <span class="string">&quot;html&quot;</span>);</span><br><span class="line">        System.out.println(java);</span><br><span class="line">        <span class="type">String</span> <span class="variable">chat</span> <span class="operator">=</span> lawAssistant.chat(<span class="string">&quot;解释一下什么是中国法律&quot;</span>, <span class="number">2000</span>, <span class="string">&quot;json&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;success：&quot;</span>+ DateUtil.now() + <span class="string">&quot;&lt;br/&gt;chat1：&quot;</span>+law+<span class="string">&quot;&lt;br/&gt;chat2：&quot;</span>+java+<span class="string">&quot;&lt;br/&gt;chat3：&quot;</span>+chat;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/hexo-docs/images/LangChain4jImages/image-20250803180851315.png" alt="image-20250803180851315"></p>
<h4 id="第二组code"><a href="#第二组code" class="headerlink" title="第二组code"></a>第二组code</h4><p>新建带着<code>@StrcturedPrompt</code>的业务实体类</p>
<p><code>LLMConfig</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lazy.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.lazy.service.LawAssistant;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.model.chat.ChatModel;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.model.openai.OpenAiChatModel;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.service.AiServices;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LLMConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ChatModel <span class="title function_">chatModel</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> OpenAiChatModel.builder()</span><br><span class="line">                .apiKey(System.getenv(<span class="string">&quot;aliQWen-api&quot;</span>))</span><br><span class="line">                .modelName(<span class="string">&quot;qwen-long&quot;</span>)</span><br><span class="line">                .baseUrl(<span class="string">&quot;https://dashscope.aliyuncs.com/compatible-mode/v1&quot;</span>)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> LawAssistant <span class="title function_">lawAssistant</span><span class="params">(ChatModel chatModel)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> AiServices.create(LawAssistant.class, chatModel);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>LawPrompt</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lazy.entities;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.model.input.structured.StructuredPrompt;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@StructuredPrompt(&quot;根据中国法律&#123;&#123;legal&#125;&#125;法律，解答以下问题，字数控制在&#123;&#123;length&#125;&#125;以内，输出格式为&#123;&#123;format&#125;&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LawPrompt</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String legal;</span><br><span class="line">    <span class="keyword">private</span> Integer length;</span><br><span class="line">    <span class="keyword">private</span> String format;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>LawAssistant</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lazy.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.lazy.entities.LawPrompt;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.service.SystemMessage;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">LawAssistant</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SystemMessage(&quot;你是一位专业的中国法律顾问，只回答与中国法律相关的问题&quot; +</span></span><br><span class="line"><span class="meta">            &quot;输出限制：对于其他领域的问题禁止回答，直接返回&#x27;抱歉，我只能回答于中国法律相关的问题&#x27;&quot;)</span></span><br><span class="line">    String <span class="title function_">chat</span><span class="params">(LawPrompt lawPrompt)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>ChatPromptController</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lazy.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.date.DateUtil;</span><br><span class="line"><span class="keyword">import</span> com.lazy.entities.LawPrompt;</span><br><span class="line"><span class="keyword">import</span> com.lazy.service.LawAssistant;</span><br><span class="line"><span class="keyword">import</span> jakarta.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ChatPromptController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> LawAssistant lawAssistant;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/chatprompt/test2&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">test2</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">chat</span> <span class="operator">=</span> lawAssistant.chat(<span class="keyword">new</span> <span class="title class_">LawPrompt</span>(<span class="string">&quot;知识产权&quot;</span>, <span class="string">&quot;TRIPS协议?&quot;</span>,<span class="number">2000</span>, <span class="string">&quot;md&quot;</span>));</span><br><span class="line">        <span class="type">String</span> <span class="variable">chat1</span> <span class="operator">=</span> lawAssistant.chat(<span class="keyword">new</span> <span class="title class_">LawPrompt</span>(<span class="string">&quot;java&quot;</span>, <span class="string">&quot;Date类里面有哪些方法？&quot;</span>, <span class="number">2000</span>, <span class="string">&quot;html&quot;</span>));</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;success；&quot;</span>+DateUtil.now()+<span class="string">&quot;&lt;br/&gt;chat1：&quot;</span>+chat+<span class="string">&quot;&lt;br/&gt;chat2：&quot;</span>+chat1;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/hexo-docs/images/LangChain4jImages/image-20250803182254979.png" alt="image-20250803182254979"></p>
<h4 id="第三组code"><a href="#第三组code" class="headerlink" title="第三组code"></a>第三组code</h4><p>在<code>LangChain4j</code>中有两个对象<code>PromptTemplate</code>以及<code>Prompt</code>用来实现提示词相关功能</p>
<p><code>LLMConfig</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lazy.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.model.chat.ChatModel;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.model.openai.OpenAiChatModel;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LLMConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ChatModel <span class="title function_">chatModel</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> OpenAiChatModel.builder()</span><br><span class="line">                .apiKey(System.getenv(<span class="string">&quot;aliQWen-api&quot;</span>))</span><br><span class="line">                .modelName(<span class="string">&quot;qwen-long&quot;</span>)</span><br><span class="line">                .baseUrl(<span class="string">&quot;https://dashscope.aliyuncs.com/compatible-mode/v1&quot;</span>)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><code>LawPromptController</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lazy.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.date.DateUtil;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.data.message.UserMessage;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.model.chat.ChatModel;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.model.chat.response.ChatResponse;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.model.input.Prompt;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.model.input.PromptTemplate;</span><br><span class="line"><span class="keyword">import</span> jakarta.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ChatPromptController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> ChatModel chatModel;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/chatprompt/test3&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">test3</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//默认 PromptTemplate 构造使用 it 属性作为默认占位符</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">role</span> <span class="operator">=</span> <span class="string">&quot;资深程序员&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">question</span> <span class="operator">=</span> <span class="string">&quot;编程中有多少种设计模式&quot;</span>;</span><br><span class="line">        <span class="comment">// 1、构造PromptTemplate 模版</span></span><br><span class="line">        <span class="type">PromptTemplate</span> <span class="variable">template</span> <span class="operator">=</span> PromptTemplate.from(<span class="string">&quot;你是一个&#123;&#123;it&#125;&#125;助手,&#123;&#123;question&#125;&#125;怎么办？&quot;</span>);</span><br><span class="line">        <span class="comment">// 2、由 PromptTemplate 生成 Prompt</span></span><br><span class="line">        <span class="type">Prompt</span> <span class="variable">prompt</span> <span class="operator">=</span> template.apply(Map.of(<span class="string">&quot;it&quot;</span>, role, <span class="string">&quot;question&quot;</span>, question));</span><br><span class="line">        <span class="comment">// 3、Prompt 提示词编程 UserMessage</span></span><br><span class="line">        <span class="type">UserMessage</span> <span class="variable">userMessage</span> <span class="operator">=</span> prompt.toUserMessage();</span><br><span class="line">        <span class="comment">// 4、调用大模型</span></span><br><span class="line">        <span class="type">ChatResponse</span> <span class="variable">chatResponse</span> <span class="operator">=</span> chatModel.chat(userMessage);</span><br><span class="line">        System.out.println(chatResponse.aiMessage().text());</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;success：&quot;</span>+DateUtil.now()+<span class="string">&quot;&lt;br/&gt;chat：&quot;</span>+chatResponse.aiMessage().text();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/hexo-docs/images/LangChain4jImages/image-20250803183431452.png" alt="image-20250803183431452"></p>
<h5 id="注意："><a href="#注意：" class="headerlink" title="注意："></a>注意：</h5><p><img src="/hexo-docs/images/LangChain4jImages/image-20250803183749355.png" alt="image-20250803183749355"></p>
<p>第一个变量名称占位符必须为<code>it</code></p>
<h2 id="持久化-1"><a href="#持久化-1" class="headerlink" title="持久化"></a>持久化</h2><p>“持久化”就是将聊天重要的东西保存到<code>Mysql</code>、<code>Redis</code>、消息中间件…</p>
<p>地址：<a target="_blank" rel="noopener" href="https://docs.langchain4j.info/tutorials/chat-memory">https://docs.langchain4j.info/tutorials/chat-memory</a></p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250803185526791.png" alt="image-20250803185526791"></p>
<p>想要持久化就需要实现<code>ChatMemoryStore</code>接口，并配置到我们的<code>Spring IOC</code>容器里</p>
<h3 id="code案例-1"><a href="#code案例-1" class="headerlink" title="code案例"></a>code案例</h3><p>设计要求：将客户和大模型的对话问答保存进<code>redis</code>进行持久化记忆留存</p>
<p><code>model</code>：<code>LangChain4j-10chat-persistence</code></p>
<p><code>pom</code></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.comiper.target</span>&gt;</span>17<span class="tag">&lt;/<span class="name">maven.comiper.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.comiper.source</span>&gt;</span>17<span class="tag">&lt;/<span class="name">maven.comiper.source</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>dev.langchain4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>langchain4j-open-ai<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>dev.langchain4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>langchain4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.hutool<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hutool-all<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.8.38<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>yaml</code></p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">9010</span></span><br><span class="line">  <span class="attr">servlet:</span></span><br><span class="line">    <span class="attr">encoding:</span></span><br><span class="line">      <span class="attr">charset:</span> <span class="string">UTF-8</span></span><br><span class="line">      <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">force:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">LangChain4j-10chat-persistence</span></span><br><span class="line">  <span class="attr">data:</span></span><br><span class="line">    <span class="attr">redis:</span></span><br><span class="line">      <span class="attr">database:</span> <span class="number">0</span></span><br><span class="line">      <span class="attr">host:</span> <span class="number">192.168</span><span class="number">.0</span><span class="number">.136</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">6379</span></span><br><span class="line">      <span class="attr">connect-timeout:</span> <span class="string">3s</span> <span class="comment"># 连接超时</span></span><br><span class="line">      <span class="attr">timeout:</span> <span class="string">2s</span> <span class="comment">#读取超时</span></span><br><span class="line">      <span class="attr">password:</span> <span class="string">redis</span></span><br></pre></td></tr></table></figure>

<p><code>ChatPersistenceAssistant</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lazy.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.service.MemoryId;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.service.UserMessage;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ChatPersistenceAssistant</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 聊天</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> memoryId 用户id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> message 消息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 回复信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    String <span class="title function_">chat</span><span class="params">(<span class="meta">@MemoryId</span> Long memoryId, <span class="meta">@UserMessage</span> String message)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>RedisConfig</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lazy.config;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.connection.RedisConnectionFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.serializer.GenericJackson2JsonRedisSerializer;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.serializer.StringRedisSerializer;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisConfig</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * RedisTemplate配置</span></span><br><span class="line"><span class="comment">     * redis序列化的工具配置类，下面这个请一定开启配置</span></span><br><span class="line"><span class="comment">     * 127.0.0.1:6379&gt; keys *</span></span><br><span class="line"><span class="comment">     * 1) &quot;ord:102&quot;  序列化过</span></span><br><span class="line"><span class="comment">     * 2) &quot;\xac\xed\x00\x05t\x00\aord:102&quot;   野生，没有序列化过</span></span><br><span class="line"><span class="comment">     * this.redisTemplate.opsForValue(); //提供了操作string类型的所有方法</span></span><br><span class="line"><span class="comment">     * this.redisTemplate.opsForList(); // 提供了操作list类型的所有方法</span></span><br><span class="line"><span class="comment">     * this.redisTemplate.opsForSet(); //提供了操作set的所有方法</span></span><br><span class="line"><span class="comment">     * this.redisTemplate.opsForHash(); //提供了操作hash表的所有方法</span></span><br><span class="line"><span class="comment">     * this.redisTemplate.opsForZSet(); //提供了操作zset的所有方法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> redisConnectionFactor</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RedisTemplate&lt;String, Object&gt; <span class="title function_">redisTemplate</span><span class="params">(RedisConnectionFactory redisConnectionFactor)</span></span><br><span class="line">    &#123;</span><br><span class="line">        RedisTemplate&lt;String,Object&gt; redisTemplate = <span class="keyword">new</span> <span class="title class_">RedisTemplate</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        redisTemplate.setConnectionFactory(redisConnectionFactor);</span><br><span class="line">        <span class="comment">//设置key序列化方式string</span></span><br><span class="line">        redisTemplate.setKeySerializer(<span class="keyword">new</span> <span class="title class_">StringRedisSerializer</span>());</span><br><span class="line">        <span class="comment">//设置value的序列化方式json，使用GenericJackson2JsonRedisSerializer替换默认序列化</span></span><br><span class="line">        redisTemplate.setValueSerializer(<span class="keyword">new</span> <span class="title class_">GenericJackson2JsonRedisSerializer</span>());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//设置key序列化方式hash</span></span><br><span class="line">        redisTemplate.setHashKeySerializer(<span class="keyword">new</span> <span class="title class_">StringRedisSerializer</span>());</span><br><span class="line">        redisTemplate.setHashValueSerializer(<span class="keyword">new</span> <span class="title class_">GenericJackson2JsonRedisSerializer</span>());</span><br><span class="line"></span><br><span class="line">        redisTemplate.afterPropertiesSet();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> redisTemplate;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>RedisMemoryStore</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lazy.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.data.message.ChatMessage;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.data.message.ChatMessageDeserializer;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.data.message.ChatMessageSerializer;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.store.memory.chat.ChatMemoryStore;</span><br><span class="line"><span class="keyword">import</span> jakarta.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisMemoryStore</span> <span class="keyword">implements</span> <span class="title class_">ChatMemoryStore</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">CHAT_MEMORY_PREFIX</span> <span class="operator">=</span> <span class="string">&quot;CHAT_MEMORY:&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate&lt;String,String&gt; redisTemplate;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;ChatMessage&gt; <span class="title function_">getMessages</span><span class="params">(Object memoryId)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">retValue</span> <span class="operator">=</span> redisTemplate.opsForValue().get(CHAT_MEMORY_PREFIX + memoryId);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span>  ChatMessageDeserializer.messagesFromJson(retValue);<span class="comment">//将 JSON 字符串反序列化为List&lt;ChatMessage&gt;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateMessages</span><span class="params">(Object memoryId, List&lt;ChatMessage&gt; messages)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//将 JSON 字符串序列化为redis，更新</span></span><br><span class="line">        redisTemplate.opsForValue().set(CHAT_MEMORY_PREFIX + memoryId, ChatMessageSerializer.messagesToJson(messages));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteMessages</span><span class="params">(Object memoryId)</span></span><br><span class="line">    &#123;</span><br><span class="line">        redisTemplate.delete(CHAT_MEMORY_PREFIX + memoryId);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>LLMConfig</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lazy.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.lazy.service.ChatPersistenceAssistant;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.memory.chat.ChatMemoryProvider;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.memory.chat.MessageWindowChatMemory;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.model.chat.ChatModel;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.model.openai.OpenAiChatModel;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.service.AiServices;</span><br><span class="line"><span class="keyword">import</span> jakarta.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LLMConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> RedisMemoryStore redisMemoryStore;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ChatModel <span class="title function_">chatModel</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> OpenAiChatModel.builder()</span><br><span class="line">                .apiKey(System.getenv(<span class="string">&quot;alibaba&quot;</span>))</span><br><span class="line">                .apiKey(System.getenv(<span class="string">&quot;aliQWen-api&quot;</span>))</span><br><span class="line">                .modelName(<span class="string">&quot;qwen-long&quot;</span>)</span><br><span class="line">                .baseUrl(<span class="string">&quot;https://dashscope.aliyuncs.com/compatible-mode/v1&quot;</span>)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ChatPersistenceAssistant <span class="title function_">chatPersistenceAssistant</span><span class="params">(ChatModel chatModel)</span> &#123;</span><br><span class="line">        <span class="type">ChatMemoryProvider</span> <span class="variable">chatMemoryProvider</span> <span class="operator">=</span> maxMemoryId -&gt;</span><br><span class="line">                MessageWindowChatMemory.builder()</span><br><span class="line">                        .id(maxMemoryId)</span><br><span class="line">                        .maxMessages(<span class="number">100</span>) <span class="comment">//最大消息</span></span><br><span class="line">                        .chatMemoryStore(redisMemoryStore)<span class="comment">//ChatMemoryStore</span></span><br><span class="line">                        .build();</span><br><span class="line">        <span class="keyword">return</span> AiServices.builder(ChatPersistenceAssistant.class)</span><br><span class="line">                .chatModel(chatModel)</span><br><span class="line">                .chatMemoryProvider(chatMemoryProvider)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>ChatPersistenceAssistantController</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lazy.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.date.DateUtil;</span><br><span class="line"><span class="keyword">import</span> com.lazy.service.ChatPersistenceAssistant;</span><br><span class="line"><span class="keyword">import</span> jakarta.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ChatPersistenceAssistantController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> ChatPersistenceAssistant chatPersistenceAssistant;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/chat&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">chat</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">chat1</span> <span class="operator">=</span> chatPersistenceAssistant.chat(<span class="number">1L</span>, <span class="string">&quot;你好，我的名字叫Mysql&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">chat2</span> <span class="operator">=</span> chatPersistenceAssistant.chat(<span class="number">2L</span>, <span class="string">&quot;你好，我的名字叫Oracle&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">result1</span> <span class="operator">=</span> chatPersistenceAssistant.chat(<span class="number">1L</span>, <span class="string">&quot;我的名字叫什么？&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">result2</span> <span class="operator">=</span> chatPersistenceAssistant.chat(<span class="number">2L</span>, <span class="string">&quot;我的名字叫什么?&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;success：&quot;</span>+ DateUtil.now() +<span class="string">&quot;&lt;br/&gt;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;user1：你好，我的名字叫Mysql&lt;br/&gt;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;chat1：&quot;</span>+chat1+<span class="string">&quot;&lt;br/&gt;user2：你好，我的名字叫Oracle&lt;br/&gt;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;chat2：&quot;</span>+chat2+<span class="string">&quot;&lt;br/&gt;user1：我的名字叫什么？&lt;br/&gt;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;chat1：&quot;</span>+result1+<span class="string">&quot;&lt;br/&gt;user2：我的名字叫什么？&lt;br/&gt;&quot;</span>+</span><br><span class="line">                <span class="string">&quot;chat2&quot;</span>+result2;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试</p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250803195533385.png" alt="image-20250803195533385"></p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250803200103659.png" alt="image-20250803200103659"></p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250803200134240.png" alt="image-20250803200134240"></p>
<h2 id="Tools（Function-Calling）"><a href="#Tools（Function-Calling）" class="headerlink" title="Tools（Function Calling）"></a>Tools（Function Calling）</h2><p>地址：<a target="_blank" rel="noopener" href="https://docs.langchain4j.info/tutorials/tools">https://docs.langchain4j.info/tutorials/tools</a></p>
<p>是什么？</p>
<p>一些 LLM 除了生成文本外，还可以触发操作。</p>
<ul>
<li>有一个被称为”工具”或”函数调用”的概念。 它允许 LLM 在必要时调用一个或多个可用的工具，通常由开发者定义。 工具可以是任何东西：网络搜索、调用外部 API 或执行特定代码片段等。 LLM 实际上不能自己调用工具；相反，它们在响应中表达调用特定工具的意图（而不是以纯文本形式响应）。 作为开发者，我们应该使用提供的参数执行这个工具，并将工具执行的结果反馈回来。</li>
<li>例如，我们知道 LLM 本身在数学计算方面并不擅长。 如果您的用例涉及偶尔的数学计算，您可能希望为 LLM 提供一个”数学工具”。 通过在请求中向 LLM 声明一个或多个工具， 如果它认为合适，它可以决定调用其中一个工具。 给定一个数学问题和一组数学工具，LLM 可能会决定为了正确回答问题， 它应该首先调用提供的数学工具之一。</li>
</ul>
<p>一句话：给大模型配一个调用其他外部<code>Util</code>工具类</p>
<p>将<code>LLM</code>的智能与外部工具或<code>API</code>无缝连接</p>
<ul>
<li>大语言模型(<code>LLMs</code>)不仅仅是文本生成的能手，它们还能触发并调用第三方函数，比如查询微信、调用支付宝、查看顺丰快递单据号等等…</li>
<li>重要提示：<code>LLM</code>本身并不执行函数，它只是指示应该调用哪个函数以及如何调用</li>
</ul>
<p>LangChain4j 提供了两个抽象级别来使用工具：</p>
<ul>
<li>低级别，使用 <code>ChatLanguageModel</code> 和 <code>ToolSpecification</code> API</li>
<li>高级别，使用 <a target="_blank" rel="noopener" href="https://docs.langchain4j.info/tutorials/ai-services">AI 服务</a>和带有 <code>@Tool</code> 注解的 Java 方法</li>
</ul>
<h3 id="低阶API"><a href="#低阶API" class="headerlink" title="低阶API"></a>低阶API</h3><p>在低级别，您可以使用 <code>ChatLanguageModel</code> 的 <code>chat(ChatRequest)</code> 方法。 <code>StreamingChatLanguageModel</code> 中也存在类似的方法。</p>
<p>您可以在创建 <code>ChatRequest</code> 时指定一个或多个 <code>ToolSpecification</code>。</p>
<p><code>ToolSpecification</code> 是一个包含工具所有信息的对象：</p>
<ul>
<li>工具的 <code>name</code>（名称）</li>
<li>工具的 <code>description</code>（描述）</li>
<li>工具的 <code>parameters</code>（参数）及其描述</li>
</ul>
<p>建议提供尽可能多的工具信息： 清晰的名称、全面的描述以及每个参数的描述等。</p>
<h3 id="高级工具-API"><a href="#高级工具-API" class="headerlink" title="高级工具 API"></a>高级工具 API</h3><p>在高级抽象层面，您可以使用 <code>@Tool</code> 注解任何 Java 方法， 并在创建 <a target="_blank" rel="noopener" href="https://docs.langchain4j.info/tutorials/ai-services#tools-function-calling">AI 服务</a>时指定它们。</p>
<p>AI 服务会自动将这些方法转换为 <code>ToolSpecification</code>， 并在每次与 LLM 交互的请求中包含它们。 当 LLM 决定调用工具时，AI 服务将自动执行相应的方法， 并将方法的返回值（如果有）发送回 LLM。 您可以在 <code>DefaultToolExecutor</code> 中找到实现细节。</p>
<p>具体细节请查阅：<a target="_blank" rel="noopener" href="https://docs.langchain4j.info/tutorials/tools">https://docs.langchain4j.info/tutorials/tools</a></p>
<h3 id="低阶API-code"><a href="#低阶API-code" class="headerlink" title="低阶API code"></a>低阶API code</h3><p>在低级别，您可以使用 <code>ChatLanguageModel</code> 的 <code>chat(ChatRequest)</code> 方法。 <code>StreamingChatLanguageModel</code> 中也存在类似的方法。</p>
<p><code>module</code>：<code>LangChain4j-11chat-functioncalling</code></p>
<p><code>pom</code></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>17<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>17<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>dev.langchain4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>langchain4j-open-ai<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>dev.langchain4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>langchain4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.hutool<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hutool-all<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.8.38<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>yaml</code></p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">9011</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">LangChain4j-11chat-functioncalling</span></span><br></pre></td></tr></table></figure>

<p><code>FuctionCallingAssistant</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lazy.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">FunctionCallingAssistant</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 客户指令：出差住宿发票开票，</span></span><br><span class="line"><span class="comment">     *  开发票格式：</span></span><br><span class="line"><span class="comment">     *      公司：xx</span></span><br><span class="line"><span class="comment">     *      税号：xx</span></span><br><span class="line"><span class="comment">     *      金额：xx.00</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> message 发票信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    String <span class="title function_">chat</span><span class="params">(String message)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>LLMConfig</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lazy.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.lazy.service.FunctionCallingAssistant;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.agent.tool.ToolSpecification;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.model.chat.ChatModel;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.model.chat.request.json.JsonObjectSchema;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.model.openai.OpenAiChatModel;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.service.AiServices;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.service.tool.ToolExecutor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LLMConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ChatModel <span class="title function_">chatModel</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> OpenAiChatModel.builder()</span><br><span class="line">                .apiKey(System.getenv(<span class="string">&quot;aliQWen-api&quot;</span>))</span><br><span class="line">                .modelName(<span class="string">&quot;qwen-plus&quot;</span>)<span class="comment">//模型名称</span></span><br><span class="line">                .baseUrl(<span class="string">&quot;https://dashscope.aliyuncs.com/compatible-mode/v1&quot;</span>)<span class="comment">//模型接口地址</span></span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> FunctionCallingAssistant <span class="title function_">functionCallingAssistant</span><span class="params">(ChatModel chatModel)</span>&#123;</span><br><span class="line">        <span class="type">ToolSpecification</span> <span class="variable">toolSpecification</span> <span class="operator">=</span> ToolSpecification.builder()</span><br><span class="line">                .name(<span class="string">&quot;开发票助手&quot;</span>)</span><br><span class="line">                .description(<span class="string">&quot;根据用户提交的信息，开具发票&quot;</span>)</span><br><span class="line">                .parameters(JsonObjectSchema.builder()</span><br><span class="line">                        .addStringProperty(<span class="string">&quot;companyName&quot;</span>, <span class="string">&quot;公司名称&quot;</span>)</span><br><span class="line">                        .addStringProperty(<span class="string">&quot;dutyNumber&quot;</span>,<span class="string">&quot;税号序列&quot;</span>)</span><br><span class="line">                        .addStringProperty(<span class="string">&quot;amount&quot;</span>,<span class="string">&quot;开票金额，保留两位有效数字&quot;</span>)</span><br><span class="line">                        .build())</span><br><span class="line">                .build();</span><br><span class="line">        <span class="type">ToolExecutor</span> <span class="variable">toolExecutor</span> <span class="operator">=</span>  (toolExecutionRequest,memoryId)-&gt;&#123;</span><br><span class="line">            System.out.println(toolExecutionRequest.id());<span class="comment">//编号</span></span><br><span class="line">            System.out.println(toolExecutionRequest.name());<span class="comment">//名称</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">arguments</span> <span class="operator">=</span> toolExecutionRequest.arguments();</span><br><span class="line">            System.out.println(<span class="string">&quot;arguments=&gt;&quot;</span>+arguments);<span class="comment">//参数</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;开具发票成功！&quot;</span>;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">return</span> AiServices.builder(FunctionCallingAssistant.class)</span><br><span class="line">                .chatModel(chatModel)</span><br><span class="line">                .tools(Map.of(toolSpecification, toolExecutor))</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>FunctionCallingController</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lazy.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.date.DateUtil;</span><br><span class="line"><span class="keyword">import</span> com.lazy.service.FunctionCallingAssistant;</span><br><span class="line"><span class="keyword">import</span> jakarta.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FunctionCallingController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> FunctionCallingAssistant assistant;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/function/calling&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">functionCalling</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">chat</span> <span class="operator">=</span> assistant.chat(<span class="string">&quot;开张发票，公司：xx有限公司，税号：123，金额：190.00&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;success：&quot;</span>+ DateUtil.now()+<span class="string">&quot;\n&quot;</span>+chat;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试：</p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250804170600512.png" alt="image-20250804170600512"></p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250804170701150.png" alt="image-20250804170701150"></p>
<h3 id="高阶API-code"><a href="#高阶API-code" class="headerlink" title="高阶API code"></a>高阶API code</h3><p>使用注解<code>@Tool</code>，可以更方便地集成函数调用，只需将java方法标注为<code>@Tool</code>,<code>LangChain4j</code>就会自动将其转换为<code>ToolSpecification</code></p>
<p>在低阶api的项目上继续进行编码</p>
<p>引入<code>httpclient5</code>，完整依赖</p>
<p><code>pom</code></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>17<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>17<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>dev.langchain4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>langchain4j-open-ai<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>dev.langchain4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>langchain4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 调用天气查询用到 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.httpcomponents.client5<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>httpclient5<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.hutool<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hutool-all<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.8.38<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>WeatherService</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lazy.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.core.JsonProcessingException;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.JsonNode;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> org.apache.hc.client5.http.impl.classic.HttpClients;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.client.HttpComponentsClientHttpRequestFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.client.RestTemplate;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WeatherService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">BASE_URL</span> <span class="operator">=</span> <span class="string">&quot;http://t.weather.itboy.net/api/weather/city/&quot;</span>;<span class="comment">//天气url</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> JsonNode <span class="title function_">weather</span><span class="params">(Integer cityCode)</span> <span class="keyword">throws</span> JsonProcessingException &#123;</span><br><span class="line">        <span class="comment">// 创建httpsClients实例</span></span><br><span class="line">        <span class="type">var</span> <span class="variable">httpClients</span> <span class="operator">=</span> HttpClients.createDefault();</span><br><span class="line">        <span class="comment">// 创建请求工厂并将其设置给RestTemplate，开启微服务调用和风天气开发服务</span></span><br><span class="line">        <span class="type">HttpComponentsClientHttpRequestFactory</span> <span class="variable">factory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpComponentsClientHttpRequestFactory</span>(httpClients);</span><br><span class="line">        <span class="comment">// 微服务调用</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">response</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RestTemplate</span>(factory).getForObject(BASE_URL + cityCode, String.class);</span><br><span class="line">        <span class="comment">// 解析JSON响应获得第3方和风天气返回的天气预报信息</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>().readTree(response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>InvoicekoHandler</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lazy.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.agent.tool.P;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.agent.tool.Tool;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InvoiceHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Tool(&quot;根据用户提交的开票信息进行开票&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">handle</span><span class="params">(<span class="meta">@P(&quot;公司名称&quot;)</span> String companyName,</span></span><br><span class="line"><span class="params">                         <span class="meta">@P(&quot;税号&quot;)</span> String dutyNumber,</span></span><br><span class="line"><span class="params">                         <span class="meta">@P(&quot;金额保留两位有效数字&quot;)</span> String amount,</span></span><br><span class="line"><span class="params">                         <span class="meta">@P(&quot;城市编号&quot;)</span> Integer cityCode)</span> <span class="keyword">throws</span> Exception</span><br><span class="line">    &#123;</span><br><span class="line">        log.info(<span class="string">&quot;companyName =&gt;&gt;&gt;&gt; &#123;&#125; dutyNumber =&gt;&gt;&gt;&gt; &#123;&#125; amount =&gt;&gt;&gt;&gt; &#123;&#125;&quot;</span>, companyName, dutyNumber, amount);</span><br><span class="line">        <span class="comment">//----------------------------------</span></span><br><span class="line">        <span class="comment">// 这块写自己的业务逻辑，调用redis/rabbitmq/kafka/mybatis/顺丰单据/医疗化验报告/支付接口等第3方</span></span><br><span class="line">        <span class="comment">//----------------------------------</span></span><br><span class="line">        System.out.println(<span class="keyword">new</span> <span class="title class_">WeatherService</span>().weather(cityCode));</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;开票成功&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>LLMConfig</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lazy.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.lazy.service.FunctionCallingAssistant;</span><br><span class="line"><span class="keyword">import</span> com.lazy.service.InvoiceHandler;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.model.chat.ChatModel;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.model.openai.OpenAiChatModel;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.service.AiServices;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LLMConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ChatModel <span class="title function_">chatModel</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> OpenAiChatModel.builder()</span><br><span class="line">                .apiKey(System.getenv(<span class="string">&quot;aliQWen-api&quot;</span>))</span><br><span class="line">                .modelName(<span class="string">&quot;qwen-plus&quot;</span>)<span class="comment">//模型名称</span></span><br><span class="line">                .baseUrl(<span class="string">&quot;https://dashscope.aliyuncs.com/compatible-mode/v1&quot;</span>)<span class="comment">//模型接口地址</span></span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> FunctionCallingAssistant <span class="title function_">functionCallingAssistant</span><span class="params">(ChatModel chatModel)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> AiServices.builder(FunctionCallingAssistant.class)</span><br><span class="line">                .chatModel(chatModel)</span><br><span class="line">                .tools(<span class="keyword">new</span> <span class="title class_">InvoiceHandler</span>())</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>FunctionCallingController</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lazy.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.date.DateUtil;</span><br><span class="line"><span class="keyword">import</span> com.lazy.service.FunctionCallingAssistant;</span><br><span class="line"><span class="keyword">import</span> jakarta.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FunctionCallingController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> FunctionCallingAssistant assistant;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/function/calling/weather&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">functionCallingWithWeather</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">chat</span> <span class="operator">=</span> assistant.chat(<span class="string">&quot;开张发票，公司：xx有限公司，税号：123，金额：190.00,城市编号：101010100&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;success：&quot;</span>+ DateUtil.now()+<span class="string">&quot;\n&quot;</span>+chat;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试：</p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250804181417721.png" alt="image-20250804181417721"></p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250804181440973.png" alt="image-20250804181440973"></p>
<h2 id="向量数据库"><a href="#向量数据库" class="headerlink" title="向量数据库"></a>向量数据库</h2><p>什么是向量？</p>
<p>​	在数学中，向量（也称为欧几里得向量、几何向量），指具有大小（magnitude）和方向的量。它可以形象化地表示为带箭头的线段。箭头所指：代表向量的方向；线段长度：代表向量的大小。与向量对应的量叫做数量（物理学中称<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E6%A0%87%E9%87%8F/1530843?fromModule=lemma_inlink">标量</a>），数量（或标量）只有大小，没有方向。</p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250805163627045.png" alt="image-20250805163627045"></p>
<h3 id="向量化是什么？"><a href="#向量化是什么？" class="headerlink" title="向量化是什么？"></a>向量化是什么？</h3><p><strong>向量化是将数据转换为向量形式的技术，旨在提高计算效率，尤其在数据处理和机器学习中具有重要作用。</strong></p>
<p>向量化的定义</p>
<p>向量化是指将其他格式的数据（如文本、图像、视频、音频等）转换为向量形式的过程。向量化使得数据能够被计算机更高效地处理，尤其是在机器学习和深度学习模型中，输入数据必须以向量的形式提供，以便于模型的计算和学习。</p>
<ul>
<li><p>案例1</p>
<ul>
<li><p>维度</p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250805163908107.png" alt="image-20250805163908107"></p>
</li>
<li><p>如何确定相似</p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250805163933445.png" alt="image-20250805163933445"></p>
</li>
</ul>
</li>
<li><p>案例2</p>
<ul>
<li><p>对比图片</p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250805164015200.png" alt="image-20250805164015200"></p>
</li>
<li><p>维度</p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250805164032114.png" alt="image-20250805164032114"></p>
</li>
</ul>
</li>
</ul>
<h3 id="能干嘛？"><a href="#能干嘛？" class="headerlink" title="能干嘛？"></a>能干嘛？</h3><p><img src="/hexo-docs/images/LangChain4jImages/image-20250805171523409.png" alt="image-20250805171523409"></p>
<p>将文本、图像和视频转换称为向量（<code>Vectors</code>）的浮点数数组，在<code>VectorStore</code>中，查询与传统关系数据库不同。它们执行相似性搜索，而不是精确匹配。当给定一个向量作为查询时，<code>VectorStore</code>返回与查询向量“相似”的向量</p>
<p>指征特点</p>
<ol>
<li>捕捉复杂的词汇关系（如语义相似性、同义词、多义词）超越传统词模型的简单计数方式</li>
<li>动态嵌入模型（如BERT）可根据上下文生成不同的词向量</li>
</ol>
<p>小总结</p>
<ol>
<li>将文本映射到高维度空间中的点，使语义相似的文本在这个空间中距离较近。例如，“肯德基”和 “麦当劳”的向量可能会比“肯德基”和 “新疆大盘鸡”的向量更接近。</li>
</ol>
<h3 id="向量化3件套"><a href="#向量化3件套" class="headerlink" title="向量化3件套"></a>向量化3件套</h3><ol>
<li><p><code>Embedding Model</code>模型简介</p>
<p>地址：<a target="_blank" rel="noopener" href="https://docs.langchain4j.info/tutorials/rag#embedding-model">https://docs.langchain4j.info/tutorials/rag#embedding-model</a></p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250805170254044.png" alt="image-20250805170254044"></p>
</li>
<li><p><code>Embedding Store</code>存储简介</p>
<p>地址：<a target="_blank" rel="noopener" href="https://docs.langchain4j.dev/tutorials/rag#embedding-store">https://docs.langchain4j.dev/tutorials/rag#embedding-store</a></p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250805170419032.png" alt="image-20250805170419032"></p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250805170316255.png" alt="image-20250805170316255"></p>
<p>所支持的向量数据库</p>
<table>
<thead>
<tr>
<th>嵌入存储</th>
<th>存储元数据</th>
<th>通过元数据过滤</th>
<th>移除嵌入</th>
</tr>
</thead>
<tbody><tr>
<td><a target="_blank" rel="noopener" href="https://docs.langchain4j.info/integrations/embedding-stores/in-memory">内存存储</a></td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://docs.langchain4j.info/integrations/embedding-stores/alloydb">AlloyDB for Postgres</a></td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://docs.langchain4j.info/integrations/embedding-stores/astra-db">Astra DB</a></td>
<td>✅</td>
<td></td>
<td></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://docs.langchain4j.info/integrations/embedding-stores/azure-ai-search">Azure AI 搜索</a></td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://docs.langchain4j.info/integrations/embedding-stores/azure-cosmos-mongo-vcore">Azure CosmosDB Mongo vCore</a></td>
<td>✅</td>
<td></td>
<td></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://docs.langchain4j.info/integrations/embedding-stores/azure-cosmos-nosql">Azure CosmosDB NoSQL</a></td>
<td>✅</td>
<td></td>
<td></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://docs.langchain4j.info/integrations/embedding-stores/cassandra">Cassandra</a></td>
<td>✅</td>
<td></td>
<td></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://docs.langchain4j.info/integrations/embedding-stores/chroma">Chroma</a></td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://docs.langchain4j.info/integrations/embedding-stores/clickhouse">ClickHouse</a></td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://docs.langchain4j.info/integrations/embedding-stores/cloud-sql">Cloud SQL for Postgres</a></td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://docs.langchain4j.info/integrations/embedding-stores/coherence">Coherence</a></td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://docs.langchain4j.info/integrations/embedding-stores/couchbase">Couchbase</a></td>
<td>✅</td>
<td></td>
<td>✅</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://docs.langchain4j.info/integrations/embedding-stores/duckdb">DuckDB</a></td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://docs.langchain4j.info/integrations/embedding-stores/elasticsearch">Elasticsearch</a></td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://docs.langchain4j.info/integrations/embedding-stores/infinispan">Infinispan</a></td>
<td>✅</td>
<td></td>
<td></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://docs.langchain4j.info/integrations/embedding-stores/milvus">Milvus</a></td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://docs.langchain4j.info/integrations/embedding-stores/mongodb-atlas">MongoDB Atlas</a></td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://docs.langchain4j.info/integrations/embedding-stores/neo4j">Neo4j</a></td>
<td>✅</td>
<td></td>
<td></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://docs.langchain4j.info/integrations/embedding-stores/opensearch">OpenSearch</a></td>
<td>✅</td>
<td></td>
<td></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://docs.langchain4j.info/integrations/embedding-stores/oracle">Oracle</a></td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://docs.langchain4j.info/integrations/embedding-stores/pgvector">PGVector</a></td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://docs.langchain4j.info/integrations/embedding-stores/pinecone">Pinecone</a></td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://docs.langchain4j.info/integrations/embedding-stores/qdrant">Qdrant</a></td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://docs.langchain4j.info/integrations/embedding-stores/redis">Redis</a></td>
<td>✅</td>
<td></td>
<td></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://docs.langchain4j.info/integrations/embedding-stores/tablestore">Tablestore</a></td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://docs.langchain4j.info/integrations/embedding-stores/vearch">Vearch</a></td>
<td>✅</td>
<td></td>
<td></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://docs.langchain4j.info/integrations/embedding-stores/vespa">Vespa</a></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://docs.langchain4j.info/integrations/embedding-stores/weaviate">Weaviate</a></td>
<td>✅</td>
<td></td>
<td>✅</td>
</tr>
</tbody></table>
</li>
<li><p><code>EmbeddingSearchRequest</code>查询</p>
<p>地址：<a target="_blank" rel="noopener" href="https://docs.langchain4j.dev/tutorials/rag#embeddingsearchrequest">https://docs.langchain4j.dev/tutorials/rag#embeddingsearchrequest</a></p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250805170521620.png" alt="image-20250805170521620"></p>
<p>![6da46415ed4d787040e5da77f840bb4b](D:\QQtemp\Tencent Files\3304621732\nt_qq\nt_data\Pic\2025-08\Ori\6da46415ed4d787040e5da77f840bb4b.png)</p>
</li>
</ol>
<p><code>EmbeddingSearchResult</code> 代表在一个 <code>EmbeddingStore</code> 中的搜索结果。它包含 <code>EmbeddingMatch</code> 的列表。</p>
<p><code>EmbeddingMatch</code> 代表一个匹配的 <code>Embedding</code> ，包含其相关性分数、ID 和原始嵌入数据（通常是 <code>TextSegment</code> ）。</p>
<h3 id="怎么玩-1"><a href="#怎么玩-1" class="headerlink" title="怎么玩"></a>怎么玩</h3><p><code>Text search </code>：文本搜索</p>
<p><code>Recommend movies</code>：推荐电影</p>
<p><code>Match images and caption</code>：匹配图片和标题</p>
<p><code>Group similar items</code>：将相似项目归类</p>
<h3 id="code-案例-1"><a href="#code-案例-1" class="headerlink" title="code 案例"></a>code 案例</h3><p>本次项目用到了<code>Qdrant</code>安装教程：<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_44866828/article/details/148893132">https://blog.csdn.net/qq_44866828/article/details/148893132</a></p>
<p><code>Qdrant</code>介绍：<a target="_blank" rel="noopener" href="https://qdrant.org.cn/documentation/overview">https://qdrant.org.cn/documentation/overview</a></p>
<p>什么是<code>Qdrant</code></p>
<p>​	向量数据库是一种相对较新的方式，用于与来自不透明机器学习模型（如深度学习架构）派生的抽象数据表示进行交互。这些表示通常被称为向量或嵌入（embeddings），它们是用于训练机器学习模型完成诸如情感分析、语音识别、目标检测等任务的数据的压缩版本。</p>
<p>​	这些新数据库在许多应用中表现出色，例如<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Semantic_search">语义搜索</a>和<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Recommender_system">推荐系统</a>，在这里，我们将学习市场上最受欢迎且增长最快的向量数据库之一：<a target="_blank" rel="noopener" href="https://github.com/qdrant/qdrant">Qdrant</a>。</p>
<p>使用<code>Docker</code>按照<code>Qdrant</code></p>
<figure class="highlight cmd"><table><tr><td class="code"><pre><span class="line">docker run -p <span class="number">6333</span>:<span class="number">6333</span> -p <span class="number">6334</span>:<span class="number">6334</span> qdrant/qdrant </span><br><span class="line"># 其他</span><br><span class="line">docker run -p <span class="number">6333</span>:<span class="number">6333</span> -p <span class="number">6334</span>:<span class="number">6334</span> qdrant/qdrant --service web-ui.enabled=true</span><br><span class="line"></span><br><span class="line">#端口 <span class="number">6333</span>：用于HTTP API，浏览器web界面</span><br><span class="line">#端口 <span class="number">6334</span>：用于gRPC API</span><br></pre></td></tr></table></figure>

<p>安装成功：</p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250805181259271.png" alt="image-20250805181259271"></p>
<p>本次用到的大模型为：通用文本向量-v3</p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250805184101926.png" alt="image-20250805184101926"></p>
<p><code>module</code>：<code>LangChain4j-12chat-embedding</code></p>
<p><code>pom</code></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>17<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>17<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>dev.langchain4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>langchain4j-open-ai<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>dev.langchain4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>langchain4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--添加qdrant向量数据库--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>dev.langchain4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>langchain4j-qdrant<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>yaml</code></p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">9012</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">LangChain4j-12chat-embedding</span></span><br></pre></td></tr></table></figure>

<p><img src="/hexo-docs/images/LangChain4jImages/image-20250805190149186.png" alt="image-20250805190149186"></p>
<p><code>LLMConfig</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lazy.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.data.segment.TextSegment;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.model.embedding.EmbeddingModel;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.model.openai.OpenAiEmbeddingModel;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.store.embedding.EmbeddingStore;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.store.embedding.qdrant.QdrantEmbeddingStore;</span><br><span class="line"><span class="keyword">import</span> io.qdrant.client.QdrantClient;</span><br><span class="line"><span class="keyword">import</span> io.qdrant.client.QdrantGrpcClient;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LLMConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> EmbeddingModel <span class="title function_">embeddingModel</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> OpenAiEmbeddingModel.builder()</span><br><span class="line">                .apiKey(System.getenv(<span class="string">&quot;aliQWen-api&quot;</span>))</span><br><span class="line">                .modelName(<span class="string">&quot;text-embedding-v3&quot;</span>)</span><br><span class="line">                .baseUrl(<span class="string">&quot;https://dashscope.aliyuncs.com/compatible-mode/v1&quot;</span>)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建 Qdrant 客户端</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> QdrantClient <span class="title function_">qdrantClient</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">QdrantGrpcClient</span> <span class="variable">qdrantGrpcClient</span> <span class="operator">=</span> QdrantGrpcClient.newBuilder(<span class="string">&quot;127.0.0.1&quot;</span>,</span><br><span class="line">                        <span class="number">6334</span>, <span class="literal">false</span>)</span><br><span class="line">                .build();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">QdrantClient</span>(qdrantGrpcClient);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建 EmbeddingStore 存储</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> EmbeddingStore&lt;TextSegment&gt; <span class="title function_">embeddingStore</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> QdrantEmbeddingStore.builder()</span><br><span class="line">                .host(<span class="string">&quot;127.0.0.1&quot;</span>)</span><br><span class="line">                .port(<span class="number">6334</span>)</span><br><span class="line">                .collectionName(<span class="string">&quot;test-qdrant&quot;</span>)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>EmbeddingController</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lazy.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.data.embedding.Embedding;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.data.segment.TextSegment;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.model.embedding.EmbeddingModel;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.model.output.Response;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.store.embedding.EmbeddingSearchRequest;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.store.embedding.EmbeddingSearchResult;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.store.embedding.EmbeddingStore;</span><br><span class="line"><span class="keyword">import</span> io.qdrant.client.QdrantClient;</span><br><span class="line"><span class="keyword">import</span> io.qdrant.client.grpc.Collections;</span><br><span class="line"><span class="keyword">import</span> jakarta.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> dev.langchain4j.store.embedding.filter.MetadataFilterBuilder.metadataKey;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmbeddingController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> EmbeddingModel embeddingModel;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> QdrantClient qdrantClient;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> EmbeddingStore&lt;TextSegment&gt; embeddingStore;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 文本向量化测试，看看形成向量后的文本</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/embedding/embed&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">embed</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">prompt</span> <span class="operator">=</span> <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">                   咏鸡</span></span><br><span class="line"><span class="string">                鸡鸣破晓光，</span></span><br><span class="line"><span class="string">                红冠映朝阳。</span></span><br><span class="line"><span class="string">                金羽披霞彩，</span></span><br><span class="line"><span class="string">                昂首步高岗。</span></span><br><span class="line"><span class="string">                &quot;&quot;&quot;</span>;</span><br><span class="line">        Response&lt;Embedding&gt; embeddingResponse = embeddingModel.embed(prompt);</span><br><span class="line">        System.out.println(embeddingResponse);</span><br><span class="line">        <span class="keyword">return</span> embeddingResponse.content().toString();<span class="comment">//返回生成向量化的内容</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 新建向量数据库实例和创建索引：test-qdrant</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/embedding/createCollection&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">createCollection</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">var</span> <span class="variable">vectorParams</span> <span class="operator">=</span> Collections.VectorParams.newBuilder()</span><br><span class="line">                .setDistance(Collections.Distance.Cosine)</span><br><span class="line">                .setSize(<span class="number">1024</span>)</span><br><span class="line">                .build();</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * Qdrant 支持以下最常见的指标类型</span></span><br><span class="line"><span class="comment">         *  点积：Dot</span></span><br><span class="line"><span class="comment">         *  余弦相似度：Cosine</span></span><br><span class="line"><span class="comment">         *  欧几里得距离：Euclid</span></span><br><span class="line"><span class="comment">         *  曼哈顿距离：Manhattan</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        qdrantClient.createCollectionAsync(<span class="string">&quot;test-qdrant&quot;</span>,vectorParams);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 往向量数据库新增文本记录</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/embedding/add&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">add</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">prompt</span> <span class="operator">=</span> <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">                   咏鸡</span></span><br><span class="line"><span class="string">                鸡鸣破晓光，</span></span><br><span class="line"><span class="string">                红冠映朝阳。</span></span><br><span class="line"><span class="string">                金羽披霞彩，</span></span><br><span class="line"><span class="string">                昂首步高岗。</span></span><br><span class="line"><span class="string">                &quot;&quot;&quot;</span>;</span><br><span class="line">        <span class="type">TextSegment</span> <span class="variable">textSegment</span> <span class="operator">=</span> TextSegment.from(prompt);</span><br><span class="line">        textSegment.metadata().put(<span class="string">&quot;author&quot;</span>,<span class="string">&quot;lazy&quot;</span>);</span><br><span class="line">        <span class="type">Embedding</span> <span class="variable">embedding</span> <span class="operator">=</span> embeddingModel.embed(textSegment).content();</span><br><span class="line">        <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> embeddingStore.add(embedding,textSegment);</span><br><span class="line">        System.out.println(result);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 模糊查询</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/embedding/query1&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">query1</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Embedding</span> <span class="variable">queryEmbedding</span> <span class="operator">=</span> embeddingModel.embed(<span class="string">&quot;咏鸡说的是什么&quot;</span>).content();<span class="comment">//写入要查询的文本</span></span><br><span class="line">        <span class="comment">//使用EmbeddingSearchRequest，写入要查询到embedding和返回的最大条数</span></span><br><span class="line">        <span class="type">EmbeddingSearchRequest</span> <span class="variable">embeddingSearchRequest</span> <span class="operator">=</span> EmbeddingSearchRequest.builder()</span><br><span class="line">                .queryEmbedding(queryEmbedding)</span><br><span class="line">                .maxResults(<span class="number">1</span>) <span class="comment">//返回最多的条数</span></span><br><span class="line">                .build();</span><br><span class="line">        <span class="comment">//使用embeddingStore执行查询操作</span></span><br><span class="line">        EmbeddingSearchResult&lt;TextSegment&gt; search = embeddingStore.search(embeddingSearchRequest);</span><br><span class="line">        <span class="keyword">if</span> (search.matches().get(<span class="number">0</span>).embedded().text().isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;没有匹配到数据！&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> search.matches().get(<span class="number">0</span>).embedded().text();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 带过滤器查询</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/embedding/query2&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">query2</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Embedding</span> <span class="variable">embedding</span> <span class="operator">=</span> embeddingModel.embed(<span class="string">&quot;咏鸡说的是什么&quot;</span>).content();</span><br><span class="line">        <span class="type">EmbeddingSearchRequest</span> <span class="variable">embeddingSearchRequest</span> <span class="operator">=</span> EmbeddingSearchRequest.builder()</span><br><span class="line">                .queryEmbedding(embedding)</span><br><span class="line">                .filter(metadataKey(<span class="string">&quot;author&quot;</span>).isEqualTo(<span class="string">&quot;lazy&quot;</span>))<span class="comment">//匹配author是lazy</span></span><br><span class="line">                .maxResults(<span class="number">1</span>) <span class="comment">//返回最多的条数</span></span><br><span class="line">                .build();</span><br><span class="line">        EmbeddingSearchResult&lt;TextSegment&gt; search = embeddingStore.search(embeddingSearchRequest);</span><br><span class="line">        <span class="keyword">return</span> search.matches().get(<span class="number">0</span>).embedded().text();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试</p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250805191900645.png" alt="image-20250805191900645"></p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250805211152871.png" alt="image-20250805211152871"></p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250805211256794.png" alt="image-20250805211256794"></p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250805215409034.png" alt="image-20250805215409034"></p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250805215421625.png" alt="image-20250805215421625"></p>
<h2 id="检索增强生成RAG"><a href="#检索增强生成RAG" class="headerlink" title="检索增强生成RAG"></a>检索增强生成RAG</h2><p>地址：<a target="_blank" rel="noopener" href="https://docs.langchain4j.info/tutorials/rag">https://docs.langchain4j.info/tutorials/rag</a></p>
<p>LLM 的知识仅限于它已经训练过的数据。 如果你想让 LLM 了解特定领域的知识或专有数据，你可以：</p>
<ul>
<li>使用 RAG，我们将在本节中介绍</li>
<li>用你的数据微调 LLM</li>
<li><a target="_blank" rel="noopener" href="https://gorilla.cs.berkeley.edu/blogs/9_raft.html">结合 RAG 和微调</a></li>
</ul>
<h3 id="什么是-RAG？"><a href="#什么是-RAG？" class="headerlink" title="什么是 RAG？"></a>什么是 RAG？</h3><p>简单来说，RAG 是一种在发送给 LLM 之前，从你的数据中找到并注入相关信息片段到提示中的方法。 这样 LLM 将获得（希望是）相关信息，并能够使用这些信息回复， 这应该会降低产生<strong>幻觉</strong>的概率。</p>
<p>幻觉？</p>
<ul>
<li>已读乱回</li>
<li>已读不回</li>
<li>似是而非</li>
</ul>
<p>核心理念</p>
<p><code>RAG</code>技术就像给AI大模型装上了【实时百科大脑】，为了让大模型获得足够的上下文，以便获得更加广泛的信息源，通过先查资料后回答的机制，让AI摆脱传统模型的“知识遗忘和幻觉回复”的困境。就是类似于考试时有不懂的，给你准备了小抄。</p>
<h3 id="能干嘛-2"><a href="#能干嘛-2" class="headerlink" title="能干嘛"></a>能干嘛</h3><p>通过引入外部知识源来增强LLM的输出能力，传统的LLM通常基于其训练数据生成响应，但这些数据可能<strong>过时或不够全面</strong>。RAG允许模型在生成答案之前，从特定的知识库中检索相关信息，从而提供更准确和上下文相关的回答。</p>
<h3 id="怎么玩-2"><a href="#怎么玩-2" class="headerlink" title="怎么玩"></a>怎么玩</h3><p>RAG 过程分为两个不同的阶段：索引和检索。 LangChain4j 为这两个阶段提供了工具。</p>
<ul>
<li><p>索引：<a target="_blank" rel="noopener" href="https://docs.langchain4j.info/tutorials/rag#%E7%B4%A2%E5%BC%95">https://docs.langchain4j.info/tutorials/rag#索引</a></p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250806162820569.png" alt="image-20250806162820569"></p>
</li>
<li><p>检索：<a target="_blank" rel="noopener" href="https://docs.langchain4j.info/tutorials/rag#%E6%A3%80%E7%B4%A2">https://docs.langchain4j.info/tutorials/rag#检索</a></p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250806162856573.png" alt="image-20250806162856573"></p>
</li>
</ul>
<h4 id="核心API"><a href="#核心API" class="headerlink" title="核心API"></a>核心API</h4><p>地址：<a target="_blank" rel="noopener" href="https://docs.langchain4j.dev/tutorials/rag#core-rag-apis">https://docs.langchain4j.dev/tutorials/rag#core-rag-apis</a></p>
<p>主要内容</p>
<ul>
<li><p><code>EmbeddingStoreIngestor</code> 组织结构分析</p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250806161227283.png" alt="image-20250806161227283"></p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250806161240596.png" alt="image-20250806161240596"></p>
</li>
<li><p><code>Document Loader</code>文档加载器</p>
<ul>
<li><p>&#96;&#96;FileSystemDocumentLoader&#96;: 从文件系统加载文档</p>
</li>
<li><p><code>UrlDocumentLoader</code>: 从 URL 加载文档</p>
</li>
<li><p><code>AmazonS3DocumentLoader</code>: 从 Amazon S3 加载文档</p>
</li>
<li><p><code>AzureBlobStorageDocumentLoader</code>: 从 Azure Blob 存储加载文档</p>
</li>
<li><p><code>GitHubDocumentLoader</code>: 从 GitHub 仓库加载文档</p>
</li>
<li><p><code>TencentCosDocumentLoader</code>: 从腾讯云 COS 加载文档</p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250806161447190.png" alt="image-20250806161447190"></p>
</li>
</ul>
</li>
<li><p><code>Document Parser</code> 文档解析器</p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250806161704055.png" alt="image-20250806161704055"></p>
</li>
<li><p><code>Document Transformer</code> 文档转换器</p>
<p><code>DocumentTransformer</code> 用于对文档执行各种转换,如清理、过滤、增强或总结。</p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250806161819758.png" alt="image-20250806161819758"></p>
</li>
<li><p><code>Document Splitter</code> 文档分割器</p>
<ul>
<li><p><code>DocumentByParagraphSplitter</code> : 按段落拆分</p>
</li>
<li><p><code>DocumentBySentenceSplitter</code>: 按句子拆分</p>
</li>
<li><p><code>DocumentByWordSplitter</code>: 按单词拆分</p>
</li>
<li><p><code>DocumentByCharacterSplitter</code>: 按字符拆分</p>
</li>
<li><p><code>DocumentByRegexSplitter</code>: 按正则表达式拆分</p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250806162038085.png" alt="image-20250806162038085"></p>
</li>
</ul>
</li>
</ul>
<p>使用<code>LangChain4j</code>构建<code>RAG</code>的一般步骤</p>
<ol>
<li>加载文档：使用适当<code>DocumentLoader</code>和<code>DocumentParse</code>加载文档</li>
<li>转换文档：使用<code>DocumentTransformer</code>清理或增强文档（可选）</li>
<li>拆分文档：使用<code>DocumentSplitter</code>将文档拆分为更小的片段（可选）</li>
<li>嵌入文档：使用<code>EmbeddingModel</code>将文档片段转换为嵌入变量</li>
<li>存储嵌入：使用<code>EmbeddingStoreIngestor</code>存储嵌入向量</li>
<li>检索相关内容：根据用户查询，从<code>EmbeddingStore</code>检索最相关的文档片段</li>
<li>生成响应：将检索到的相关内容与用户查询一起提供给语言模型，生成最终响应</li>
</ol>
<h3 id="code（初级）"><a href="#code（初级）" class="headerlink" title="code（初级）"></a>code（初级）</h3><p>需求说明</p>
<p>​	某系统涉及后续自动化维护，需要根据响应码让大模型启动自迭代&#x2F;自维护模式</p>
<p>根据<code>alibaba</code>的java开发规范来确定返回</p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250806164431708.png" alt="image-20250806164431708"></p>
<p><code>module</code>：<code>LangChain4j-13chat-rag</code></p>
<p><code>pom</code></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>17<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>17<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- langchain4j 初阶 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>dev.langchain4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>langchain4j-open-ai<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- langchain4j 高阶 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>dev.langchain4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>langchain4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- easy-rag --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>dev.langchain4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>langchain4j-easy-rag<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>yaml</code></p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">9013</span></span><br><span class="line">  <span class="attr">servlet:</span></span><br><span class="line">    <span class="attr">encoding:</span></span><br><span class="line">      <span class="attr">charset:</span> <span class="string">UTF-8</span></span><br><span class="line">      <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">force:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">LangChain4j-13chat-rag</span></span><br></pre></td></tr></table></figure>

<p><code>RagAssistant</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lazy.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">RagAssistant</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 聊天</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> message 消息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> &#123;<span class="doctag">@link</span> String&#125;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    String <span class="title function_">chat</span><span class="params">(String message)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>LLMConfig</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lazy.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.lazy.service.RagAssistant;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.data.segment.TextSegment;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.memory.chat.MessageWindowChatMemory;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.model.chat.ChatModel;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.model.embedding.EmbeddingModel;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.model.openai.OpenAiChatModel;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.model.openai.OpenAiEmbeddingModel;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.rag.content.retriever.EmbeddingStoreContentRetriever;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.service.AiServices;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.store.embedding.EmbeddingStore;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.store.embedding.inmemory.InMemoryEmbeddingStore;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LLMConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ChatModel <span class="title function_">chatModel</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> OpenAiChatModel.builder()</span><br><span class="line">                .apiKey(System.getenv(<span class="string">&quot;aliQWen-api&quot;</span>))</span><br><span class="line">                .modelName(<span class="string">&quot;qwen-plus&quot;</span>)<span class="comment">//模型名称</span></span><br><span class="line">                .baseUrl(<span class="string">&quot;https://dashscope.aliyuncs.com/compatible-mode/v1&quot;</span>)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 在内存中存储</span></span><br><span class="line"><span class="comment">     *  需要预处理文档并将其存储在专门的嵌入存储（也称为矢量数据库）中。当用户提出问题时，这对于快速找到相关信息是必要的。</span></span><br><span class="line"><span class="comment">     *  我们可以使用我们支持的 15 多个嵌入存储中的任何一个，但为了简单起见，我们将使用内存中的嵌入存储：</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> InMemoryEmbeddingStore&lt;TextSegment&gt; <span class="title function_">inMemoryEmbeddingStore</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">InMemoryEmbeddingStore</span>&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RagAssistant <span class="title function_">ragAssistant</span><span class="params">(ChatModel chatModel, EmbeddingStore&lt;TextSegment&gt; embeddingStore)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> AiServices.builder(RagAssistant.class)</span><br><span class="line">                .chatModel(chatModel)</span><br><span class="line">                .chatMemory(MessageWindowChatMemory.withMaxMessages(<span class="number">50</span>)) <span class="comment">//最大条消息</span></span><br><span class="line">                .contentRetriever(EmbeddingStoreContentRetriever.from(embeddingStore))<span class="comment">//引入外部知识源</span></span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>RagController</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lazy.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.data.document.Document;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.data.document.loader.FileSystemDocumentLoader;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.data.document.parser.apache.tika.ApacheTikaDocumentParser;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.data.segment.TextSegment;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.model.chat.ChatModel;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.store.embedding.EmbeddingStoreIngestor;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.store.embedding.inmemory.InMemoryEmbeddingStore;</span><br><span class="line"><span class="keyword">import</span> jakarta.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.FileNotFoundException;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RagController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> InMemoryEmbeddingStore&lt;TextSegment&gt; inMemoryEmbeddingStore;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> ChatModel chatModel;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/rag/add&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">addRag</span><span class="params">()</span> <span class="keyword">throws</span> FileNotFoundException &#123;</span><br><span class="line"><span class="comment">//        Document document = FileSystemDocumentLoader</span></span><br><span class="line"><span class="comment">//                .loadDocument(&quot;C:\\Users\\MacBookPro\\Downloads\\阿里巴巴java开发规范（嵩山版）.pdf&quot;);//第一种方式</span></span><br><span class="line">        <span class="type">Document</span> <span class="variable">document</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ApacheTikaDocumentParser</span>().parse(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(</span><br><span class="line">                <span class="string">&quot;C:\\Users\\MacBookPro\\Downloads\\阿里巴巴java开发规范（嵩山版）.pdf&quot;</span>));<span class="comment">//第二种方式</span></span><br><span class="line">        EmbeddingStoreIngestor.ingest(document, inMemoryEmbeddingStore);<span class="comment">//添加文档到内存里面</span></span><br><span class="line">        <span class="keyword">return</span> chatModel.chat(<span class="string">&quot;DTO是什么?&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试：</p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250806172449724.png" alt="image-20250806172449724"></p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250806174643310.png" alt="image-20250806174643310"></p>
<h2 id="MCP协议"><a href="#MCP协议" class="headerlink" title="MCP协议"></a>MCP协议</h2><p>为什么有<code>MCP</code>？</p>
<p>大模型需要 MCP（Model Context Protocol，模型上下文协议）是为了解决传统集成方式下 LLM（大语言模型）与外部世界连接的低效和碎片化问题。以下是核心痛点和 MCP 的解决方案分析：</p>
<p>⚠️ <strong>一、无 MCP 前的核心痛点</strong></p>
<ol>
<li><strong>数据孤岛与静态知识局限</strong><ul>
<li>LLM 依赖训练时的静态数据，无法访问实时信息（如最新天气、股价、航班动态），导致回答过时或错误。</li>
<li>例如：旅行规划场景中，AI 无法查询实时机票价格或酒店房态，只能提供基于历史数据的建议。</li>
</ul>
</li>
<li><strong>集成复杂度高（M×N 问题）</strong><ul>
<li><strong>点对点集成</strong>：每个工具（如数据库、API）需单独开发适配接口。若存在 M 个模型和 N 个工具，需开发 M×N 个定制连接，维护成本爆炸式增长。</li>
<li><strong>协议碎片化</strong>：不同工具使用不同接口（SQL、REST API、GraphQL），开发者需学习多种协议，小公司难以接入高德地图等闭源服务。</li>
</ul>
</li>
<li><strong>动态性与灵活性缺失</strong><ul>
<li>工具功能变更（如新增参数）需重写集成代码，无法自动适配。</li>
<li>缺乏统一发现机制：AI 无法动态感知可用工具，需硬编码工具描述到提示词中。</li>
</ul>
</li>
<li><strong>安全与维护风险</strong><ul>
<li>分散的权限管理和认证机制增加安全漏洞风险。</li>
<li>紧耦合设计导致单点故障：某接口变更可能引发全线崩溃。</li>
</ul>
</li>
</ol>
<p>⚡<strong>二、MCP 的解决方案与核心价值</strong></p>
<p>MCP 通过 <strong>标准化协议</strong> 重构 LLM 与外部资源的交互方式，类比为 “AI 世界的 USB-C 接口”：</p>
<table>
<thead>
<tr>
<th align="left"><strong>痛点维度</strong></th>
<th align="left"><strong>传统方案</strong></th>
<th align="left"><strong>MCP 方案</strong></th>
<th align="left"><strong>优势</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong>集成复杂度</strong></td>
<td align="left">M×N 定制适配</td>
<td align="left">工具一次封装 → 所有 AI 自动兼容</td>
<td align="left">成本从 O(M×N) 降至 O(M+N)110</td>
</tr>
<tr>
<td align="left"><strong>动态扩展</strong></td>
<td align="left">硬编码接口，变更需重写代码</td>
<td align="left">工具主动声明能力，Client 自动发现2</td>
<td align="left">无缝兼容升级</td>
</tr>
<tr>
<td align="left"><strong>实时性</strong></td>
<td align="left">依赖轮询，延迟显著</td>
<td align="left">毫秒级数据流更新（如 SSE 推送）2</td>
<td align="left">决策滞后从小时级压缩到秒级</td>
</tr>
<tr>
<td align="left"><strong>开发效率</strong></td>
<td align="left">每对接新工具需数月</td>
<td align="left">小公司 1 天完成调试（如高德地图）2</td>
<td align="left">降低 90% 开发时间</td>
</tr>
<tr>
<td align="left"><strong>安全与标准化</strong></td>
<td align="left">分散权限管理</td>
<td align="left">统一认证框架（OAuth2&#x2F;API Key）69</td>
<td align="left">集中化风险控制</td>
</tr>
</tbody></table>
<p>💡 <strong>MCP 核心架构</strong></p>
<ol>
<li><strong>MCP Server</strong><ul>
<li>封装工具&#x2F;数据源（如天气查询、支付接口），暴露标准化能力（<code>list_tools</code>、<code>call_tool</code>）。</li>
<li>示例：创建天气查询 Server，仅需 10 行 Python 代码（使用 <code>@tool</code> 装饰器）。</li>
</ul>
</li>
<li><strong>MCP Client</strong><ul>
<li>嵌入 LLM 应用（如 Claude Desktop），动态发现可用工具并组装提示词。</li>
<li>自动转换用户请求为 MCP 标准调用（JSON-RPC 2.0 格式）。</li>
</ul>
</li>
<li><strong>协议层</strong><ul>
<li>传输无关：支持 HTTP&#x2F;Stdio&#x2F;WebSocket，统一本地工具与远程 API 调用。</li>
<li>错误处理：结构化错误码替代 HTTP 状态码，提升健壮性。</li>
</ul>
</li>
</ol>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250806181105577.png" alt="image-20250806181105577"></p>
<h3 id="MCP入门概念"><a href="#MCP入门概念" class="headerlink" title="MCP入门概念"></a>MCP入门概念</h3><ul>
<li><p>是什么？</p>
<ul>
<li><p><code>MCP</code>协议官网：<a target="_blank" rel="noopener" href="https://modelcontextprotocol.io/docs/getting-started/intro">https://modelcontextprotocol.io/docs/getting-started/intro</a></p>
<p>MCP是一种开放协议，它标准化了应用程序向大型语言模型（LLMs）提供上下文的方式。将MCP想象成AI应用的USB-C端口。就像USB-C提供了一种标准化的方式将您的设备连接到各种外围设备和配件一样，MCP提供了一种标准化的方式将AI模型连接到不同的数据源和工具。MCP使您能够在LLMs之上构建代理和复杂的流程，并将您的模型与外界连接起来。</p>
<p>MCP提供：</p>
<ul>
<li><p>一个不断增长的预构建集成列表，您的LLM可以直接插入其中</p>
</li>
<li><p>一种为AI应用构建自定义集成的方式</p>
</li>
<li><p>一个任何人都可以自由实施和使用的开放协议</p>
</li>
<li><p>在不同应用之间切换的灵活性，并随身携带您的上下文</p>
</li>
</ul>
</li>
<li><p><code>LangChain4j</code>支持<code>MCP</code>协议官网：<code>https://docs.langchain4j.info/tutorials/mcp</code></p>
<ul>
<li><p>LangChain4j 支持模型上下文协议 (MCP)，用于与符合 MCP 的服务器通信，这些服务器可以提供和执行工具。有关该协议的一般信息可以在 <a target="_blank" rel="noopener" href="https://modelcontextprotocol.io/">MCP 网站</a> 上找到。</p>
<p>该协议指定了两种传输类型，两种都受支持：</p>
<ul>
<li><code>HTTP</code>：客户端请求一个 SSE 通道来接收来自服务器的事件，然后通过 HTTP POST 请求发送命令。</li>
<li><code>stdio</code>：客户端可以将 MCP 服务器作为本地子进程运行，并通过标准输入&#x2F;输出直接与其通信。</li>
</ul>
</li>
</ul>
</li>
<li><p>一句话</p>
<ul>
<li><p>大模型版的<code>OpenFeign</code>，<code>OpenFeign</code>用于微服务之间通讯，<code>MCP</code>用户大模型之间的通讯</p>
<p>MCP就像是AI世界的”万能适配器”。</p>
<p>想象你有很多不同类型的服务和数据库，每个都有自己独特的”说话方式”。AI需要和这些服务交流时就很麻烦因为要学习每个服务的”语言”。</p>
<p>MCP解决了这个问题 - 它就像一个统一的翻译官，让AI只需学一种”语言”就能和所有服务交流。</p>
<p>这样开发者不用为每个服务单独开发连接方式，AI也能更容易获取它需要的信息。</p>
<p>如果你是一个后端同学，那么应该接触或听说过gRPC。gRPC通过标准化的通信方式可以实现不同语言开发的服务之间进行通信，那么MCP专门为AI模型设计的”翻译官和接口管理器”，让AI能以统一方式与各种应用或数据源交互。</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>能干嘛？</p>
<ul>
<li>提供了一种标准化的方式来连接<code>LLMs</code>需要的上下文，<code>MCP</code>就类似于一个<code>Agent</code>时代的<code>Type-C</code>协议，希望能将不同来源的数据、工具、服务统一起来供大模型调用</li>
</ul>
<p>没有<code>MCP</code>的时候，自己整自己的</p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250807155426250.png" alt="image-20250807155426250"></p>
<p>有了<code>MCP</code>，统一了标准</p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250807155452972.png" alt="image-20250807155452972"></p>
<blockquote>
<p>总结</p>
<p>MCP 厉害的地方在于，不用重复造轮子。</p>
<p>过去每个软件（比如微信、Excel）都要单独给 AI 做接口，</p>
<p>现在 MCP 统一了标准，就像所有电器都用 USB-C 充电口，AI 一个接口就能连接所有工具</p>
</blockquote>
<p><code>MCP</code>就是比<code>FunctionCalling</code>的更高一级抽象，也是实现智能体<code>Agent</code>的基础</p>
<p>举个例子：</p>
<p>​	<img src="/hexo-docs/images/LangChain4jImages/image-20250807170137391.png" alt="image-20250807170137391"></p>
<p>解释</p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250807170159553.png" alt="image-20250807170159553"></p>
<p>怎么玩？</p>
<p>地址：<a target="_blank" rel="noopener" href="http://mcp.so/zh">http://mcp.so/zh</a></p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250807184506099.png" alt="image-20250807184506099"></p>
<h3 id="MCP知识架构"><a href="#MCP知识架构" class="headerlink" title="MCP知识架构"></a><code>MCP</code>知识架构</h3><p><code>MCP</code>遵循客户端-服务端包含以下几个核心部分</p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250807170302534.png" alt="image-20250807170302534"></p>
<ul>
<li><code>MCP</code>主机（<code>MCP Hosts</code>）：发起请求的<code>AI</code>应用程序，比如聊天机器人、<code>AI</code>驱动的<code>IDE</code>等</li>
<li><code>MCP</code>客户端（<code>MCP Clients</code>）：在主机程序内部，与<code>MCP</code>服务器保持<code>1:1</code>的连接</li>
<li><code>MCP</code>服务端（<code>MCP Servers</code>）：为<code>MCP</code>客户端提供上下文、工具和提示信息</li>
<li>本地资源（<code>Local Resources</code>）：本地计算机可供<code>MCP</code>服务器安全访问的资源，如文件、数据库。</li>
<li>远程资源（<code>Remote Resources</code>）：<code>MCP</code>服务器可以连接到的远程资源，如通过<code>API</code>提供的数据</li>
</ul>
<p>在<code>MCP</code>通信协议中，一般有两种模式</p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250807170726771.png" alt="image-20250807170726771"></p>
<ol>
<li><p><code>STDIO</code>（标准输入&#x2F;输出）</p>
<p>支持标准输入和输出流通信，主要用于本地集成、命令行工具等场景。</p>
</li>
<li><p><code>SSE(Server-Sent Events)</code></p>
<p>支持使用<code>HTTP POST</code>请求进行服务器到客户端流式处理，以实现客户端到服务器的通信。</p>
</li>
</ol>
<p>两者对比</p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250807170924432.png" alt="image-20250807170924432"></p>
<h3 id="案例实战"><a href="#案例实战" class="headerlink" title="案例实战"></a>案例实战</h3><p>需求说明</p>
<ul>
<li>本次调用<code>MCPServer</code>百度地图，地址：<a target="_blank" rel="noopener" href="http://mcp.so/zh/server/baidu-map/baidu-maps%EF%BC%8Chttps://mcp.so/zh/server/baidu-map/baidu-maps?tab=content#%E5%B7%A5%E5%85%B7%E5%88%97%E8%A1%A8">http://mcp.so/zh/server/baidu-map/baidu-maps，https://mcp.so/zh/server/baidu-map/baidu-maps?tab=content#工具列表</a></li>
</ul>
<p>前置环境</p>
<ul>
<li><p>原理说明</p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250807184957104.png" alt="image-20250807184957104"></p>
</li>
<li><p>下载<code>nodejs</code></p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250807185109714.png" alt="image-20250807185109714"></p>
<p>下载安装成功后</p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250807185146148.png" alt="image-20250807185146148"></p>
</li>
<li><p>注册百度地图账号+申请<code>API-Key</code></p>
<p>地址：<a target="_blank" rel="noopener" href="https://lbsyun.baidu.com/apiconsole/key">https://lbsyun.baidu.com/apiconsole/key</a></p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250807190548444.png" alt="image-20250807190548444"></p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250807191039763.png" alt="image-20250807191039763"></p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250807191056574.png" alt="image-20250807191056574"></p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250807191109657.png" alt="image-20250807191109657"></p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250807191118899.png" alt="image-20250807191118899"></p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250807191215205.png" alt="image-20250807191215205"></p>
</li>
</ul>
<p>将<code>API-Key</code>配置环境变量里面，配置完成之后一定要重启，不然报错！</p>
<p>如何编写<code>MCP</code>程序？</p>
<p>地址：<a target="_blank" rel="noopener" href="https://docs.langchain4j.info/tutorials/mcp">https://docs.langchain4j.info/tutorials/mcp</a></p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250807191610869.png" alt="image-20250807191610869"></p>
<p><code>module</code>：<code>LangChain4j-14chat-mcp</code></p>
<p><code>pom</code></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>17<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>17<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 实现流式输出 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>dev.langchain4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>langchain4j-reactor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--DashScope (Qwen)接入阿里云百炼平台</span></span><br><span class="line"><span class="comment">       https://docs.langchain4j.dev/integrations/language-models/dashscope</span></span><br><span class="line"><span class="comment">   --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>dev.langchain4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>langchain4j-community-dashscope-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- MCP Client依赖 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>dev.langchain4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>langchain4j-mcp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>yaml</code></p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">9014</span></span><br><span class="line">  <span class="attr">servlet:</span></span><br><span class="line">    <span class="attr">encoding:</span></span><br><span class="line">      <span class="attr">charset:</span> <span class="string">UTF-8</span></span><br><span class="line">      <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">force:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">LangChain4j-14chat-mcp</span></span><br><span class="line"><span class="attr">langchain4j:</span></span><br><span class="line">  <span class="attr">community:</span></span><br><span class="line">    <span class="attr">dashscope:</span></span><br><span class="line">      <span class="attr">streaming-chat-model:</span></span><br><span class="line">        <span class="attr">api-key:</span> <span class="string">$&#123;aliQWen-api&#125;</span></span><br><span class="line">        <span class="attr">model-name:</span> <span class="string">qwen-plus</span></span><br><span class="line">      <span class="attr">chat-model:</span></span><br><span class="line">        <span class="attr">api-key:</span> <span class="string">$&#123;aliQWen-api&#125;</span></span><br><span class="line">        <span class="attr">model-name:</span> <span class="string">qwen-plus</span></span><br><span class="line"><span class="comment"># 只有日志级别调整为debug级别，同时配置以上 langchain 日志输出开关才有效</span></span><br><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">level:</span></span><br><span class="line">    <span class="attr">dev:</span></span><br><span class="line">      <span class="attr">langchain4j:</span> <span class="string">debug</span></span><br></pre></td></tr></table></figure>



<p><code>McpService</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.Flux;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">McpService</span> &#123;</span><br><span class="line">    Flux&lt;String&gt; <span class="title function_">chat</span><span class="params">(String question)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>McpCallServerController</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lazy.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.lazy.service.McpService;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.mcp.McpToolProvider;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.mcp.client.DefaultMcpClient;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.mcp.client.McpClient;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.mcp.client.transport.McpTransport;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.mcp.client.transport.stdio.StdioMcpTransport;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.model.chat.StreamingChatModel;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.service.AiServices;</span><br><span class="line"><span class="keyword">import</span> dev.langchain4j.service.tool.ToolProvider;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.Flux;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">McpCallServerController</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> StreamingChatModel streamingChatModel;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/mcp/chat&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Flux&lt;String&gt; <span class="title function_">chat</span><span class="params">(<span class="meta">@RequestParam(&quot;question&quot;)</span> String question)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">/**1.构建McpTransport协议</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         * 1.1 cmd：启动 Windows 命令行解释器。</span></span><br><span class="line"><span class="comment">         * 1.2 /c：告诉 cmd 执行完后面的命令后关闭自身。</span></span><br><span class="line"><span class="comment">         * 1.3 npx：npx = npm execute package，Node.js 的一个工具，用于执行 npm 包中的可执行文件。</span></span><br><span class="line"><span class="comment">         * 1.4 -y 或 --yes：自动确认操作（类似于默认接受所有提示）。</span></span><br><span class="line"><span class="comment">         * 1.5 <span class="doctag">@baidumap</span>/mcp-server-baidu-map：要通过 npx 执行的 npm 包名</span></span><br><span class="line"><span class="comment">         * 1.6 BAIDU_MAP_API_KEY 是访问百度地图开放平台API的AK</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="type">McpTransport</span> <span class="variable">transport</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StdioMcpTransport</span>.Builder()</span><br><span class="line">                .command(List.of(<span class="string">&quot;cmd&quot;</span>, <span class="string">&quot;/c&quot;</span>, <span class="string">&quot;npx&quot;</span>, <span class="string">&quot;-y&quot;</span>, <span class="string">&quot;@baidumap/mcp-server-baidu-map&quot;</span>))</span><br><span class="line">                .environment(Map.of(<span class="string">&quot;BAIDU_MAP_API_KEY&quot;</span>, System.getenv(<span class="string">&quot;BAIDU_MAP_API_KEY&quot;</span>)))</span><br><span class="line">                .build();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2.构建McpClient客户端</span></span><br><span class="line">        <span class="type">McpClient</span> <span class="variable">mcpClient</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultMcpClient</span>.Builder()</span><br><span class="line">                .transport(transport)</span><br><span class="line">                .build();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3.创建工具集和原生的FunctionCalling类似</span></span><br><span class="line">        <span class="type">ToolProvider</span> <span class="variable">toolProvider</span> <span class="operator">=</span> McpToolProvider.builder()</span><br><span class="line">                .mcpClients(mcpClient)</span><br><span class="line">                .build();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4.通过AiServivces给我们自定义接口McpService构建实现类并将工具集和大模型赋值给AiService</span></span><br><span class="line">        <span class="type">McpService</span> <span class="variable">mcpService</span> <span class="operator">=</span> AiServices.builder(McpService.class)</span><br><span class="line">                .streamingChatModel(streamingChatModel)</span><br><span class="line">                .toolProvider(toolProvider)</span><br><span class="line">                .build();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 5.调用我们定义的HighApi接口,通过大模型对百度mcpserver调用</span></span><br><span class="line">        <span class="keyword">return</span> mcpService.chat(question);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>先尝试在<code>cmd</code> 中执行 <code>npx -y @baidumap/mcp-server-baidu-map</code> 命令，查看 MCP 服务端是否能够正常启动。如果不能正常启动，需要查看错误信息并解决。我在此遇到问题，错误信息是「请求 npm 淘宝源下的 baidu map mcp server 失败，原因是证书过期」，于是我将 npm 镜像源又切回默认，然后再尝试执行，提示 Baidu Map MCP Server running on stdio，正常启动 MCP 服务端。</p>
<p>测试</p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250808160104933.png" alt="image-20250808160104933"></p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250808160228423.png" alt="image-20250808160228423"></p>
<p>复习</p>
<ul>
<li><p><code>Function Calling</code>，为了让大模型使用<code>Util</code>工具</p>
</li>
<li><p><code>RAG</code>，为了让大模型获取足够的上下文</p>
</li>
<li><p><code>MCP</code>，为了让大模型之间的调用</p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250807213432451.png" alt="image-20250807213432451"></p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250807213443872.png" alt="image-20250807213443872"></p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250807213536712.png" alt="image-20250807213536712"></p>
<p>原理说明</p>
<p><img src="/hexo-docs/images/LangChain4jImages/image-20250807213549809.png" alt="image-20250807213549809"></p>
</li>
</ul>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://mac2git.github.io/hexo-docs">Lazy</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://mac2git.github.io/hexo-docs/2025/08/13/LangChain4j/LangChain4j/">https://mac2git.github.io/hexo-docs/2025/08/13/LangChain4j/LangChain4j/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://mac2git.github.io/hexo-docs" target="_blank">Lazy的个人博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/hexo-docs/tags/LangChain4j/">LangChain4j</a></div><div class="post-share"><div class="social-share" data-image="https://docs.langchain4j.info/img/logo.svg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/hexo-docs/2025/08/13/redis/Redlock%E7%AE%97%E6%B3%95%E5%92%8C%E5%BA%95%E5%B1%82%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%E5%92%8C%E7%BC%93%E5%AD%98%E6%B7%98%E6%B1%B0%E7%AD%96%E7%95%A5/" title="RedLock算法和底层源码分析和缓存淘汰策略"><img class="cover" src="https://pic.crazytaxii.com/Redis_Logo.png" onerror="onerror=null;src='/hexo-docs/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">RedLock算法和底层源码分析和缓存淘汰策略</div></div><div class="info-2"><div class="info-item-1">上一章自研的redis锁对于一般中小公司，不是特别高并发场景足够用了，单机redis小业务也撑得住。但是对于特别高并发场景的话，就得使用Redisson了 Redis分布式锁-RedLock红锁算法（Distributed locks with Redis）官网：Redis 的分布式锁 |文档 说明：  为什么学习这个？怎样产生的？   线程 1 首先获取锁成功，将键值对写入 redis 的 master 节点，在 redis 将该键值对同步到 slave 节点之前，master 发生了故障；redis 触发故障转移，其中一个 slave 升级为新的 master，此时新上位的master并不包含线程1写入的键值对，因此线程 2 尝试获取锁也可以成功拿到锁，此时相当于有两个线程获取到了锁，可能会导致各种预期之外的情况发生，例如最常见的脏数据。  我们加的是排它独占锁，同一时间只能有一个建redis锁成功并持有锁，严禁出现2个以上的请求线程拿到锁。危险的！ RedLock算法设计理念Redis也提供了Redlock算法，用来实现基于多个实例的分布式锁。锁变量由多个实例维护，即使有实...</div></div></div></a><a class="pagination-related" href="/hexo-docs/2025/08/13/redis/RDB+AOF/" title="RDB+AOF"><img class="cover" src="https://pic.crazytaxii.com/Redis_Logo.png" onerror="onerror=null;src='/hexo-docs/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">RDB+AOF</div></div><div class="info-2"><div class="info-item-1">redis数据数据持久化 为什么要用数据持久化？ 数据持久化可以在内存丢失或其他灾难性故障的情况下实现恢复。 数据持久化的两种方式  AOF：以日志的形式来记录每个写操作，将redis执行过的所有写指令记录下来（读操作不记录），只许追加文件但不可以改写文件，redis启动之初会读取该文件重新构建数据，换言之，redis重启的话就根据日志文件的内容将写入指令从前到后执行一次以完成数据的恢复工作。 RDB（Redis 数据库）：RDB 持久性以指定的时间间隔执行数据集的时间点快照。  rdb（redis database）能干嘛？ 在指定的时间间隔内将内存中的数据集快照写入磁盘，也就是行话讲的Snapshot内存快照，它恢复时再将硬盘快照文件直接读回到内存里。Redis的数据都在内存中，保存备份时它执行的是全量快照，也就是说，把内存中的所有数据都记录到磁盘中，一锅端。 Rdb保存的是dump.rdb文件  Redis6.0.16以下  Redis6.2以及Redis-7.0.0  自动触发 redis7版本，按照redis.conf里配置的save&lt;seconds&gt;&lt...</div></div></div></a></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/hexo-docs/images/webImages/avatar.jpg" onerror="this.onerror=null;this.src='/hexo-docs/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Lazy</div><div class="author-info-description">归途也还可爱</div><div class="site-data"><a href="/hexo-docs/archives/"><div class="headline">文章</div><div class="length-num">25</div></a><a href="/hexo-docs/tags/"><div class="headline">标签</div><div class="length-num">13</div></a><a href="/hexo-docs/categories/"><div class="headline">分类</div><div class="length-num">9</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Mac2git"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/Mac2git" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="https://gitee.com/wx_00ba6ce280" target="_blank" title="Gitee"><i class="fa fa-book-open"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">博客正在施工，请先随便逛逛。</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#LangChain4j"><span class="toc-number">1.</span> <span class="toc-text">LangChain4j</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%90%86%E8%AE%BA%E6%A6%82%E8%BF%B0"><span class="toc-number">1.1.</span> <span class="toc-text">理论概述</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.1.1.</span> <span class="toc-text">介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%83%BD%E5%B9%B2%E5%98%9B"><span class="toc-number">1.1.2.</span> <span class="toc-text">能干嘛</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%BB%E5%93%AA%E4%B8%8B"><span class="toc-number">1.1.3.</span> <span class="toc-text">去哪下</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%8E%E4%B9%88%E7%8E%A9"><span class="toc-number">1.1.4.</span> <span class="toc-text">怎么玩</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B0%B8%E8%BF%9C%E7%9A%84HelloWorld"><span class="toc-number">1.2.</span> <span class="toc-text">永远的HelloWorld</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E7%BD%AE%E7%BA%A6%E5%AE%9A"><span class="toc-number">1.2.1.</span> <span class="toc-text">前置约定</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%98%BF%E9%87%8C%E4%BA%91%E7%99%BE%E7%82%BC%E5%B9%B3%E5%8F%B0%E5%85%A5%E5%8F%A3"><span class="toc-number">1.2.2.</span> <span class="toc-text">阿里云百炼平台入口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">1.2.3.</span> <span class="toc-text">总结</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IDEA-%E5%B7%A5%E5%85%B7%E4%B8%AD%E5%BB%BA-project-%E7%88%B6%E5%B7%A5%E7%A8%8B"><span class="toc-number">1.2.4.</span> <span class="toc-text">IDEA 工具中建 project 父工程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95"><span class="toc-number">1.2.5.</span> <span class="toc-text">测试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%90%8C%E6%97%B6%E5%AD%98%E5%9C%A8%E5%A4%9A%E7%A7%8D%E5%A4%A7%E6%A8%A1%E5%9E%8B%E5%9C%A8%E7%B3%BB%E7%BB%9F%E9%87%8C%E5%85%B1%E5%AD%98%E4%BD%BF%E7%94%A8%EF%BC%9F"><span class="toc-number">1.2.6.</span> <span class="toc-text">如何同时存在多种大模型在系统里共存使用？</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#DeepSeek-API-%E6%96%87%E6%A1%A3"><span class="toc-number">1.2.6.1.</span> <span class="toc-text">DeepSeek API 文档</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%9A%E6%A8%A1%E5%9E%8B%E5%85%B1%E5%AD%98%E4%BD%BF%E7%94%A8"><span class="toc-number">1.2.6.2.</span> <span class="toc-text">多模型共存使用</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8E%9F%E7%94%9F%E6%95%B4%E5%90%88%E5%92%8CSpringBoot%E6%95%B4%E5%90%88"><span class="toc-number">1.3.</span> <span class="toc-text">原生整合和SpringBoot整合</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#LangChain4j-%E5%8E%9F%E7%94%9F-VS-LangChain4j-Boot%E6%95%B4%E5%90%88"><span class="toc-number">1.3.1.</span> <span class="toc-text">LangChain4j 原生 VS LangChain4j-Boot整合</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B"><span class="toc-number">1.3.2.</span> <span class="toc-text">案例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%8E%E9%98%B6%E5%92%8C%E9%AB%98%E9%98%B6API"><span class="toc-number">1.4.</span> <span class="toc-text">低阶和高阶API</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#LangChain4j%E5%9C%A8%E4%B8%A4%E4%B8%AA%E6%8A%BD%E8%B1%A1%E5%B1%82%E6%8F%90%E4%BE%9B%E4%B8%8D%E5%90%8C%E7%9A%84api"><span class="toc-number">1.4.1.</span> <span class="toc-text">LangChain4j在两个抽象层提供不同的api</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%8E%E9%98%B6api"><span class="toc-number">1.4.1.1.</span> <span class="toc-text">低阶api</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%AB%98%E9%98%B6api"><span class="toc-number">1.4.1.2.</span> <span class="toc-text">高阶api</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E6%A1%88%E4%BE%8B"><span class="toc-number">1.4.2.</span> <span class="toc-text">代码案例</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%8E%E9%98%B6api%EF%BC%88token%E4%BD%BF%E7%94%A8%E6%83%85%E5%86%B5%EF%BC%89"><span class="toc-number">1.4.2.1.</span> <span class="toc-text">低阶api（token使用情况）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%AB%98%E9%98%B6api-1"><span class="toc-number">1.4.2.2.</span> <span class="toc-text">高阶api</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#AI-Service-%E6%98%AF%E5%A6%82%E4%BD%95%E5%B7%A5%E4%BD%9C%E7%9A%84%EF%BC%9F"><span class="toc-number">1.4.2.2.1.</span> <span class="toc-text">AI Service 是如何工作的？</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A8%A1%E5%9E%8B%E5%8F%82%E6%95%B0%E9%85%8D%E7%BD%AE"><span class="toc-number">1.5.</span> <span class="toc-text">模型参数配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A5%E5%BF%97%E9%85%8D%E7%BD%AE%EF%BC%88Logging%EF%BC%89"><span class="toc-number">1.5.1.</span> <span class="toc-text">日志配置（Logging）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%91%E6%8E%A7%EF%BC%88observability%EF%BC%89"><span class="toc-number">1.5.2.</span> <span class="toc-text">监控（observability）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B-1"><span class="toc-number">1.5.2.1.</span> <span class="toc-text">案例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%87%8D%E8%AF%95%E6%9C%BA%E5%88%B6%EF%BC%88Retry-Configuration%EF%BC%89"><span class="toc-number">1.5.3.</span> <span class="toc-text">重试机制（Retry Configuration）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B6%85%E6%97%B6%E6%8E%A7%E5%88%B6%EF%BC%88timeout%EF%BC%89"><span class="toc-number">1.5.4.</span> <span class="toc-text">超时控制（timeout）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%A4%B4"><span class="toc-number">1.5.5.</span> <span class="toc-text">自定义头</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%9A%E6%A8%A1%E6%80%81%E8%A7%86%E8%A7%89%E7%90%86%E8%A7%A3"><span class="toc-number">1.6.</span> <span class="toc-text">多模态视觉理解</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%80%E6%9C%89%E6%94%AF%E6%8C%81%E7%9A%84%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E6%AF%94%E8%BE%83%E8%A1%A8"><span class="toc-number">1.6.1.</span> <span class="toc-text">所有支持的语言模型比较表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%89%E6%8B%A9%E6%A8%A1%E5%9E%8B"><span class="toc-number">1.6.2.</span> <span class="toc-text">选择模型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#code-%E6%A1%88%E4%BE%8B"><span class="toc-number">1.6.3.</span> <span class="toc-text">code 案例</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#example-1%EF%BC%88LangChain4j-%E5%8E%9F%E7%94%9F%EF%BC%89"><span class="toc-number">1.6.3.1.</span> <span class="toc-text">example 1（LangChain4j 原生）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#example-2%EF%BC%88LangChain4j%E8%B7%9F%E7%AC%AC%E4%B8%89%E6%96%B9%E6%95%B4%E5%90%88%EF%BC%89"><span class="toc-number">1.6.3.2.</span> <span class="toc-text">example 2（LangChain4j跟第三方整合）</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B5%81%E5%BC%8F%E8%BE%93%E5%87%BA%EF%BC%88streamingoutput%EF%BC%89"><span class="toc-number">1.7.</span> <span class="toc-text">流式输出（streamingoutput）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%8E%E9%98%B6api-1"><span class="toc-number">1.7.1.</span> <span class="toc-text">低阶api</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%AB%98%E9%98%B6api%EF%BC%88%E7%BB%93%E5%90%88webFlux%E7%BC%96%E7%A8%8B%EF%BC%89"><span class="toc-number">1.7.2.</span> <span class="toc-text">高阶api（结合webFlux编程）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E5%BC%8F%E7%BC%96%E7%A8%8B%EF%BC%88%E7%BB%93%E5%90%88Flux%EF%BC%89"><span class="toc-number">1.7.3.</span> <span class="toc-text">接口式编程（结合Flux）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%B0%E5%BF%86%E7%BC%93%E5%AD%98"><span class="toc-number">1.8.</span> <span class="toc-text">记忆缓存</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%81%E4%B9%85%E5%8C%96"><span class="toc-number">1.8.1.</span> <span class="toc-text">持久化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%A4%E7%A7%8D%E4%B8%BB%E8%A6%81%E7%9A%84ChatMemory%E5%AE%9E%E7%8E%B0%E7%B1%BB"><span class="toc-number">1.8.2.</span> <span class="toc-text">两种主要的ChatMemory实现类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B-2"><span class="toc-number">1.8.3.</span> <span class="toc-text">案例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8F%90%E7%A4%BA%E8%AF%8D%E5%B7%A5%E7%A8%8B"><span class="toc-number">1.9.</span> <span class="toc-text">提示词工程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%83%BD%E5%B9%B2%E5%98%9B-1"><span class="toc-number">1.9.1.</span> <span class="toc-text">能干嘛</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#code%E6%A1%88%E4%BE%8B"><span class="toc-number">1.9.2.</span> <span class="toc-text">code案例</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E7%BB%84code"><span class="toc-number">1.9.2.1.</span> <span class="toc-text">第一组code</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E7%BB%84code"><span class="toc-number">1.9.2.2.</span> <span class="toc-text">第二组code</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E7%BB%84code"><span class="toc-number">1.9.2.3.</span> <span class="toc-text">第三组code</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B3%A8%E6%84%8F%EF%BC%9A"><span class="toc-number">1.9.2.3.1.</span> <span class="toc-text">注意：</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8C%81%E4%B9%85%E5%8C%96-1"><span class="toc-number">1.10.</span> <span class="toc-text">持久化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#code%E6%A1%88%E4%BE%8B-1"><span class="toc-number">1.10.1.</span> <span class="toc-text">code案例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Tools%EF%BC%88Function-Calling%EF%BC%89"><span class="toc-number">1.11.</span> <span class="toc-text">Tools（Function Calling）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%8E%E9%98%B6API"><span class="toc-number">1.11.1.</span> <span class="toc-text">低阶API</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%AB%98%E7%BA%A7%E5%B7%A5%E5%85%B7-API"><span class="toc-number">1.11.2.</span> <span class="toc-text">高级工具 API</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%8E%E9%98%B6API-code"><span class="toc-number">1.11.3.</span> <span class="toc-text">低阶API code</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%AB%98%E9%98%B6API-code"><span class="toc-number">1.11.4.</span> <span class="toc-text">高阶API code</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%91%E9%87%8F%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">1.12.</span> <span class="toc-text">向量数据库</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%91%E9%87%8F%E5%8C%96%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="toc-number">1.12.1.</span> <span class="toc-text">向量化是什么？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%83%BD%E5%B9%B2%E5%98%9B%EF%BC%9F"><span class="toc-number">1.12.2.</span> <span class="toc-text">能干嘛？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%91%E9%87%8F%E5%8C%963%E4%BB%B6%E5%A5%97"><span class="toc-number">1.12.3.</span> <span class="toc-text">向量化3件套</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%8E%E4%B9%88%E7%8E%A9-1"><span class="toc-number">1.12.4.</span> <span class="toc-text">怎么玩</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#code-%E6%A1%88%E4%BE%8B-1"><span class="toc-number">1.12.5.</span> <span class="toc-text">code 案例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A3%80%E7%B4%A2%E5%A2%9E%E5%BC%BA%E7%94%9F%E6%88%90RAG"><span class="toc-number">1.13.</span> <span class="toc-text">检索增强生成RAG</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF-RAG%EF%BC%9F"><span class="toc-number">1.13.1.</span> <span class="toc-text">什么是 RAG？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%83%BD%E5%B9%B2%E5%98%9B-2"><span class="toc-number">1.13.2.</span> <span class="toc-text">能干嘛</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%8E%E4%B9%88%E7%8E%A9-2"><span class="toc-number">1.13.3.</span> <span class="toc-text">怎么玩</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83API"><span class="toc-number">1.13.3.1.</span> <span class="toc-text">核心API</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#code%EF%BC%88%E5%88%9D%E7%BA%A7%EF%BC%89"><span class="toc-number">1.13.4.</span> <span class="toc-text">code（初级）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MCP%E5%8D%8F%E8%AE%AE"><span class="toc-number">1.14.</span> <span class="toc-text">MCP协议</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#MCP%E5%85%A5%E9%97%A8%E6%A6%82%E5%BF%B5"><span class="toc-number">1.14.1.</span> <span class="toc-text">MCP入门概念</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MCP%E7%9F%A5%E8%AF%86%E6%9E%B6%E6%9E%84"><span class="toc-number">1.14.2.</span> <span class="toc-text">MCP知识架构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B%E5%AE%9E%E6%88%98"><span class="toc-number">1.14.3.</span> <span class="toc-text">案例实战</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/hexo-docs/2025/08/29/commit_protocol/index/" title="两阶段提交与三阶段提交"><img src="/hexo-docs/images/commit_protocolImages/img.png" onerror="this.onerror=null;this.src='/hexo-docs/img/404.jpg'" alt="两阶段提交与三阶段提交"/></a><div class="content"><a class="title" href="/hexo-docs/2025/08/29/commit_protocol/index/" title="两阶段提交与三阶段提交">两阶段提交与三阶段提交</a><time datetime="2025-08-28T16:00:00.000Z" title="发表于 2025-08-29 00:00:00">2025-08-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/hexo-docs/2025/08/26/other/mysql_id/" title="在实际开发过程中Mysql该选用ID什么ID作为主键？"><img src="/hexo-docs/images/mysql_idImages/cover.svg" onerror="this.onerror=null;this.src='/hexo-docs/img/404.jpg'" alt="在实际开发过程中Mysql该选用ID什么ID作为主键？"/></a><div class="content"><a class="title" href="/hexo-docs/2025/08/26/other/mysql_id/" title="在实际开发过程中Mysql该选用ID什么ID作为主键？">在实际开发过程中Mysql该选用ID什么ID作为主键？</a><time datetime="2025-08-26T09:24:30.000Z" title="发表于 2025-08-26 17:24:30">2025-08-26</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/hexo-docs/2025/08/26/other/Linux_ext2~ext4example/" title="linux ext2~ext4介绍"><img src="/hexo-docs/images/webImages/default_top_img.jpeg" onerror="this.onerror=null;this.src='/hexo-docs/img/404.jpg'" alt="linux ext2~ext4介绍"/></a><div class="content"><a class="title" href="/hexo-docs/2025/08/26/other/Linux_ext2~ext4example/" title="linux ext2~ext4介绍">linux ext2~ext4介绍</a><time datetime="2025-08-26T09:17:00.000Z" title="发表于 2025-08-26 17:17:00">2025-08-26</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/hexo-docs/2025/08/24/other/hash/" title="Hash值"><img src="/hexo-docs/images/hashImages/cover.png" onerror="this.onerror=null;this.src='/hexo-docs/img/404.jpg'" alt="Hash值"/></a><div class="content"><a class="title" href="/hexo-docs/2025/08/24/other/hash/" title="Hash值">Hash值</a><time datetime="2025-08-24T11:30:12.000Z" title="发表于 2025-08-24 19:30:12">2025-08-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/hexo-docs/2025/08/24/other/ack/" title="ACK机制"><img src="/hexo-docs/images/ackImages/cover.png" onerror="this.onerror=null;this.src='/hexo-docs/img/404.jpg'" alt="ACK机制"/></a><div class="content"><a class="title" href="/hexo-docs/2025/08/24/other/ack/" title="ACK机制">ACK机制</a><time datetime="2025-08-24T10:19:12.000Z" title="发表于 2025-08-24 18:19:12">2025-08-24</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2025 By Lazy</span><span class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.4.3</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/hexo-docs/js/utils.js"></script><script src="/hexo-docs/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><div class="js-pjax"><script>(() => {
  const loadMathjax = () => {
    if (!window.MathJax) {
      window.MathJax = {
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']],
          tags: 'none',
        },
        chtml: {
          scale: 1.1
        },
        options: {
          enableMenu: true,
          renderActions: {
            findScript: [10, doc => {
              for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
                const display = !!node.type.match(/; *mode=display/)
                const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
                const text = document.createTextNode('')
                node.parentNode.replaceChild(text, node)
                math.start = {node: text, delim: '', n: 0}
                math.end = {node: text, delim: '', n: 0}
                doc.math.push(math)
              }
            }, '']
          }
        }
      }

      const script = document.createElement('script')
      script.src = 'https://cdn.jsdelivr.net/npm/mathjax/es5/tex-mml-chtml.min.js'
      script.id = 'MathJax-script'
      script.async = true
      document.head.appendChild(script)
    } else {
      MathJax.startup.document.state(0)
      MathJax.texReset()
      MathJax.typesetPromise()
    }
  }

  btf.addGlobalFn('encrypt', loadMathjax, 'mathjax')
  window.pjax ? loadMathjax() : window.addEventListener('load', loadMathjax)
})()</script></div><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-fluttering-ribbon.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false;
POWERMODE.mobile = true;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-show-text.min.js" data-mobile="true" data-text="富强,民主,文明,和谐,平等,公正,法治,爱国,敬业,诚信,友善" data-fontsize="14px" data-random="true" async="async"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/hexo-docs/js/search/local-search.js"></script></div></div></body></html>